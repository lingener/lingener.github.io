<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ActiveMQ入门 | 心沉则灵</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="学而不思则罔思而不学则殆!">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/css/0.styles.1ed67386.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/app.0b21ff5c.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/5.f8fa3a85.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/1.46137cce.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/10.7222c760.js" as="script"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/11.31d5cb55.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/12.ac71a866.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/13.a4862f8f.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/14.7d38783b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/15.edb526f6.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/16.ac7c0538.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/17.c2f3c82d.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/18.2858e484.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/19.e3fdb388.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/2.f64b1c52.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/20.de9181b7.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/21.bf18fba2.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/22.89ef57ad.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/23.d1369dc6.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/24.57b2eb10.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/25.279be27c.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/26.77abaa9b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/27.3ebdd851.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/28.3a7441a6.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/29.ce0c7ac7.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/30.5e1d60b3.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/31.8e81922e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/32.f16a296c.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/33.6f85c4d6.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/34.3e2c1671.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/35.08d6b1a5.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/36.2338551e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/37.fd9a8698.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/38.c9dab7de.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/39.ae723246.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/40.fbd466bd.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/41.89cdf369.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/42.b0247ac4.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/43.9fb64b72.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/44.6d1a088b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/45.333ed046.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/46.146a5de6.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/47.d3f7b767.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/48.a52dcdfb.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/49.aa541e45.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/6.3bd08025.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/7.63cd94b3.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/8.3fc861cf.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/9.e143e01a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/vendors~flowchart.2b2fbf5d.js">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/css/0.styles.1ed67386.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-0f44a727><div data-v-0f44a727><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-0f44a727 data-v-0f44a727><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-355e03f9 data-v-0f44a727 data-v-0f44a727><h3 class="title" data-v-355e03f9 data-v-355e03f9>心沉则灵</h3> <p class="description" data-v-355e03f9 data-v-355e03f9>学而不思则罔思而不学则殆!</p> <label id="box" class="inputBox" data-v-355e03f9 data-v-355e03f9><input type="password" value="" data-v-355e03f9> <span data-v-355e03f9>Konck! Knock!</span> <button data-v-355e03f9>OK</button></label> <div class="footer" data-v-355e03f9 data-v-355e03f9><span data-v-355e03f9><i class="iconfont reco-theme" data-v-355e03f9></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-355e03f9>vuePress-theme-reco</a></span> <span data-v-355e03f9><i class="iconfont reco-copyright" data-v-355e03f9></i> <a data-v-355e03f9><span data-v-355e03f9>Lingener</span>
            
          <span data-v-355e03f9>2020 - </span>
          2021
        </a></span></div></div> <div class="hide" data-v-0f44a727><header class="navbar" data-v-0f44a727><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="心沉则灵" class="logo"> <span class="site-name">心沉则灵</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      归档
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Architect/" class="nav-link"><i class="undefined"></i>
  Architect
</a></li><li class="dropdown-item"><!----> <a href="/categories/Microservices/" class="nav-link"><i class="undefined"></i>
  Microservices
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spring/" class="nav-link"><i class="undefined"></i>
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/categories/DB/" class="nav-link"><i class="undefined"></i>
  DB
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/Middleware/" class="nav-link"><i class="undefined"></i>
  Middleware
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-0f44a727></div> <aside class="sidebar" data-v-0f44a727><div class="personal-info-wrapper" data-v-5aaeb100 data-v-0f44a727><!----> <h3 class="name" data-v-5aaeb100>
    Lingener
  </h3> <div class="num" data-v-5aaeb100><div data-v-5aaeb100><h3 data-v-5aaeb100>36</h3> <h6 data-v-5aaeb100>Articles</h6></div> <div data-v-5aaeb100><h3 data-v-5aaeb100>20</h3> <h6 data-v-5aaeb100>Tags</h6></div></div> <ul class="social-links" data-v-5aaeb100></ul> <hr data-v-5aaeb100></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      归档
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Architect/" class="nav-link"><i class="undefined"></i>
  Architect
</a></li><li class="dropdown-item"><!----> <a href="/categories/Microservices/" class="nav-link"><i class="undefined"></i>
  Microservices
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spring/" class="nav-link"><i class="undefined"></i>
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/categories/DB/" class="nav-link"><i class="undefined"></i>
  DB
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/Middleware/" class="nav-link"><i class="undefined"></i>
  Middleware
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Active MQ</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/views/middleware/message/activemq/activemq.html" aria-current="page" class="active sidebar-link">ActiveMQ入门</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-355e03f9 data-v-0f44a727><h3 class="title" data-v-355e03f9 data-v-355e03f9>ActiveMQ入门</h3> <!----> <label id="box" class="inputBox" data-v-355e03f9 data-v-355e03f9><input type="password" value="" data-v-355e03f9> <span data-v-355e03f9>Konck! Knock!</span> <button data-v-355e03f9>OK</button></label> <div class="footer" data-v-355e03f9 data-v-355e03f9><span data-v-355e03f9><i class="iconfont reco-theme" data-v-355e03f9></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-355e03f9>vuePress-theme-reco</a></span> <span data-v-355e03f9><i class="iconfont reco-copyright" data-v-355e03f9></i> <a data-v-355e03f9><span data-v-355e03f9>Lingener</span>
            
          <span data-v-355e03f9>2020 - </span>
          2021
        </a></span></div></div> <div data-v-0f44a727><main class="page"><section><div class="page-title"><h1 class="title">ActiveMQ入门</h1> <div data-v-5eef61be><i class="iconfont reco-account" data-v-5eef61be><span data-v-5eef61be>Lingener</span></i> <i class="iconfont reco-date" data-v-5eef61be><span data-v-5eef61be>8/18/2021</span></i> <i class="iconfont reco-eye" data-v-5eef61be><span id="/views/middleware/message/activemq/activemq.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-5eef61be><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="tags iconfont reco-tag" data-v-5eef61be><span class="tag-item" data-v-5eef61be>Middleware</span><span class="tag-item" data-v-5eef61be>ActiveMQ</span><span class="tag-item" data-v-5eef61be>MQ</span></i></div></div> <div class="theme-reco-content content__default"><h1 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h1> <p><img src="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/img/activemq_logo_white_vertical.3bb9ba67.png" alt="img"></p> <p>官方网站</p> <p>http://activemq.apache.org/</p> <h1 id="broker"><a href="#broker" class="header-anchor">#</a> Broker</h1> <p>ActiveMQ 5.0 的二进制发布包中bin目录中包含一个名为activemq的脚本，直接运行这个脚本就可以启动一个broker。 此外也可以通过Broker Configuration URI或Broker XBean URI对broker进行配置，以下是一些命令行参数的例子：</p> <table><thead><tr><th>Example</th> <th>Description</th></tr></thead> <tbody><tr><td>activemq</td> <td>Runs a broker using the default  'xbean:activemq.xml' as the broker configuration file.</td></tr> <tr><td>activemq xbean:myconfig.xml</td> <td>Runs a broker using the file myconfig.xml as the  broker configuration file that is located in the classpath.</td></tr> <tr><td>activemq xbean:file:./conf/broker1.xml</td> <td>Runs a broker using the file broker1.xml as the  broker configuration file that is located in the relative file path  ./conf/broker1.xml</td></tr> <tr><td>activemq xbean:file:C:/ActiveMQ/conf/broker2.xml</td> <td>Runs a broker using the file broker2.xml as the  broker configuration file that is located in the absolute file path  C:/ActiveMQ/conf/broker2.xml</td></tr> <tr><td>activemq broker:(tcp://localhost:61616,  tcp://localhost:5000)?useJmx=true</td> <td>Runs a broker with two transport connectors and  JMX enabled.</td></tr> <tr><td>activemq broker:(tcp://localhost:61616,  network:tcp://localhost:5000)?persistent=false</td> <td>Runs a broker with 1 transport connector and 1  network connector with persistence disabled.</td></tr></tbody></table> <h1 id="存储"><a href="#存储" class="header-anchor">#</a> 存储</h1> <h2 id="kahadb存储"><a href="#kahadb存储" class="header-anchor">#</a> KahaDB存储</h2> <p>KahaDB是默认的持久化策略，所有消息顺序添加到一个日志文件中，同时另外有一个索引文件记录指向这些日志的存储地址，还有一个事务日志用于消息回复操作。是一个专门针对消息持久化的解决方案,它对典型的消息使用模式进行了优化。</p> <p>在data/kahadb这个目录下，会生成四个文件，来完成消息持久化</p> <ol><li><p>db.data 它是消息的索引文件，本质上是B-Tree（B树），使用B-Tree作为索引指向db-*.log里面存储的消息</p></li> <li><p>db.redo 用来进行消息恢复</p></li> <li><p>db-.log 存储消息内容。新的数据以APPEND的方式追加到日志文件末尾。属于顺序写入，因此消息存储是比较 快的。默认是32M，达到阀值会自动递增</p></li> <li><p>lock文件锁，写入当前获得kahadb读写权限的broker ，用于在集群环境下的竞争处理</p></li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;persistenceAdapter&gt; &lt;!--directory:保存数据的目录;journalMaxFileLength:保存消息的文件大小 --&gt; &lt;kahaDBdirectory=&quot;${activemq.data}/kahadb&quot;journalMaxFileLength=&quot;16mb&quot;/&gt; &lt;/persistenceAdapter&gt;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>特性：</p> <p>1、日志形式存储消息；</p> <p>2、消息索引以 B-Tree 结构存储，可以快速更新；</p> <p>3、 完全支持 JMS 事务；</p> <p>4、支持多种恢复机制kahadb 可以限制每个数据文件的大小。不代表总计数据容量。</p> <h2 id="amq-方式"><a href="#amq-方式" class="header-anchor">#</a> AMQ 方式</h2> <p>只适用于 5.3 版本之前。 AMQ 也是一个文件型数据库，消息信息最终是存储在文件中。内存中也会有缓存数据。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;persistenceAdapter&gt; &lt;!--directory:保存数据的目录 ;maxFileLength:保存消息的文件大小 --&gt; &lt;amqPersistenceAdapterdirectory=&quot;${activemq.data}/amq&quot;maxFileLength=&quot;32mb&quot;/&gt; &lt;/persistenceAdapter&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>性能高于 JDBC，写入消息时，会将消息写入日志文件，由于是顺序追加写，性能很高。</p> <p>为了提升性能，创建消息主键索引，并且提供缓存机制，进一步提升性能。</p> <p>每个日志文件的 大小都是有限制的（默认 32m，可自行配置） 。</p> <p>当超过这个大小，系统会重新建立一个文件。</p> <p>当所有的消息都消费完成，系统会删除这 个文件或者归档。</p> <p>主要的缺点是 AMQ Message 会为每一个 Destination 创建一个索引，如果使用了大量的 Queue，索引文件的大小会占用很多磁盘空间。</p> <p>而且由于索引巨大，一旦 Broker（ActiveMQ 应用实例）崩溃，重建索引的速度会非常 慢。</p> <p>虽然 AMQ 性能略高于 Kaha DB 方式，但是由于其重建索引时间过长，而且索引文件 占用磁盘空间过大，所以已经不推荐使用。</p> <h2 id="jdbc存储"><a href="#jdbc存储" class="header-anchor">#</a> JDBC存储</h2> <p>使用JDBC持久化方式，数据库默认会创建3个表，每个表的作用如下：
activemq_msgs：queue和topic的消息都存在这个表中
activemq_acks：存储持久订阅的信息和最后一个持久订阅接收的消息ID
activemq_lock：跟kahadb的lock文件类似，确保数据库在某一时刻只有一个broker在访问</p> <p>ActiveMQ 将数据持久化到数据库中。</p> <p>不指定具体的数据库。 可以使用任意的数据库 中。</p> <p>本环节中使用 MySQL 数据库。 下述文件为 activemq.xml 配置文件部分内容。</p> <p>首先定义一个 mysql-ds 的 MySQL 数据源，然后在 persistenceAdapter 节点中配置 jdbcPersistenceAdapter 并且引用刚才定义的数据源。</p> <p>dataSource 指定持久化数据库的 bean，createTablesOnStartup 是否在启动的时候创建数 据表，默认值是 true，这样每次启动都会去创建数据表了，一般是第一次启动的时候设置为 true，之后改成 false。</p> <p><strong>Beans中添加</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;bean id=&quot;mysql-ds&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot; destroy-method=&quot;close&quot;&gt;

&lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;
&lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/activemq?relaxAutoCommit=true&quot;/&gt;
&lt;property name=&quot;username&quot; value=&quot;activemq&quot;/&gt;
&lt;property name=&quot;password&quot; value=&quot;activemq&quot;/&gt;
&lt;property name=&quot;maxActive&quot; value=&quot;200&quot;/&gt;
&lt;property name=&quot;poolPreparedStatements&quot; value=&quot;true&quot;/&gt;

&lt;/bean&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>修改persistenceAdapter</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>        &lt;persistenceAdapter&gt;
           &lt;!-- &lt;kahaDB directory=&quot;${activemq.data}/kahadb&quot;/&gt; --&gt;

		&lt;jdbcPersistenceAdapter dataSource=&quot;#mysql-ds&quot; createTablesOnStartup=&quot;true&quot; /&gt;


        &lt;/persistenceAdapter&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>依赖jar包</p> <p>commons-dbcp commons-pool mysql-connector-java</p> <h3 id="配置问题"><a href="#配置问题" class="header-anchor">#</a> 配置问题</h3> <p><code>com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: Specified key was too long; max key length is 767 bytes</code></p> <ul><li><p>问题分析</p> <p>mysql的varchar主键只支持不超过767个字节或者768/2=384个双字节 或者767/3=255个三字节的字段 而GBK是双字节的，UTF8是三字节的。</p></li></ul> <h3 id="表字段解释"><a href="#表字段解释" class="header-anchor">#</a> 表字段解释</h3> <p><strong>activemq_acks</strong>：用于存储订阅关系。如果是持久化Topic，订阅者和服务器的订阅关系在这个表保存。
主要的数据库字段如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>container：消息的destination
sub_dest：如果是使用static集群，这个字段会有集群其他系统的信息
client_id：每个订阅者都必须有一个唯一的客户端id用以区分
sub_name：订阅者名称
selector：选择器，可以选择只消费满足条件的消息。条件可以用自定义属性实现，可支持多属性and和or操作
last_acked_id：记录消费过的消息的id。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>activemq_lock</strong>：在集群环境中才有用，只有一个Broker可以获得消息，称为Master Broker，其他的只能作为备份等待Master Broker不可用，才可能成为下一个Master Broker。这个表用于记录哪个Broker是当前的Master Broker。</p> <p><strong>activemq_msgs</strong>：用于存储消息，Queue和Topic都存储在这个表中。
主要的数据库字段如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>id：自增的数据库主键
container：消息的destination
msgid_prod：消息发送者客户端的主键
msg_seq：是发送消息的顺序，msgid_prod+msg_seq可以组成jms的messageid
expiration：消息的过期时间，存储的是从1970-01-01到现在的毫秒数
msg：消息本体的java序列化对象的二进制数据
priority：优先级，从0-9，数值越大优先级越高
xid:用于存储订阅关系。如果是持久化topic，订阅者和服务器的订阅关系在这个表保存。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="leveldb存储"><a href="#leveldb存储" class="header-anchor">#</a> LevelDB存储</h2> <p>LevelDB持久化性能高于KahaDB，虽然目前默认的持久化方式仍然是KahaDB。并且，在ActiveMQ 5.9版本提供 了基于LevelDB和Zookeeper的数据复制方式，用于Master-slave方式的首选数据复制方案。 但是在ActiveMQ官网对LevelDB的表述：LevelDB官方建议使用以及不再支持，推荐使用的是KahaDB</p> <h2 id="memory-消息存储"><a href="#memory-消息存储" class="header-anchor">#</a> Memory 消息存储</h2> <p>顾名思义，基于内存的消息存储，就是消息存储在内存中。persistent=”false”,表示不设置持 久化存储，直接存储到内存中
在broker标签处设置。</p> <h2 id="jdbc-message-store-with-activemq-journal"><a href="#jdbc-message-store-with-activemq-journal" class="header-anchor">#</a> JDBC Message store with ActiveMQ Journal</h2> <p>这种方式克服了JDBC Store的不足，JDBC存储每次消息过来，都需要去写库和读库。 ActiveMQ Journal，使用延迟存储数据到数据库，当消息来到时先缓存到文件中，延迟后才写到数据库中。</p> <p>当消费者的消费速度能够及时跟上生产者消息的生产速度时，journal文件能够大大减少需要写入到DB中的消息。 举个例子，生产者生产了1000条消息，这1000条消息会保存到journal文件，如果消费者的消费速度很快的情况 下，在journal文件还没有同步到DB之前，消费者已经消费了90%的以上的消息，那么这个时候只需要同步剩余的 10%的消息到DB。 如果消费者的消费速度很慢，这个时候journal文件可以使消息以批量方式写到DB。</p> <h1 id="协议"><a href="#协议" class="header-anchor">#</a> 协议</h1> <p>完整支持的协议</p> <p>http://activemq.apache.org/configuring-version-5-transports.html</p> <p>ActiveMQ支持的client-broker通讯协议有：TCP、NIO、UDP、SSL、Http(s)、VM。</p> <h2 id="transmission-control-protocol-tcp"><a href="#transmission-control-protocol-tcp" class="header-anchor">#</a> Transmission Control Protocol (TCP)</h2> <p>1：这是默认的Broker配置，TCP的Client监听端口是61616。
2：在网络传输数据前，必须要序列化数据，消息是通过一个叫wire protocol的来序列化成字节流。默认情况下，ActiveMQ把wire protocol叫做OpenWire，它的目的是促使网络上的效率和数据快速交互。
3：TCP连接的URI形式：tcp://hostname:port?key=value&amp;key=value，加粗部分是必须的
4：TCP传输的优点：
(1)TCP协议传输可靠性高，稳定性强
(2)高效性：字节流方式传递，效率很高
(3)有效性、可用性：应用广泛，支持任何平台</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;transportConnector name=&quot;openwire&quot; uri=&quot;tcp://0.0.0.0:61616?maximumConnections=1000&amp;amp;wireFormat.maxFrameSize=104857600&quot;/&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="new-i-o-api-protocol-nio"><a href="#new-i-o-api-protocol-nio" class="header-anchor">#</a> New I/O API Protocol（NIO）</h2> <ul><li>NIO协议和TCP协议类似，但NIO更侧重于底层的访问操作。它允许开发人员对同一资源可有更多的client调用和服务端有更多的负载。</li> <li>适合使用NIO协议的场景：
<ul><li>可能有大量的Client去链接到Broker上一般情况下，大量的Client去链接Broker是被操作系统的线程数所限制的。因此，NIO的实现比TCP需要更少的线程去运行，所以建议使用NIO协议</li> <li>可能对于Broker有一个很迟钝的网络传输NIO比TCP提供更好的性能</li></ul></li> <li>NIO连接的URI形式：nio://hostname:port?key=value</li> <li>Transport Connector配置示例：</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;transportConnectors&gt;
　　&lt;transportConnector
　　　　name=&quot;tcp&quot;
　　　　uri=&quot;tcp://localhost:61616?trace=true&quot; /&gt;
　　&lt;transportConnector
　　　　name=&quot;nio&quot;
　　　　uri=&quot;nio://localhost:61618?trace=true&quot; /&gt;
&lt;/transportConnectors&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>上面的配置，示范了一个TCP协议监听61616端口，一个NIO协议监听61618端口</p> <h2 id="user-datagram-protocol-udp"><a href="#user-datagram-protocol-udp" class="header-anchor">#</a> User Datagram Protocol（UDP)</h2> <p>1：UDP和TCP的区别
(1)TCP是一个原始流的传递协议，意味着数据包是有保证的，换句话说，数据包是不会被复制和丢失的。UDP，另一方面，它是不会保证数据包的传递的
(2)TCP也是一个稳定可靠的数据包传递协议，意味着数据在传递的过程中不会被丢失。这样确保了在发送和接收之间能够可靠的传递。相反，UDP仅仅是一个链接协议，所以它没有可靠性之说
2：从上面可以得出：TCP是被用在稳定可靠的场景中使用的；UDP通常用在快速数据传递和不怕数据丢失的场景中，还有ActiveMQ通过防火墙时，只能用UDP
3：UDP连接的URI形式：udp://hostname:port?key=value
4：Transport Connector配置示例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;transportConnectors&gt;
    &lt;transportConnector
        name=&quot;udp&quot;
        uri=&quot;udp://localhost:61618?trace=true&quot; /&gt;
&lt;/transportConnectors&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="secure-sockets-layer-protocol-ssl"><a href="#secure-sockets-layer-protocol-ssl" class="header-anchor">#</a> Secure Sockets Layer Protocol (SSL)</h2> <p>1：连接的URI形式：ssl://hostname:port?key=value
2：Transport Connector配置示例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;transportConnectors&gt;
    &lt;transportConnector name=&quot;ssl&quot; uri=&quot;ssl://localhost:61617?trace=true&quot;/&gt;
&lt;/transportConnectors&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="hypertext-transfer-protocol-http-https"><a href="#hypertext-transfer-protocol-http-https" class="header-anchor">#</a> Hypertext Transfer Protocol (HTTP/HTTPS)</h2> <p>1：像web和email等服务需要通过防火墙来访问的，Http可以使用这种场合
2：连接的URI形式：http://hostname:port?key=value或者https://hostname:port?key=value
3：Transport Connector配置示例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;transportConnectors&gt;
    &lt;transportConnector name=&quot;http&quot; uri=&quot;http://localhost:8080?trace=true&quot; /&gt;
&lt;/transportConnectors&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="vm-protocol-vm"><a href="#vm-protocol-vm" class="header-anchor">#</a> VM Protocol（VM）</h2> <p>1、VM transport允许在VM内部通信，从而避免了网络传输的开销。这时候采用的连 接不是socket连接，而是直接的方法调用。</p> <p>2、第一个创建VM连接的客户会启动一个embed VM broker，接下来所有使用相同的 broker name的VM连接都会使用这个broker。当这个broker上所有的连接都关闭 的时候，这个broker也会自动关闭。</p> <p>3、连接的URI形式：vm://brokerName?key=value</p> <p>4、Java中嵌入的方式： vm:broker:(tcp://localhost:6000)?brokerName=embeddedbroker&amp;persistent=fal se ， 定义了一个嵌入的broker名称为embededbroker以及配置了一个 tcptransprotconnector在监听端口6000上</p> <p>5、使用一个加载一个配置文件来启动broker vm://localhost?brokerConfig=xbean:activemq.xml</p> <h1 id="helloworld"><a href="#helloworld" class="header-anchor">#</a> HelloWorld</h1> <h2 id="下载"><a href="#下载" class="header-anchor">#</a> 下载</h2> <p>http://activemq.apache.org/</p> <h2 id="安装启动"><a href="#安装启动" class="header-anchor">#</a> 安装启动</h2> <p>解压后直接执行</p> <p><code>bin/win64/activemq.bat</code></p> <h2 id="web控制台"><a href="#web控制台" class="header-anchor">#</a> web控制台</h2> <p>http://localhost:8161/</p> <p>通过8161端口访问</p> <p>admin/admin</p> <p>文件中配置，配置文件路径 install_path/config/jetty-realm.properties</p> <h2 id="修改访问端口"><a href="#修改访问端口" class="header-anchor">#</a> 修改访问端口</h2> <p>修改 ActiveMQ 配置文件:/usr/local/activemq/conf/jetty.xml</p> <p><strong>jettyport节点</strong></p> <p>配置文件修改完毕，保存并重新启动 ActiveMQ 服务。</p> <h2 id="开发"><a href="#开发" class="header-anchor">#</a> 开发</h2> <p>maven坐标</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;!-- https://mvnrepository.com/artifact/org.apache.activemq/activemq-all --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.apache.activemq&lt;/groupId&gt;
    &lt;artifactId&gt;activemq-all&lt;/artifactId&gt;
    &lt;version&gt;5.15.11&lt;/version&gt;
&lt;/dependency&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="sender"><a href="#sender" class="header-anchor">#</a> Sender</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>mashibing<span class="token punctuation">.</span>activemq01</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>jms<span class="token punctuation">.</span></span><span class="token class-name">Connection</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>jms<span class="token punctuation">.</span></span><span class="token class-name">Destination</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>jms<span class="token punctuation">.</span></span><span class="token class-name">JMSException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>jms<span class="token punctuation">.</span></span><span class="token class-name">MessageProducer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>jms<span class="token punctuation">.</span></span><span class="token class-name">Queue</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>jms<span class="token punctuation">.</span></span><span class="token class-name">Session</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>jms<span class="token punctuation">.</span></span><span class="token class-name">TextMessage</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>activemq<span class="token punctuation">.</span></span><span class="token class-name">ActiveMQConnectionFactory</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Sender</span> <span class="token punctuation">{</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
		<span class="token comment">// 1. 建立工厂对象，</span>
		<span class="token class-name">ActiveMQConnectionFactory</span> activeMQConnectionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActiveMQConnectionFactory</span><span class="token punctuation">(</span>
				<span class="token class-name">ActiveMQConnectionFactory</span><span class="token punctuation">.</span>DEFAULT_USER<span class="token punctuation">,</span>
				<span class="token class-name">ActiveMQConnectionFactory</span><span class="token punctuation">.</span>DEFAULT_PASSWORD<span class="token punctuation">,</span>
				<span class="token string">&quot;tcp://localhost:61616&quot;</span>
				<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//2 从工厂里拿一个连接</span>
		<span class="token class-name">Connection</span> connection <span class="token operator">=</span> activeMQConnectionFactory<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		connection<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//3 从连接中获取Session(会话)</span>
		<span class="token class-name">Session</span> session <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createSession</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token class-name">Session</span><span class="token punctuation">.</span>AUTO_ACKNOWLEDGE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 从会话中获取目的地(Destination)消费者会从这个目的地取消息</span>
		<span class="token class-name">Queue</span> queue <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">createQueue</span><span class="token punctuation">(</span><span class="token string">&quot;f&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//从会话中创建消息提供者</span>
		<span class="token class-name">MessageProducer</span> producer <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">createProducer</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//从会话中创建文本消息(也可以创建其它类型的消息体)</span>

		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">TextMessage</span> message <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">createTextMessage</span><span class="token punctuation">(</span><span class="token string">&quot;msg: &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 通过消息提供者发送消息到ActiveMQ</span>
			<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 关闭连接</span>
		connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;exit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h3 id="receiver"><a href="#receiver" class="header-anchor">#</a> Receiver</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>mashibing<span class="token punctuation">.</span>activemq01</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>jms<span class="token punctuation">.</span></span><span class="token class-name">Connection</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>jms<span class="token punctuation">.</span></span><span class="token class-name">Destination</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>jms<span class="token punctuation">.</span></span><span class="token class-name">JMSException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>jms<span class="token punctuation">.</span></span><span class="token class-name">Message</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>jms<span class="token punctuation">.</span></span><span class="token class-name">MessageConsumer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>jms<span class="token punctuation">.</span></span><span class="token class-name">MessageProducer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>jms<span class="token punctuation">.</span></span><span class="token class-name">Queue</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>jms<span class="token punctuation">.</span></span><span class="token class-name">Session</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>jms<span class="token punctuation">.</span></span><span class="token class-name">TextMessage</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>activemq<span class="token punctuation">.</span></span><span class="token class-name">ActiveMQConnectionFactory</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Receiver</span> <span class="token punctuation">{</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
		<span class="token comment">// 1. 建立工厂对象，</span>
		<span class="token class-name">ActiveMQConnectionFactory</span> activeMQConnectionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActiveMQConnectionFactory</span><span class="token punctuation">(</span>
				<span class="token class-name">ActiveMQConnectionFactory</span><span class="token punctuation">.</span>DEFAULT_USER<span class="token punctuation">,</span>
				<span class="token class-name">ActiveMQConnectionFactory</span><span class="token punctuation">.</span>DEFAULT_PASSWORD<span class="token punctuation">,</span>
				<span class="token string">&quot;tcp://localhost:61616&quot;</span>
				<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//2 从工厂里拿一个连接</span>
		<span class="token class-name">Connection</span> connection <span class="token operator">=</span> activeMQConnectionFactory<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		connection<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//3 从连接中获取Session(会话)</span>
		<span class="token class-name">Session</span> session <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createSession</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token class-name">Session</span><span class="token punctuation">.</span>AUTO_ACKNOWLEDGE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 从会话中获取目的地(Destination)消费者会从这个目的地取消息</span>
		<span class="token class-name">Queue</span> queue <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">createQueue</span><span class="token punctuation">(</span><span class="token string">&quot;f&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//从会话中创建消息提供者</span>
		<span class="token class-name">MessageConsumer</span> consumer <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">createConsumer</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//从会话中创建文本消息(也可以创建其它类型的消息体)</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">TextMessage</span> receive <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">TextMessage</span><span class="token punctuation">)</span>consumer<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;TextMessage:&quot;</span> <span class="token operator">+</span> receive<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h1 id="active-mq的安全机制"><a href="#active-mq的安全机制" class="header-anchor">#</a> Active MQ的安全机制</h1> <h2 id="web控制台安全"><a href="#web控制台安全" class="header-anchor">#</a> web控制台安全</h2> <p>$home/conf/jetty-realm.properties</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># username: password [,rolename ...]
admin: admin, admin
user: user, user
yiming: 123, user
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>用户名：密码，角色</p> <p>注意: 配置需重启ActiveMQ才会生效。</p> <h2 id="消息安全机制"><a href="#消息安全机制" class="header-anchor">#</a> 消息安全机制</h2> <p>修改 activemq.xml</p> <p>在123行     &lt;/broker&gt; 节点中添加</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>simpleAuthenticationPlugin</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>users</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>authenticationUser</span> <span class="token attr-name">username</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>admin<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>admin<span class="token punctuation">&quot;</span></span> <span class="token attr-name">groups</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>admins,publishers,consumers<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>authenticationUser</span> <span class="token attr-name">username</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>publisher<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>publisher<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">groups</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>publishers,consumers<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>authenticationUser</span> <span class="token attr-name">username</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>consumer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>consumer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">groups</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>consumers<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>authenticationUser</span> <span class="token attr-name">username</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>guest<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>guest<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">groups</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>guests<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>users</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>simpleAuthenticationPlugin</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h1 id="常用api"><a href="#常用api" class="header-anchor">#</a> 常用API</h1> <h2 id="事务"><a href="#事务" class="header-anchor">#</a> 事务</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>session.commit();
session.rollback();
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>用来提交/回滚事务</p> <h2 id="purge"><a href="#purge" class="header-anchor">#</a> Purge</h2> <p>清理消息</p> <h2 id="签收模式"><a href="#签收模式" class="header-anchor">#</a> 签收模式</h2> <p>签收代表接收端的session已收到消息的一次确认，反馈给broker</p> <p>ActiveMQ支持自动签收与手动签收</p> <h3 id="session-auto-acknowledge"><a href="#session-auto-acknowledge" class="header-anchor">#</a> Session.AUTO_ACKNOWLEDGE</h3> <p>当客户端从receiver或onMessage成功返回时，Session自动签收客户端的这条消息的收条。</p> <h3 id="session-client-acknowledge"><a href="#session-client-acknowledge" class="header-anchor">#</a> Session.CLIENT_ACKNOWLEDGE</h3> <p>客户端通过调用消息(Message)的acknowledge方法签收消息。在这种情况下，签收发生在Session层面：签收一个已经消费的消息会自动地签收这个Session所有已消费的收条。</p> <h3 id="session-dups-ok-acknowledge"><a href="#session-dups-ok-acknowledge" class="header-anchor">#</a> Session.DUPS_OK_ACKNOWLEDGE</h3> <p>Session不必确保对传送消息的签收，这个模式可能会引起消息的重复，但是降低了Session的开销，所以只有客户端能容忍重复的消息，才可使用。</p> <h3 id="session-session-transacted"><a href="#session-session-transacted" class="header-anchor">#</a> <strong>Session.SESSION_TRANSACTED</strong></h3> <h2 id="持久化"><a href="#持久化" class="header-anchor">#</a> 持久化</h2> <p>默认持久化是开启的</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>producer.setDeliveryMode(DeliveryMode.NON_PERSISTENT)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="优先级"><a href="#优先级" class="header-anchor">#</a> 优先级</h2> <p>可以打乱消费顺序</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>producer.setPriority
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>配置文件需要指定使用优先级的目的地</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;policyEntry queue=&quot;queue1&quot; prioritizedMessages=&quot;true&quot; /&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="消息超时-过期"><a href="#消息超时-过期" class="header-anchor">#</a> 消息超时/过期</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>producer.setTimeToLive
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>设置了消息超时的消息，消费端在超时后无法在消费到此消息。</p> <p>给消息设置一个超时时间 -&gt; 死信队列 -&gt; 拿出来 -&gt; 重发</p> <h3 id="死信"><a href="#死信" class="header-anchor">#</a> 死信</h3> <p>此类消息会进入到<code>ActiveMQ.DLQ</code>队列且不会自动清除，称为死信</p> <p>此处有消息堆积的风险</p> <h3 id="修改死信队列名称"><a href="#修改死信队列名称" class="header-anchor">#</a> 修改死信队列名称</h3> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>			  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>policyEntry</span> <span class="token attr-name">queue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>f<span class="token punctuation">&quot;</span></span> <span class="token attr-name">prioritizedMessages</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>deadLetterStrategy</span><span class="token punctuation">&gt;</span></span>

					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>individualDeadLetterStrategy</span>   <span class="token attr-name">queuePrefix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DLxxQ.<span class="token punctuation">&quot;</span></span> <span class="token attr-name">useQueueForQueueMessages</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>deadLetterStrategy</span><span class="token punctuation">&gt;</span></span>
			  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>policyEntry</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>useQueueForQueueMessages: 设置使用队列保存死信，还可以设置useQueueForTopicMessages，使用Topic来保存死信</p> <h3 id="让非持久化的消息也进入死信队列"><a href="#让非持久化的消息也进入死信队列" class="header-anchor">#</a> 让非持久化的消息也进入死信队列</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;individualDeadLetterStrategy   queuePrefix=&quot;DLxxQ.&quot; useQueueForQueueMessages=&quot;true&quot;  processNonPersistent=&quot;true&quot; /&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>processNonPersistent=&quot;true&quot;</p> <h3 id="过期消息不进死信队列"><a href="#过期消息不进死信队列" class="header-anchor">#</a> 过期消息不进死信队列</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;individualDeadLetterStrategy   processExpired=&quot;false&quot;  /&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="独占消费者"><a href="#独占消费者" class="header-anchor">#</a> 独占消费者</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>	Queue queue = session.createQueue(&quot;xxoo?consumer.exclusive=true&quot;);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>还可以设置优先级</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Queue queue = session.createQueue(&quot;xxoo?consumer.exclusive=true&amp;consumer.priority=10&quot;);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h1 id="消息类型"><a href="#消息类型" class="header-anchor">#</a> 消息类型</h1> <h2 id="object"><a href="#object" class="header-anchor">#</a> object</h2> <h3 id="发送端"><a href="#发送端" class="header-anchor">#</a> 发送端</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code>		<span class="token class-name">Girl</span> girl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Girl</span><span class="token punctuation">(</span><span class="token string">&quot;qiqi&quot;</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token number">398.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token class-name">Message</span> message <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">createObjectMessage</span><span class="token punctuation">(</span>girl<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="接受端"><a href="#接受端" class="header-anchor">#</a> 接受端</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code>		<span class="token keyword">if</span><span class="token punctuation">(</span>message <span class="token keyword">instanceof</span> <span class="token class-name">ActiveMQObjectMessage</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

			<span class="token class-name">Girl</span> girl <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Girl</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ActiveMQObjectMessage</span><span class="token punctuation">)</span>message<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>girl<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>girl<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>如果遇到此类报错</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Exception in thread &quot;main&quot; javax.jms.JMSException: Failed to build body from content. Serializable class not available to broker. Reason: java.lang.ClassNotFoundException: Forbidden class com.mashibing.mq.Girl! This class is not trusted to be serialized as ObjectMessage payload. Please take a look at http://activemq.apache.org/objectmessage.html for more information on how to configure trusted classes.
	at org.apache.activemq.util.JMSExceptionSupport.create(JMSExceptionSupport.java:36)
	at org.apache.activemq.command.ActiveMQObjectMessage.getObject(ActiveMQObjectMessage.java:213)
	at com.mashibing.mq.Receiver.main(Receiver.java:65)
Caused by: java.lang.ClassNotFoundException: Forbidden class com.mashibing.mq.Girl! This class is not trusted to be serialized as ObjectMessage payload. Please take a look at http://activemq.apache.org/objectmessage.html for more information on how to configure trusted classes.
	at org.apache.activemq.util.ClassLoadingAwareObjectInputStream.checkSecurity(ClassLoadingAwareObjectInputStream.java:112)
	at org.apache.activemq.util.ClassLoadingAwareObjectInputStream.resolveClass(ClassLoadingAwareObjectInputStream.java:57)
	at java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:1868)
	at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1751)
	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2042)
	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1573)
	at java.io.ObjectInputStream.readObject(ObjectInputStream.java:431)
	at org.apache.activemq.command.ActiveMQObjectMessage.getObject(ActiveMQObjectMessage.java:211)
	... 1 more
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>需要添加信任</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>		connectionFactory.setTrustedPackages(
				new ArrayList&lt;String&gt;(
						Arrays.asList(
								new String[]{
										Girl.class.getPackage().getName()
										}

								)
						)

				);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="bytesmessage"><a href="#bytesmessage" class="header-anchor">#</a> bytesMessage</h2> <h3 id="发送端-2"><a href="#发送端-2" class="header-anchor">#</a> 发送端</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>		BytesMessage bytesMessage = session.createBytesMessage();
        bytesMessage.writeBytes(&quot;str&quot;.getBytes());
        bytesMessage.writeUTF(&quot;哈哈&quot;);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="接受端-2"><a href="#接受端-2" class="header-anchor">#</a> 接受端</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code>		<span class="token keyword">if</span><span class="token punctuation">(</span>message <span class="token keyword">instanceof</span> <span class="token class-name">BytesMessage</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">BytesMessage</span> bm <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">BytesMessage</span><span class="token punctuation">)</span>message<span class="token punctuation">;</span>

			 <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
             <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> bm<span class="token punctuation">.</span><span class="token function">readBytes</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                 <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>还可以使用ActiveMQ给提供的便捷方法,但要注意读取和写入的顺序</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>bm.readBoolean()
bm.readUTF()
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="写入文件"><a href="#写入文件" class="header-anchor">#</a> 写入文件</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>                    FileOutputStream out = null;
                    try {
                        out = new FileOutputStream(&quot;d:/aa.txt&quot;);
                    } catch (FileNotFoundException e2) {
                        e2.printStackTrace();
                    }
                    byte[] by = new byte[1024];
                    int len = 0 ;
                    try {
                        while((len = bm.readBytes(by))!= -1){
                            out.write(by,0,len);
                        }
                    } catch (Exception e1) {
                        e1.printStackTrace();
                    }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="mapmessage"><a href="#mapmessage" class="header-anchor">#</a> MapMessage</h2> <h3 id="发送端-3"><a href="#发送端-3" class="header-anchor">#</a> 发送端</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code>		<span class="token class-name">MapMessage</span> mapMessage <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">createMapMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


		mapMessage<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;lucy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mapMessage<span class="token punctuation">.</span><span class="token function">setBoolean</span><span class="token punctuation">(</span><span class="token string">&quot;yihun&quot;</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		mapMessage<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>mapMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="接收端"><a href="#接收端" class="header-anchor">#</a> 接收端</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>		Message message = consumer.receive();
		MapMessage mes = (MapMessage) message;

		System.out.println(mes);

		System.out.println(mes.getString(&quot;name&quot;));
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h1 id="消息发送原理"><a href="#消息发送原理" class="header-anchor">#</a> 消息发送原理</h1> <h2 id="同步与异步"><a href="#同步与异步" class="header-anchor">#</a> 同步与异步</h2> <table><thead><tr><th></th> <th>开启事务</th> <th>关闭事务</th></tr></thead> <tbody><tr><td>持久化</td> <td>异步</td> <td>同步</td></tr> <tr><td>非持久化</td> <td>异步</td> <td>异步</td></tr> <tr><td></td> <td></td> <td></td></tr> <tr><td></td> <td></td> <td></td></tr></tbody></table> <p>我们可以通过以下几种方式来设置异步发送：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>		<span class="token class-name">ActiveMQConnectionFactory</span> connectionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActiveMQConnectionFactory</span><span class="token punctuation">(</span>
				<span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span>
				<span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span>
				<span class="token string">&quot;tcp://localhost:61616&quot;</span>
				<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 2.获取一个向ActiveMQ的连接</span>
		connectionFactory<span class="token punctuation">.</span><span class="token function">setUseAsyncSend</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">ActiveMQConnection</span> connection <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ActiveMQConnection</span><span class="token punctuation">)</span>connectionFactory<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		connection<span class="token punctuation">.</span><span class="token function">setUseAsyncSend</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="消息堆积"><a href="#消息堆积" class="header-anchor">#</a> 消息堆积</h2> <p>producer每发送一个消息，统计一下发送的字节数，当字节数达到ProducerWindowSize值时，需要等待broker的确认，才能继续发送。</p> <p>brokerUrl中设置: <code>tcp://localhost:61616?jms.producerWindowSize=1048576</code></p> <p>destinationUri中设置: <code>myQueue?producer.windowSize=1048576</code></p> <h2 id="延迟消息投递"><a href="#延迟消息投递" class="header-anchor">#</a> 延迟消息投递</h2> <p>首先在配置文件中开启延迟和调度</p> <p><strong>schedulerSupport=&quot;true&quot;</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    &lt;broker xmlns=&quot;http://activemq.apache.org/schema/core&quot; brokerName=&quot;localhost&quot; dataDirectory=&quot;${activemq.data}&quot; schedulerSupport=&quot;true&quot;&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="延迟发送"><a href="#延迟发送" class="header-anchor">#</a> 延迟发送</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>message.setLongProperty(ScheduledMessage.AMQ_SCHEDULED_DELAY, 10*1000);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="带间隔的重复发送"><a href="#带间隔的重复发送" class="header-anchor">#</a> 带间隔的重复发送</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>		long delay = 10 * 1000;
		long period = 2 * 1000;
		int repeat = 9;
		message.setLongProperty(ScheduledMessage.AMQ_SCHEDULED_DELAY, delay);
		message.setLongProperty(ScheduledMessage.AMQ_SCHEDULED_PERIOD, period);
		message.setIntProperty(ScheduledMessage.AMQ_SCHEDULED_REPEAT, repeat);
		createProducer.send(message);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="cron表达式定时发送"><a href="#cron表达式定时发送" class="header-anchor">#</a> Cron表达式定时发送</h2> <p>Cron表达式是一个字符串，字符串以5或6个空格隔开，分为6或7个域，每一个域代表一个含义，Cron有如下两种语法格式：</p> <p><em>Seconds Minutes Hours DayofMonth Month DayofWeek Year或</em></p> <p>Seconds Minutes Hours DayofMonth Month DayofWeek</p> <p>每一个域可出现的字符如下：</p> <p>Seconds:可出现&quot;, - * /&quot;四个字符，有效范围为0-59的整数</p> <p>Minutes:可出现&quot;, - * /&quot;四个字符，有效范围为0-59的整数</p> <p>Hours:可出现&quot;, - * /&quot;四个字符，有效范围为0-23的整数</p> <p>DayofMonth:可出现&quot;, - * / ? L W C&quot;八个字符，有效范围为0-31的整数</p> <p>Month:可出现&quot;, - * /&quot;四个字符，有效范围为1-12的整数或JAN-DEc</p> <p>DayofWeek:可出现&quot;, - * / ? L C #&quot;四个字符，有效范围为1-7的整数或SUN-SAT两个范围。1表示星期天，2表示星期一， 依次类推</p> <p>Year:可出现&quot;, - * /&quot;四个字符，有效范围为1970-2099年</p> <p>每一个域都使用数字，但还可以出现如下特殊字符，它们的含义是：</p> <p>(1)<em>：表示匹配该域的任意值，假如在Minutes域使用</em>, 即表示每分钟都会触发事件。</p> <p>(2)?:只能用在DayofMonth和DayofWeek两个域。它也匹配域的任意值，但实际不会。因为DayofMonth和 DayofWeek会相互影响。例如想在每月的20日触发调度，不管20日到底是星期几，则只能使用如下写法： 13 13 15 20 * ?, 其中最后一位只能用？，而不能使用*，如果使用*表示不管星期几都会触发，实际上并不是这样。</p> <p>(3)-:表示范围，例如在Minutes域使用5-20，表示从5分到20分钟每分钟触发一次</p> <p>(4)/：表示起始时间开始触发，然后每隔固定时间触发一次，例如在Minutes域使用5/20,则意味着5分钟触发一次，而25，45等分别触发一次.</p> <p>(5),:表示列出枚举值值。例如：在Minutes域使用5,20，则意味着在5和20分每分钟触发一次。</p> <p>(6)L:表示最后，只能出现在DayofWeek和DayofMonth域，如果在DayofWeek域使用5L,意味着在最后的一个星期四触发。</p> <p>(7)W: 表示有效工作日(周一到周五),只能出现在DayofMonth域，系统将在离指定日期的最近的有效工作日触发事件。例如：在 DayofMonth使用5W，如果5日是星期六，则将在最近的工作日：星期五，即4日触发。如果5日是星期天，则在6日(周一)触发；如果5日在星期一 到星期五中的一天，则就在5日触发。另外一点，W的最近寻找不会跨过月份</p> <p>(8)LW:这两个字符可以连用，表示在某个月最后一个工作日，即最后一个星期五。</p> <p>(9)#:用于确定每个月第几个星期几，只能出现在DayofMonth域。例如在4#2，表示某月的第二个星期三。</p> <p>举几个例子:</p> <p>0 0 2 1 * ? * 表示在每月的1日的凌晨2点调度任务</p> <p>0 15 10 ? * MON-FRI 表示周一到周五每天上午10：15执行作业</p> <p>0 15 10 ? 6L 2002-2006 表示2002-2006年的每个月的最后一个星期五上午10:15执行作</p> <p>一个cron表达式有至少6个（也可能7个）有空格分隔的时间元素。</p> <p>按顺序依次为</p> <p>秒（0~59）</p> <p>分钟（0~59）</p> <p>小时（0~23）</p> <p>天（月）（0~31，但是你需要考虑你月的天数）</p> <p>月（0~11）</p> <p>天（星期）（1~7 1=SUN 或 SUN，MON，TUE，WED，THU，FRI，SAT）</p> <p>年份（1970－2099）</p> <p>其中每个元素可以是一个值(如6),一个连续区间(9-12),一个间隔时间(8-18/4)(/表示每隔4小时),一个列表(1,3,5),通配符。由于&quot;月份中的日期&quot;和&quot;星期中的日期&quot;这两个元素互斥的,必须要对其中一个设置?</p> <p>0 0 10,14,16 * * ? 每天上午10点，下午2点，4点</p> <p>0 0/30 9-17 * * ? 朝九晚五工作时间内每半小时</p> <p>0 0 12 ? * WED 表示每个星期三中午12点</p> <p>&quot;0 0 12 * * ?&quot; 每天中午12点触发</p> <p>&quot;0 15 10 ? * *&quot; 每天上午10:15触发</p> <p>&quot;0 15 10 * * ?&quot; 每天上午10:15触发</p> <p>&quot;0 15 10 * * ? *&quot; 每天上午10:15触发</p> <p>&quot;0 15 10 * * ? 2005&quot; 2005年的每天上午10:15触发</p> <p>&quot;0 * 14 * * ?&quot; 在每天下午2点到下午2:59期间的每1分钟触发</p> <p>&quot;0 0/5 14 * * ?&quot; 在每天下午2点到下午2:55期间的每5分钟触发</p> <p>&quot;0 0/5 14,18 * * ?&quot; 在每天下午2点到2:55期间和下午6点到6:55期间的每5分钟触发</p> <p>&quot;0 0-5 14 * * ?&quot; 在每天下午2点到下午2:05期间的每1分钟触发</p> <p>&quot;0 10,44 14 ? 3 WED&quot; 每年三月的星期三的下午2:10和2:44触发</p> <p>&quot;0 15 10 ? * MON-FRI&quot; 周一至周五的上午10:15触发</p> <p>&quot;0 15 10 15 * ?&quot; 每月15日上午10:15触发</p> <p>&quot;0 15 10 L * ?&quot; 每月最后一日的上午10:15触发</p> <p>&quot;0 15 10 ? * 6L&quot; 每月的最后一个星期五上午10:15触发</p> <p>&quot;0 15 10 ? * 6L 2002-2005&quot; 2002年至2005年的每月的最后一个星期五上午10:15触发</p> <p>&quot;0 15 10 ? * 6#3&quot; 每月的第三个星期五上午10:15触发</p> <h1 id="监听器"><a href="#监听器" class="header-anchor">#</a> 监听器</h1> <p>可以使用监听器来处理消息接收</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>consumer.setMessageListener(new MyListener());
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>需要实现接口MessageListener</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class MyListener implements MessageListener {

	public void onMessage(Message message) {
		// TODO Auto-generated method stub
		TextMessage textMessage = (TextMessage)message;
		try {
			System.out.println(&quot;xxoo&quot; + textMessage.getText());
		} catch (JMSException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}

}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>当收到消息后会调起onMessage方法</p> <h1 id="消息过滤"><a href="#消息过滤" class="header-anchor">#</a> 消息过滤</h1> <h2 id="消息发送"><a href="#消息发送" class="header-anchor">#</a> 消息发送</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>		MapMessage msg1 = session.createMapMessage();
		msg1.setString(&quot;name&quot;, &quot;qiqi&quot;);
		msg1.setString(&quot;age&quot;, &quot;18&quot;);

		msg1.setStringProperty(&quot;name&quot;, &quot;qiqi&quot;);
		msg1.setIntProperty(&quot;age&quot;, 18);
		MapMessage msg2 = session.createMapMessage();
		msg2.setString(&quot;name&quot;, &quot;lucy&quot;);
		msg2.setString(&quot;age&quot;, &quot;18&quot;);
		msg2.setStringProperty(&quot;name&quot;, &quot;lucy&quot;);
		msg2.setIntProperty(&quot;age&quot;, 18);
		MapMessage msg3 = session.createMapMessage();
		msg3.setString(&quot;name&quot;, &quot;qianqian&quot;);
		msg3.setString(&quot;age&quot;, &quot;17&quot;);
		msg3.setStringProperty(&quot;name&quot;, &quot;qianqian&quot;);
		msg3.setIntProperty(&quot;age&quot;, 17);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="消息接收"><a href="#消息接收" class="header-anchor">#</a> 消息接收</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>
		String selector1 = &quot;age &gt; 17&quot;;
		String selector2 = &quot;name = 'lucy'&quot;;
		MessageConsumer consumer = session.createConsumer(queue,selector2);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h1 id="整合springboot"><a href="#整合springboot" class="header-anchor">#</a> 整合SpringBoot</h1> <h2 id="配置文件"><a href="#配置文件" class="header-anchor">#</a> 配置文件</h2> <h3 id="pom"><a href="#pom" class="header-anchor">#</a> POM</h3> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
	<span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.3.BUILD-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/&gt;</span></span> <span class="token comment">&lt;!-- lookup parent from repository --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.mashibing.arika<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>mq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>Demo project for Spring Boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>


		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.junit.vintage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit-vintage-engine<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-activemq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>


		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.messaginghub<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>pooled-jms<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-pool2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repositories</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>spring-milestones<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>Spring Milestones<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://repo.spring.io/milestone<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>spring-snapshots<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>Spring Snapshots<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://repo.spring.io/snapshot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>snapshots</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enabled</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>enabled</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>snapshots</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repositories</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pluginRepositories</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pluginRepository</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>spring-milestones<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>Spring Milestones<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://repo.spring.io/milestone<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pluginRepository</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pluginRepository</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>spring-snapshots<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>Spring Snapshots<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://repo.spring.io/snapshot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>snapshots</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enabled</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>enabled</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>snapshots</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pluginRepository</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pluginRepositories</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br></div></div><h3 id="yml"><a href="#yml" class="header-anchor">#</a> yml</h3> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">activemq</span><span class="token punctuation">:</span>
    <span class="token key atrule">broker-url</span><span class="token punctuation">:</span> tcp<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">61616</span>
    <span class="token key atrule">user</span><span class="token punctuation">:</span> admin
    <span class="token key atrule">password</span><span class="token punctuation">:</span> admin

    <span class="token key atrule">pool</span><span class="token punctuation">:</span>
      <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token comment">#连接池最大连接数</span>
      <span class="token key atrule">max-connections</span><span class="token punctuation">:</span> <span class="token number">5</span>
      <span class="token comment">#空闲的连接过期时间，默认为30秒</span>
      <span class="token key atrule">idle-timeout</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token key atrule">packages</span><span class="token punctuation">:</span>
      <span class="token key atrule">trust-all</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">jms</span><span class="token punctuation">:</span>
    <span class="token key atrule">pub-sub-domain</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="config类"><a href="#config类" class="header-anchor">#</a> Config类</h3> <p>用于生产ConnectionFactory</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>mashibing<span class="token punctuation">.</span>arika</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>jms<span class="token punctuation">.</span></span><span class="token class-name">ConnectionFactory</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>jms<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">EnableJms</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>jms<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">DefaultJmsListenerContainerFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>jms<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">JmsListenerContainerFactory</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableJms</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ActiveMqConfig</span> <span class="token punctuation">{</span>

	 <span class="token annotation punctuation">@Bean</span>
	    <span class="token keyword">public</span> <span class="token class-name">JmsListenerContainerFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">jmsListenerContainerTopic</span><span class="token punctuation">(</span><span class="token class-name">ConnectionFactory</span> activeMQConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	        <span class="token class-name">DefaultJmsListenerContainerFactory</span> bean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultJmsListenerContainerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	        bean<span class="token punctuation">.</span><span class="token function">setPubSubDomain</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	        bean<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>activeMQConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
	        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	    <span class="token comment">// queue模式的ListenerContainer</span>
	    <span class="token annotation punctuation">@Bean</span>
	    <span class="token keyword">public</span> <span class="token class-name">JmsListenerContainerFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">jmsListenerContainerQueue</span><span class="token punctuation">(</span><span class="token class-name">ConnectionFactory</span> activeMQConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	        <span class="token class-name">DefaultJmsListenerContainerFactory</span> bean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultJmsListenerContainerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	        bean<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>activeMQConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
	        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="收"><a href="#收" class="header-anchor">#</a> 收</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>	@JmsListener(destination = &quot;user&quot;,containerFactory = &quot;jmsListenerContainerQueue&quot;)
	   public void receiveStringQueue(String msg) {
        System.out.println(&quot;接收到消息....&quot; + msg);
    }

	@JmsListener(destination = &quot;ooo&quot;,containerFactory = &quot;jmsListenerContainerTopic&quot;)
	   public void receiveStringTopic(String msg) {
     System.out.println(&quot;接收到消息....&quot; + msg);
 }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="发"><a href="#发" class="header-anchor">#</a> 发</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.mashibing.arika;

import java.util.ArrayList;

import javax.jms.Connection;
import javax.jms.ConnectionFactory;
import javax.jms.JMSException;
import javax.jms.Message;
import javax.jms.MessageProducer;
import javax.jms.Queue;
import javax.jms.Session;
import javax.jms.TextMessage;

import org.apache.activemq.command.ActiveMQQueue;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jms.core.JmsMessagingTemplate;
import org.springframework.jms.core.JmsTemplate;
import org.springframework.jms.core.MessageCreator;
import org.springframework.scheduling.annotation.Scheduled;
import org.springframework.stereotype.Service;

@Service
public class MqProducerService {

	@Autowired
	private JmsMessagingTemplate jmsMessagingTemplate;




	public void sendStringQueue(String destination, String msg) {
		System.out.println(&quot;send...&quot;);
		ActiveMQQueue queue = new ActiveMQQueue(destination);
		jmsMessagingTemplate.afterPropertiesSet();

		ConnectionFactory factory = jmsMessagingTemplate.getConnectionFactory();

		try {
			Connection connection = factory.createConnection();
			connection.start();

			Session session = connection.createSession(true, Session.AUTO_ACKNOWLEDGE);
			Queue queue2 = session.createQueue(destination);

			MessageProducer producer = session.createProducer(queue2);

			TextMessage message = session.createTextMessage(&quot;hahaha&quot;);


			producer.send(message);
		} catch (JMSException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		jmsMessagingTemplate.convertAndSend(queue, msg);
	}
	public void sendStringQueueList(String destination, String msg) {
		System.out.println(&quot;xxooq&quot;);
		ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;();
		list.add(&quot;1&quot;);
		list.add(&quot;2&quot;);
		jmsMessagingTemplate.convertAndSend(new ActiveMQQueue(destination), list);
	}
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br></div></div><h1 id="linux下安装"><a href="#linux下安装" class="header-anchor">#</a> Linux下安装</h1> <p><strong>下载</strong></p> <p>wget https://mirrors.bfsu.edu.cn/apache//activemq/5.15.15/apache-activemq-5.15.15-bin.tar.gz</p> <p><strong>解压</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#解压
tar -zxvf apache-activemq-5.15.15-bin.tar.gz
#将源码移动到/usr/local/src目录下
mv apache-activemq-5.15.15 /usr/local/src/activemq-5.15.15
#创建软连接
ln -s /usr/local/src/activemq-5.15.15 /opt/activemq
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>注册成服务</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ln -s /opt/activemq/bin/activemq /etc/init.d/
chkconfig activemq on
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>服务管理</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>service activemq start
service activemq status
service activemq stop
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="nio配置"><a href="#nio配置" class="header-anchor">#</a> NIO配置</h2> <p>默认配置为tcp，使用的是bio</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> &lt;transportConnector name=&quot;openwire&quot; uri=&quot;tcp://0.0.0.0:61616?maximumConnections=1000&amp;amp;wireFormat.maxFrameSize=104857600&quot;/&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>http://activemq.apache.org/configuring-version-5-transports</p> <p>Nio是基于TCP的</p> <p>客户端使用连接时也应使用nio</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>		ActiveMQConnectionFactory connectionFactory = new ActiveMQConnectionFactory(
				&quot;admin&quot;,
				&quot;admin&quot;,
				&quot;nio://localhost:61617&quot;
				);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Auto + Nio</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;transportConnector name=&quot;auto+nio&quot; uri=&quot;auto+nio://localhost:5671&quot;/&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>自动适配协议</p> <h2 id="openwire-可用配置选项"><a href="#openwire-可用配置选项" class="header-anchor">#</a> OpenWire 可用配置选项</h2> <table><thead><tr><th>Option</th> <th>Default</th> <th>Description</th></tr></thead> <tbody><tr><td><code>cacheEnabled</code></td> <td><code>true</code></td> <td>Should commonly repeated values be cached so that less marshaling occurs?</td></tr> <tr><td><code>cacheSize</code></td> <td><code>1024</code></td> <td>When <code>cacheEnabled=true</code> then this parameter is used to specify the number of values to be cached.</td></tr> <tr><td><code>maxInactivityDuration</code></td> <td><code>30000</code></td> <td>The maximum <a href="http://activemq.apache.org/activemq-inactivitymonitor" target="_blank" rel="noopener noreferrer">inactivity<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> duration (before which the socket is considered dead) in milliseconds. On some platforms it can take a long time for a socket to die. Therefore allow the broker to kill connections when they have been inactive for the configured period of time. Used by some transports to enable a keep alive heart beat feature. Inactivity monitoring is disabled when set to a value <code>&lt;= 0</code>.</td></tr> <tr><td><code>maxInactivityDurationInitalDelay</code></td> <td><code>10000</code></td> <td>The initial delay before starting <a href="http://activemq.apache.org/activemq-inactivitymonitor" target="_blank" rel="noopener noreferrer">inactivity<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> checks. Yes, the word <code>'Inital'</code> is supposed to be misspelled like that.</td></tr> <tr><td><code>maxFrameSize</code></td> <td><code>MAX_LONG</code></td> <td>Maximum allowed frame size. Can help help prevent OOM DOS attacks.</td></tr> <tr><td><code>sizePrefixDisabled</code></td> <td><code>false</code></td> <td>Should the size of the packet be prefixed before each packet is marshaled?</td></tr> <tr><td><code>stackTraceEnabled</code></td> <td><code>true</code></td> <td>Should the stack trace of exception that occur on the broker be sent to the client?</td></tr> <tr><td><code>tcpNoDelayEnabled</code></td> <td><code>true</code></td> <td>Does not affect the wire format, but provides a hint to the peer that <code>TCP_NODELAY</code> should be enabled on the communications Socket.</td></tr> <tr><td><code>tightEncodingEnabled</code></td> <td><code>true</code></td> <td>Should wire size be optimized over CPU usage?</td></tr></tbody></table> <h2 id="transport-可用配置选项"><a href="#transport-可用配置选项" class="header-anchor">#</a> Transport 可用配置选项</h2> <table><thead><tr><th>Option Name</th> <th>Default Value</th> <th>Description</th></tr></thead> <tbody><tr><td>backlog</td> <td>5000</td> <td>Specifies the maximum number of connections waiting to be accepted by the transport server socket.</td></tr> <tr><td>closeAsync</td> <td>true</td> <td>If <strong><code>true</code></strong> the socket close call happens asynchronously. This parameter should be set to <strong><code>false</code></strong> for protocols like STOMP, that are commonly used in situations where a new connection is created for each read or write. Doing so ensures the socket close call happens synchronously. A synchronous close prevents the broker from running out of available sockets owing to the rapid cycling of connections.</td></tr> <tr><td>connectionTimeout</td> <td>30000</td> <td>If <strong><code>&gt;=1</code></strong> the value sets the connection timeout in milliseconds. A value of <strong><code>0</code></strong> denotes no timeout. Negative values are ignored.</td></tr> <tr><td>daemon</td> <td>false</td> <td>If <strong><code>true</code></strong> the transport thread will run in daemon mode. Set this parameter to <strong><code>true</code></strong> when embedding the broker in a Spring container or a web container to allow the container to shut down correctly.</td></tr> <tr><td>dynamicManagement</td> <td>false</td> <td>If <strong><code>true</code></strong> the <strong><code>TransportLogger</code></strong> can be managed by JMX.</td></tr> <tr><td>ioBufferSize</td> <td>8 * 1024</td> <td>Specifies the size of the buffer to be used between the TCP layer and the OpenWire layer where <strong><code>wireFormat</code></strong> based marshaling occurs.</td></tr> <tr><td>jmxPort</td> <td>1099</td> <td>(Client Only) Specifies the port that will be used by the JMX server to manage the <strong><code>TransportLoggers</code></strong>. This should only be set, via URI, by either a client producer or consumer as the broker creates its own JMX server. Specifying an alternate JMX port is useful for developers that test a broker and client on the same machine and need to control both via JMX.</td></tr> <tr><td>keepAlive</td> <td>false</td> <td>If <strong><code>true</code>,</strong> enables <a href="http://tldp.org/HOWTO/TCP-Keepalive-HOWTOoverview" target="_blank" rel="noopener noreferrer">TCP KeepAlive<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> on the broker connection to prevent connections from timing out at the TCP level. This should <em>not</em> be confused with <strong><code>KeepAliveInfo</code></strong> messages as used by the <strong><code>InactivityMonitor</code>.</strong></td></tr> <tr><td>logWriterName</td> <td>default</td> <td>Sets the name of the <strong><code>org.apache.activemq.transport.LogWriter</code></strong> implementation to use. Names are mapped to classes in the <strong><code>resources/META-INF/services/org/apache/activemq/transport/logwriters</code></strong> directory.</td></tr> <tr><td>maximumConnections</td> <td>Integer.MAX_VALUE</td> <td>The maximum number of sockets allowed for this broker.</td></tr> <tr><td>minmumWireFormatVersion</td> <td>0</td> <td>The minimum remote <strong><code>wireFormat</code></strong> version that will be accepted (note the misspelling). Note: when the remote <strong><code>wireFormat</code></strong> version is lower than the configured minimum acceptable version an exception will be thrown and the connection attempt will be refused. A value of <strong><code>0</code></strong> denotes no checking of the remote <strong><code>wireFormat</code></strong> version.</td></tr> <tr><td>socketBufferSize</td> <td>64 * 1024</td> <td>Sets the size, in bytes, for the accepted socket’s read and write buffers.</td></tr> <tr><td>soLinger</td> <td>Integer.MIN_VALUE</td> <td>Sets the socket’s option <strong><code>soLinger</code></strong> when the value is <strong><code>&gt; -1</code></strong>. When set to <strong><code>-1</code></strong> the <strong><code>soLinger</code></strong> socket option is disabled.</td></tr> <tr><td>soTimeout</td> <td>0</td> <td>Sets the socket’s read timeout in milliseconds. A value of <strong><code>0</code></strong> denotes no timeout.</td></tr> <tr><td>soWriteTimeout</td> <td>0</td> <td>Sets the socket’s write timeout in milliseconds. If the socket write operation does not complete before the specified timeout, the socket will be closed. A value of <strong>0</strong> denotes no timeout.</td></tr> <tr><td>stackSize</td> <td>0</td> <td>Set the stack size of the transport’s background reading thread. Must be specified in multiples of <strong><code>128K</code></strong>. A value of <strong><code>0</code></strong> indicates that this parameter is ignored.</td></tr> <tr><td>startLogging</td> <td>true</td> <td>If <strong><code>true</code></strong> the <strong><code>TransportLogger</code></strong> object of the Transport stack will initially write messages to the log. This parameter is ignored unless <strong><code>trace=true</code></strong>.</td></tr> <tr><td>tcpNoDelay</td> <td>false</td> <td>If <strong><code>true</code></strong> the socket’s option <strong><code>TCP_NODELAY</code></strong> is set. This disables Nagle’s algorithm for small packet transmission.</td></tr> <tr><td>threadName</td> <td>N/A</td> <td>When this parameter is specified the name of the thread is modified during the invocation of a transport. The remote address is appended so that a call stuck in a transport method will have the destination information in the thread name. This is extremely useful when using thread dumps for degugging.</td></tr> <tr><td>trace</td> <td>false</td> <td>Causes all commands that are sent over the transport to be logged. To view the logged output define the <strong><code>Log4j</code></strong> logger: <strong><code>log4j.logger.org.apache.activemq.transport.TransportLogger=DEBUG</code></strong>.</td></tr> <tr><td>trafficClass</td> <td>0</td> <td>The Traffic Class to be set on the socket.</td></tr> <tr><td>diffServ</td> <td>0</td> <td>(Client only) The preferred Differentiated Services traffic class to be set on outgoing packets, as described in RFC 2475. Valid integer values: <strong><code>[0,64]</code></strong>. Valid string values: <strong><code>EF</code>, <code>AF[1-3][1-4]</code></strong> or <strong><code>CS[0-7]</code></strong>. With JDK 6, only works when the JVM uses the IPv4 stack. To use the IPv4 stack set the system property <strong><code>java.net.preferIPv4Stack=true</code></strong>. Note: it’s invalid to specify both ‘<strong>diffServ</strong> and <strong>typeOfService</strong>’ at the same time as they share the same position in the TCP/IP packet headers</td></tr> <tr><td>typeOfService</td> <td>0</td> <td>(Client only) The preferred Type of Service value to be set on outgoing packets. Valid integer values: <strong><code>[0,256]</code></strong>. With JDK 6, only works when the JVM is configured to use the IPv4 stack. To use the IPv4 stack set the system property <strong><code>java.net.preferIPv4Stack=true</code></strong>. Note: it’s invalid to specify both ‘<strong>diffServ</strong> and <strong>typeOfService</strong>’ at the same time as they share the same position in the TCP/IP packet headers.</td></tr> <tr><td>useInactivityMonitor</td> <td>true</td> <td>When <strong><code>false</code></strong> the <strong><code>InactivityMonitor</code></strong> is disabled and connections will never time out.</td></tr> <tr><td>useKeepAlive</td> <td>true</td> <td>When <strong><code>true</code> <code>KeepAliveInfo</code></strong> messages are sent on an idle connection to prevent it from timing out. If this parameter is <strong><code>false</code></strong> connections will still timeout if no data was received on the connection for the specified amount of time.</td></tr> <tr><td>useLocalHost</td> <td>false</td> <td>When <strong><code>true</code></strong> local connections will be made using the value <strong><code>localhost</code></strong> instead of the actual local host name. On some operating systems, such as <strong><code>OS X</code></strong>, it’s not possible to connect as the local host name so <strong><code>localhost</code></strong> is better.</td></tr> <tr><td>useQueueForAccept</td> <td>true</td> <td>When <strong><code>true</code></strong> accepted sockets are placed onto a queue for asynchronous processing using a separate thread.</td></tr> <tr><td>wireFormat</td> <td>default</td> <td>The name of the <strong><code>wireFormat</code></strong> factory to use.</td></tr> <tr><td>wireFormat.*</td> <td>N/A</td> <td>Properties with this prefix are used to configure the <strong><code>wireFormat</code></strong>.</td></tr></tbody></table> <h1 id="activemq服务监控-hawtio"><a href="#activemq服务监控-hawtio" class="header-anchor">#</a> ActiveMQ服务监控 Hawtio</h1> <h2 id="官方网站"><a href="#官方网站" class="header-anchor">#</a> 官方网站</h2> <p>https://hawt.io/</p> <h2 id="部署"><a href="#部署" class="header-anchor">#</a> 部署</h2> <h3 id="独立jar包的形式运行"><a href="#独立jar包的形式运行" class="header-anchor">#</a> 独立jar包的形式运行</h3> <p>java -jar</p> <p>hawtio单程序运行，可以对多个远程ActiveMQ服务器进行监控</p> <h3 id="嵌入activemq"><a href="#嵌入activemq" class="header-anchor">#</a> 嵌入ActiveMQ</h3> <ul><li>下载war包</li> <li>复制到webapps下</li></ul> <p><strong>jetty.xml bean标签下添加</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>				&lt;bean class=&quot;org.eclipse.jetty.webapp.WebAppContext&quot;&gt;
					&lt;property name=&quot;contextPath&quot; value=&quot;/hawtio&quot; /&gt;
					&lt;property name=&quot;war&quot; value=&quot;${activemq.home}/webapps/hawtio.war&quot; /&gt;
					&lt;property name=&quot;logUrlOnStart&quot; value=&quot;true&quot; /&gt;
				&lt;/bean&gt;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>ActiveMQ.bat下添加</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>if &quot;%ACTIVEMQ_OPTS%&quot; == &quot;&quot; set ACTIVEMQ_OPTS=-Xms1G -Xmx1G -Dhawtio.realm=activemq -Dhawtio.role=admins -Dhawtio.rolePrincipalClasses=org.apache.activemq.jaas.GroupPrincipal -Djava.util.logging.config.file=logging.properties -Djava.security.auth.login.config=&quot;%ACTIVEMQ_CONF%\login.config&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h1 id="jms消息结构-message"><a href="#jms消息结构-message" class="header-anchor">#</a> JMS消息结构（Message）</h1> <p>Message主要由三部分组成，分别是Header，Properties，Body， 详细如下：</p> <table><thead><tr><th>Header</th> <th>消息头，所有类型的这部分格式都是一样的</th></tr></thead> <tbody><tr><td>Properties</td> <td>属性，按类型可以分为应用设置的属性，标准属性和消息中间件定义的属性</td></tr> <tr><td>Body</td> <td>消息正文，指我们具体需要消息传输的内容。</td></tr></tbody></table> <h2 id="header"><a href="#header" class="header-anchor">#</a> Header</h2> <p>JMS消息头使用的所有方法：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Message</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Destination</span> <span class="token function">getJMSDestination</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JMSException</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setJMSDestination</span><span class="token punctuation">(</span><span class="token class-name">Destination</span> destination<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JMSException</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getJMSDeliveryMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JMSException</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setJMSDeliveryMode</span><span class="token punctuation">(</span><span class="token keyword">int</span> deliveryMode<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JMSException</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getJMSMessageID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JMSException</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setJMSMessageID</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JMSException</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getJMSTimestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JMSException</span>'
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setJMSTimestamp</span><span class="token punctuation">(</span><span class="token keyword">long</span> timestamp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JMSException</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getJMSExpiration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JMSException</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setJMSExpiration</span><span class="token punctuation">(</span><span class="token keyword">long</span> expiration<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JMSException</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">getJMSRedelivered</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JMSException</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setJMSRedelivered</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> redelivered<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JMSException</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getJMSPriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JMSException</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setJMSPriority</span><span class="token punctuation">(</span><span class="token keyword">int</span> priority<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JMSException</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Destination</span> <span class="token function">getJMSReplyTo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JMSException</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setJMSReplyTo</span><span class="token punctuation">(</span><span class="token class-name">Destination</span> replyTo<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JMSException</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getJMScorrelationID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JMSException</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setJMSCorrelationID</span><span class="token punctuation">(</span><span class="token class-name">String</span> correlationID<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JMSException</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getJMSCorrelationIDAsBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JMSException</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setJMSCorrelationIDAsBytes</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> correlationID<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JMSException</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getJMSType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JMSException</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setJMSType</span><span class="token punctuation">(</span><span class="token class-name">String</span> type<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JMSException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><strong>消息头分为自动设置和手动设置的内容</strong></p> <h3 id="自动头信息"><a href="#自动头信息" class="header-anchor">#</a> 自动头信息</h3> <p>有一部分可以在创建Session和MessageProducer时设置</p> <table><thead><tr><th>属性名称</th> <th>说明</th> <th>设置者</th></tr></thead> <tbody><tr><td>JMSDeliveryMode</td> <td>消息的发送模式，分为<strong>NON_PERSISTENT</strong>和<strong>PERSISTENT</strong>，即非持久性模式的和持久性模式。默认设置为<strong>PERSISTENT（持久性）。<strong>一条</strong>持久性消息</strong>应该被传送一次（就一次），这就意味着如果JMS提供者出现故障，该消息并不会丢失； 它会在服务器恢复正常之后再次传送。一条<strong>非持久性消息</strong>最多只会传送一次，这意味着如果JMS提供者出现故障，该消息可能会永久丢失。在持久性和非持久性这两种传送模式中，消息服务器都不会将一条消息向同一消息者发送一次以上（成功算一次）。</td> <td>send</td></tr> <tr><td>JMSMessageID</td> <td>消息ID，需要以ID:开头，用于唯一地标识了一条消息</td> <td>send</td></tr> <tr><td>JMSTimestamp</td> <td>消息发送时的时间。这条消息头用于确定发送消息和它被消费者实际接收的时间间隔。时间戳是一个以毫秒来计算的Long类型时间值（自1970年1月1日算起）。</td> <td>send</td></tr> <tr><td>JMSExpiration</td> <td>消息的过期时间，以毫秒为单位，用来防止把过期的消息传送给消费者。任何直接通过编程方式来调用setJMSExpiration()方法都会被忽略。</td> <td>send</td></tr> <tr><td>JMSRedelivered</td> <td>消息是否重复发送过，如果该消息之前发送过，那么这个属性的值需要被设置为true, 客户端可以根据这个属性的值来确认这个消息是否重复发送过，以避免重复处理。</td> <td>Provider</td></tr> <tr><td>JMSPriority</td> <td>消息的优先级,0-4为普通的优化级，而5-9为高优先级，通常情况下，高优化级的消息需要优先发送。任何直接通过编程方式调用setJMSPriority()方法都将被忽略。</td> <td>send</td></tr> <tr><td>JMSDestination</td> <td>消息发送的目的地，是一个Topic或Queue</td> <td>send</td></tr></tbody></table> <p><strong>JMSDeliveryMode</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">MessageProducer</span> producer <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">createProducer</span><span class="token punctuation">(</span>topic<span class="token punctuation">)</span><span class="token punctuation">;</span>
producer<span class="token punctuation">.</span><span class="token function">setDeliveryMode</span><span class="token punctuation">(</span><span class="token class-name">DeliveryMode</span><span class="token punctuation">.</span>NON_PERSISTENT<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>JMSExpiration</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>		<span class="token comment">//将过期时间设置为1小时（1000毫秒 ＊60 ＊60）</span>
		producer<span class="token punctuation">.</span><span class="token function">setTimeToLive</span><span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>JMSPriority</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>producer.setPriority(9);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="手动头信息"><a href="#手动头信息" class="header-anchor">#</a> 手动头信息</h3> <table><thead><tr><th>属性名称</th> <th>说明</th> <th>设置者</th></tr></thead> <tbody><tr><td>JMSCorrelationID</td> <td>关联的消息ID，这个通常用在需要回传消息的时候</td> <td>client</td></tr> <tr><td>JMSReplyTo</td> <td>消息回复的目的地，其值为一个Topic或Queue, 这个由发送者设置，但是接收者可以决定是否响应</td> <td>client</td></tr> <tr><td>JMSType</td> <td>由消息发送者设置的消息类型，代表消息的结构，有的消息中间件可能会用到这个，但这个并不是是批消息的种类，比如TextMessage之类的</td> <td>client</td></tr></tbody></table> <p>从上表中我们可以看到，系统提供的标准头信息一共有10个属性，其中有6个是由send方法在调用时设置的，有三个是由客户端（client）设置的，还有一个是由消息中间件（Provider）设置的。</p> <p>需要注意的是，这里</p> <h1 id="下一代-activemq-6-artemis"><a href="#下一代-activemq-6-artemis" class="header-anchor">#</a> 下一代 ActiveMQ 6？Artemis</h1> <p>为下一代事件驱动的消息传递应用程序提供高性能、无阻塞的体系结构。</p> <ul><li>包含JNDI，具有完整的JMS 1.1 &amp; 2.0客户端实现</li> <li>高可用性共享存储、网络复制能力</li> <li>简单而强大的寻址模型协议</li> <li>灵活的负载均衡分配能力</li> <li>针对低延迟持久性和JDBC的高级日志实现</li> <li>与ActiveMQ 5的高功能奇偶校验，以简化迁移</li></ul> <p>官方文档：http://activemq.apache.org/components/artemis/migration</p> <ul><li>netty</li> <li>自己的存储</li> <li>优化传输流程</li> <li>更高的性能</li> <li>不再把所有的协议转换成openwire</li></ul> <h1 id="高级使用"><a href="#高级使用" class="header-anchor">#</a> 高级使用</h1> <h2 id="jmscorrelationid"><a href="#jmscorrelationid" class="header-anchor">#</a> JMSCorrelationID</h2> <p>用于消息之间的关联，给人一种会话的感觉</p> <hr> <h2 id="jmsreplyto"><a href="#jmsreplyto" class="header-anchor">#</a> <strong>JMSReplyTo</strong></h2> <p>发送方可以接受到消息消费确认的地址</p> <p>ActiveMQ5.10.x 以上版本必须使用 JDK1.8 才能正常使用。</p> <p>ActiveMQ5.9.x 及以下版本使用 JDK1.7 即可正常使用。</p> <h2 id="queue-browser"><a href="#queue-browser" class="header-anchor">#</a> queue browser</h2> <p>可以查看队列中的消息而不消费，没有订阅的功能</p> <h2 id="jmscorrelationid-2"><a href="#jmscorrelationid-2" class="header-anchor">#</a> JMSCorrelationID</h2> <p>用于消息之间的关联，给人一种会话的感觉</p> <p>http://activemq.apache.org/how-should-i-implement-request-response-with-jms.html</p> <hr> <h2 id="jmsreplyto-2"><a href="#jmsreplyto-2" class="header-anchor">#</a> <strong>JMSReplyTo</strong></h2> <p>发送方可以接受到消息消费确认的地址</p> <h2 id="queuerequestor同步消息"><a href="#queuerequestor同步消息" class="header-anchor">#</a> QueueRequestor同步消息</h2> <p>可以发送同步消息</p> <p>本质违背了mq的异步通讯原则</p> <p>但是mq还是能够提供应用解耦、异构系统的特性</p> <p>因为使用QueueRequestor发送消息后，会等待接收端的回复，如果收不到回复就会造成死等现象!而且该方法没有设置超时等待的功能</p> <h2 id="生产环境中影响性能的几个因素"><a href="#生产环境中影响性能的几个因素" class="header-anchor">#</a> 生产环境中影响性能的几个因素</h2> <h3 id="out-of-memory"><a href="#out-of-memory" class="header-anchor">#</a> Out of memory</h3> <p>activemq启动脚本中配置内存</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>%ACTIVEMQ_OPTS%&quot; == &quot;&quot; set ACTIVEMQ_OPTS=-Xms1G -Xmx1G
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>以及配置文件中的百分比</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;memoryUsage percentOfJvmHeap=&quot;70&quot; /&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>SystemUsage配置设置了一些系统内存和硬盘容量，当系统消耗超过这些容量设置时，amq会“slow down producer”，还是很重要的。</p> <h3 id="持久化和非持久化"><a href="#持久化和非持久化" class="header-anchor">#</a> 持久化和非持久化</h3> <h3 id="消息异步发送"><a href="#消息异步发送" class="header-anchor">#</a> 消息异步发送</h3> <p>建议使用默认，强制开启有可能丢失消息</p> <p>异步发送丢失消息的场景是：生产者设置UseAsyncSend=true，使用producer.send(msg)持续发送消息。由于消息不阻塞，生产者会认为所有send的消息均被成功发送至MQ。如果服务端突然宕机，此时生产者端内存中尚未被发送至MQ的消息都会丢失。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>new ActiveMQConnectionFactory(&quot;tcp://locahost:61616?jms.useAsyncSend=true&quot;);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>((ActiveMQConnectionFactory)connectionFactory).setUseAsyncSend(true);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>((ActiveMQConnection)connection).setUseAsyncSend(true)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="批量确认"><a href="#批量确认" class="header-anchor">#</a> 批量确认</h3> <p>ActiveMQ缺省支持批量确认消息，批量确认可以提高系统性能</p> <p><strong>关闭方法</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>new ActiveMQConnectionFactory(&quot;tcp://locahost:61616?jms.optimizeAcknowledge=false&quot;);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>((ActiveMQConnectionFactory)connectionFactory).setOptimizeAcknowledge(fase);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>((ActiveMQConnection)connection).setOptimizeAcknowledge(true);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="消费缓冲与消息积压prefetchsize"><a href="#消费缓冲与消息积压prefetchsize" class="header-anchor">#</a> 消费缓冲与消息积压prefetchSize</h2> <p>消费者端，一般来说消费的越快越好，broker的积压越小越好。</p> <p>但是考虑到事务性和客户端确认的情况，如果一个消费者一次获取到了很多消息却都不确认，这会造成事务上下文变大，broker端这种“半消费状态”的数据变多，所以ActiveMQ有一个prefetchSize参数来控制未确认情况下，最多可以预获取多少条记录。</p> <p><strong>Pre-fetch默认值</strong></p> <table><thead><tr><th>consumer type</th> <th>default value</th></tr></thead> <tbody><tr><td>queue</td> <td>1000</td></tr> <tr><td>queue browser</td> <td>500</td></tr> <tr><td>topic</td> <td>32766</td></tr> <tr><td>durable topic</td> <td>1000</td></tr></tbody></table> <h3 id="可以通过3中方式设置prefetchsize"><a href="#可以通过3中方式设置prefetchsize" class="header-anchor">#</a> 可以通过3中方式设置prefetchSize</h3> <p><strong>创建连接时整体设置</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>	ActiveMQConnectionFactory connectio nFactory = new ActiveMQConnectionFactory(
				&quot;admin&quot;,
				&quot;admin&quot;,
				&quot;tcp://localhost:5671?jms.prefetchPolicy.all=50&quot;
				);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>创建连接时对topic和queue单独设置</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>		ActiveMQConnectionFactory connectionFactory = new ActiveMQConnectionFactory(
				&quot;admin&quot;,
				&quot;admin&quot;,
				&quot;tcp://localhost:5671?jms.prefetchPolicy.queuePrefetch=1&amp;jms.prefetchPolicy.topicPrefetch=1&quot;
				);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>针对destination单独设置</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Destination topic = session.createTopic(&quot;user?consumer.prefetchSize=10&quot;);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>注意：对destination设置prefetchsize后会覆盖连接时的设置值</p> <h2 id="消息到底是推还是拉"><a href="#消息到底是推还是拉" class="header-anchor">#</a> 消息到底是推还是拉?</h2> <p>发送消息时是推向broker</p> <p>获取消息时：</p> <ul><li>默认是一条一条的推</li> <li>当customer的prefetchSize满的时候停止推消息</li> <li>当customer的prefetchSize ==0时 拉取消息</li></ul> <h2 id="eip-enterprise-integration-patterns"><a href="#eip-enterprise-integration-patterns" class="header-anchor">#</a> EIP Enterprise Integration Patterns.</h2> <p>EIP系统是以数据为基础，应用为核心，以实现业务及业务流程的自动化为目的多功能企业信息平台。为企业的信息化建设提供一种循序渐进，逐步优化的路径</p> <p><img src="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/img/image-20200207162242385.63e82400.png" alt="image-20200207162242385"></p> <p>一个围绕消息集成的企业应用集成场景基本在上面的图中描述的比较清楚的，简单说明如下</p> <p>1)消息发送方和接收方：可以是异构的业务系统，但是都需要提供Endpoint实现集成。
2)消息本身：两个应用系统通过channel连接，实现了消息本身的发送和接收操作
3)消息Channel：即消息传输的通道，消息本身必须要通过channel来实现传输，从源到达目标。
4)消息路由：当有多个目标接收方的时候，如果根据消息的特征来确定究竟发送到哪个接收方？
5)消息转换：消息在传输过程中是否需要进行转换和数据映射，包括报文格式转换和内容转换映射。
6)Pipe and Filter：在执行复杂的消息流处理时，如何维护消息本身的独立性和灵活性。</p> <p>常用实现Camel</p> <p>支持ActiveMQ、RabbitMQ、kafka、WebService</p> <p><strong>camel实现了客户端与服务端的解耦， 生产者和消费者的解耦。</strong></p> <h1 id="request-response模型实现"><a href="#request-response模型实现" class="header-anchor">#</a> Request/Response模型实现</h1> <h2 id="queuerequestor"><a href="#queuerequestor" class="header-anchor">#</a> QueueRequestor</h2> <p>同步阻塞</p> <h2 id="temporaryqueue"><a href="#temporaryqueue" class="header-anchor">#</a> TemporaryQueue</h2> <p>异步监听，当消息过多时会创建响应的临时queue</p> <h2 id="jmscorrelationid-消息属性"><a href="#jmscorrelationid-消息属性" class="header-anchor">#</a> JMSCorrelationID 消息属性</h2> <p>异步监听，公用queue</p> <h1 id="调优总结"><a href="#调优总结" class="header-anchor">#</a> 调优总结</h1> <h2 id="topic加强-可追溯消息"><a href="#topic加强-可追溯消息" class="header-anchor">#</a> Topic加强 可追溯消息</h2> <p>http://activemq.apache.org/retroactive-consumer.html</p> <p>避免topic下错过消息</p> <h3 id="消费者设置"><a href="#消费者设置" class="header-anchor">#</a> 消费者设置</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>	Destination topic = session.createTopic(&quot;tpk?consumer.retroactive=true&quot;);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="summary-of-available-recovery-policies"><a href="#summary-of-available-recovery-policies" class="header-anchor">#</a> Summary of Available Recovery Policies</h2> <table><thead><tr><th>Policy Name</th> <th>Sample Configuration</th> <th>Description</th></tr></thead> <tbody><tr><td>FixedSizedSubscriptionRecoveryPolicy</td> <td><fixedSizedSubscriptionRecoveryPolicy maximumSize="1024"></fixedSizedSubscriptionRecoveryPolicy></td> <td>Keep a fixed amount of memory in RAM for message history which is evicted in time order.</td></tr> <tr><td>FixedCountSubscriptionRecoveryPolicy</td> <td><fixedCountSubscriptionRecoveryPolicy maximumSize="100"></fixedCountSubscriptionRecoveryPolicy></td> <td>Keep a fixed count of last messages.</td></tr> <tr><td>LastImageSubscriptionRecoveryPolicy</td> <td><lastImageSubscriptionRecoveryPolicy></lastImageSubscriptionRecoveryPolicy></td> <td>Keep only the last message.</td></tr> <tr><td>NoSubscriptionRecoveryPolicy</td> <td><noSubscriptionRecoveryPolicy></noSubscriptionRecoveryPolicy></td> <td>Disables message recovery.</td></tr> <tr><td>QueryBasedSubscriptionRecoveryPolicy</td> <td><queryBasedSubscriptionRecoveryPolicy query="JMSType = 'car' AND color = 'blue'"></queryBasedSubscriptionRecoveryPolicy></td> <td>Perform a user specific query mechanism to load any message they may have missed. Details on message selectors are available <a href="http://java.sun.com/j2ee/1.4/docs/api/javax/jms/Message.html" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td></tr> <tr><td>TimedSubscriptionRecoveryPolicy</td> <td><timedSubscriptionRecoveryPolicy recoverDuration="60000"></timedSubscriptionRecoveryPolicy></td> <td>Keep a timed buffer of messages around in memory and use that to recover new subscriptions. Recovery time is in milliseconds.</td></tr> <tr><td>RetainedMessageSubscriptionRecoveryPolicy</td> <td><retainedMessageSubscriptionRecoveryPolicy></retainedMessageSubscriptionRecoveryPolicy></td> <td>Keep the last message with ActiveMQ.Retain property set to true</td></tr></tbody></table> <h3 id="保留固定字节的消息"><a href="#保留固定字节的消息" class="header-anchor">#</a> 保留固定字节的消息</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;policyEntry topic=&quot;&gt;&quot;&gt;
	&lt;subscriptionRecoveryPolicy&gt;
		&lt;fixedSizedSubscriptionRecoveryPolicy maximumSize=&quot;1024&quot;/&gt;
	&lt;/subscriptionRecoveryPolicy&gt;
&lt;/policyEntry&gt;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="保留固定数量的消息"><a href="#保留固定数量的消息" class="header-anchor">#</a> 保留固定数量的消息</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;policyEntry topic=&quot;&gt;&quot;&gt;
	&lt;subscriptionRecoveryPolicy&gt;
		&lt;fixedCountSubscriptionRecoveryPolicy maximumSize=&quot;100&quot;/&gt;
	&lt;/subscriptionRecoveryPolicy&gt;
&lt;/policyEntry&gt;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="保留时间"><a href="#保留时间" class="header-anchor">#</a> 保留时间</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>   &lt;subscriptionRecoveryPolicy&gt;
				&lt;timedSubscriptionRecoveryPolicy recoverDuration=&quot;60000&quot; /&gt;
				&lt;/subscriptionRecoveryPolicy&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="保留最后一条"><a href="#保留最后一条" class="header-anchor">#</a> 保留最后一条</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>	   &lt;subscriptionRecoveryPolicy&gt;
				&lt;lastImageSubscriptionRecoveryPolicy/&gt;
				&lt;/subscriptionRecoveryPolicy&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="慢速消费"><a href="#慢速消费" class="header-anchor">#</a> 慢速消费</h2> <h3 id="slowconsumerstrategy"><a href="#slowconsumerstrategy" class="header-anchor">#</a> SlowConsumerStrategy</h3> <p>对于慢消费者，broker会启动一个后台线程用来检测所有的慢速消费者，并定期的关闭慢消费者。
<strong>AbortSlowConsumerStrategy abortConnection</strong>：中断慢速消费者，慢速消费将会被关闭。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slowConsumerStrategy</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>abortSlowConsumerStrategy</span> <span class="token attr-name">abortConnection</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!-- 不关闭底层链接 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slowConsumerStrategy</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>AbortSlowConsumerStrategy maxTimeSinceLastAck</strong>：如果慢速消费者最后一个ACK距离现在的时间间隔超过阀值，则中断慢速消费者。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slowConsumerStrategy</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>abortSlowConsumerStrategy</span>  <span class="token attr-name">maxTimeSinceLastAck</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>30000<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!-- 30秒滞后 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slowConsumerStrategy</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="pendingmessagelimitstrategy-消息限制策略-面向慢消费者"><a href="#pendingmessagelimitstrategy-消息限制策略-面向慢消费者" class="header-anchor">#</a> PendingMessageLimitStrategy：消息限制策略（面向慢消费者）</h3> <p>http://activemq.apache.org/slow-consumer-handling</p> <p>此策略只对Topic有效，只对未持久化订阅者有效，当通道中有大量的消息积压时，broker可以保留的消息量。为了防止Topic中有慢速消费者，导致整个通道消息积压。
<strong>ConstantPendingMessageLimitStrategy</strong>：保留固定条数的消息，如果消息量超过limit，将使用<strong>消息剔除策略</strong>移除消息。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>policyEntry</span> <span class="token attr-name">topic</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ORDERS.&gt;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- lets force old messages to be discarded for slow consumers --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pendingMessageLimitStrategy</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constantPendingMessageLimitStrategy</span> <span class="token attr-name">limit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>50<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pendingMessageLimitStrategy</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>policyEntry</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>PrefetchRatePendingMessageLimitStrategy</strong>：保留prefetchSize倍数条消息。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- 若prefetchSize为100，则保留2.5 * 100条消息 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prefetchRatePendingMessageLimitStrategy</span> <span class="token attr-name">multiplier</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2.5<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="消息堆积内存上涨"><a href="#消息堆积内存上涨" class="header-anchor">#</a> 消息堆积内存上涨</h2> <ul><li>检查消息是否持久化</li> <li>检查消息 消费速度与生产速度</li> <li>调整xms xmx参数</li></ul> <h2 id="磁盘满"><a href="#磁盘满" class="header-anchor">#</a> 磁盘满</h2> <p>当非持久化消息堆积到一定程度，ActiveMQ会将非持久化消息写入临时文件，但是在重启的时候不会恢复</p> <p>当存储持久化数据的磁盘满了的时候</p> <p><strong>持久化消息</strong></p> <p>生产者阻塞，消费正常，当消费一部分消息后，腾出空间，生产者继续</p> <p><strong>非持久化消息</strong></p> <p>由于临时文件造成磁盘满了，生产者阻塞，消费异常，无法提供服务</p> <h2 id="开启事务"><a href="#开启事务" class="header-anchor">#</a> 开启事务</h2> <p>在发送非持久化消息的时候，可以有效防止消息丢失</p> <h2 id="prefetchsize影响消费倾斜"><a href="#prefetchsize影响消费倾斜" class="header-anchor">#</a> prefetchSize影响消费倾斜</h2> <p>慢速消费的时候可以将prefetchSize设为1，每次取一条</p> <h2 id="prefetchsize造成消费者内存溢出"><a href="#prefetchsize造成消费者内存溢出" class="header-anchor">#</a> prefetchSize造成消费者内存溢出</h2> <h2 id="auto-acknowledge造成消息丢失-乱序"><a href="#auto-acknowledge造成消息丢失-乱序" class="header-anchor">#</a> AUTO_ACKNOWLEDGE造成消息丢失/乱序</h2> <p>消息消费失败后，无法复原消息，可以手动ack 避免broker把消息自动确认删除</p> <p>receive()方法接受到消息后立即确认</p> <p>listener 的onmessage方法执行完毕才会确认</p> <p>手动ack的时候要等connection断开 才会重新推送给其他的consumer，所以有可能会导致消费顺序错乱</p> <h2 id="exclusive-和selector有可能造成消息堆积"><a href="#exclusive-和selector有可能造成消息堆积" class="header-anchor">#</a> exclusive 和selector有可能造成消息堆积</h2> <h1 id="集群配置"><a href="#集群配置" class="header-anchor">#</a> 集群配置</h1> <p><strong>官方文档</strong></p> <p>http://activemq.apache.org/clustering.html</p> <h2 id="主备集群"><a href="#主备集群" class="header-anchor">#</a> 主备集群</h2> <p>http://activemq.apache.org/masterslave.html</p> <table><thead><tr><th>Master Slave Type</th> <th>Requirements</th> <th>Pros</th> <th>Cons</th></tr></thead> <tbody><tr><td><a href="http://activemq.apache.org/shared-file-system-master-slave" target="_blank" rel="noopener noreferrer">Shared File System Master Slave<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>A shared file system such as a SAN</td> <td>Run as many slaves as required. Automatic recovery of old masters</td> <td>Requires shared file system</td></tr> <tr><td><a href="http://activemq.apache.org/jdbc-master-slave" target="_blank" rel="noopener noreferrer">JDBC Master Slave<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>A Shared database</td> <td>Run as many slaves as required. Automatic recovery of old masters</td> <td>Requires a shared database. Also relatively slow as it cannot use the high performance journal</td></tr> <tr><td><a href="http://activemq.apache.org/replicated-Features/PersistenceFeatures/Persistence/Features/Persistence/leveldb-store" target="_blank" rel="noopener noreferrer">Replicated LevelDB Store<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>ZooKeeper Server</td> <td>Run as many slaves as required. Automatic recovery of old masters. Very fast.</td> <td>Requires a ZooKeeper server.</td></tr></tbody></table> <h3 id="shared-file-system-master-slave"><a href="#shared-file-system-master-slave" class="header-anchor">#</a> Shared File System Master Slave</h3> <p>基于共享存储的Master-Slave；多个broker共用同一数据源，谁拿到锁谁就是master,其他处于待启动状态，如果master挂掉了，某个抢到文件锁的slave变成master</p> <p><strong>启动后</strong></p> <p><img src="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/img/Startup.dc21adcf.png" alt="img"></p> <p><strong>Master宕机</strong></p> <p><img src="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/img/MasterFailed.6eb264eb.png" alt="img"></p> <p><strong>Master重启</strong></p> <p><img src="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/img/image-20200212193653842.5e065580.png" alt="image-20200212193653842"></p> <p><strong>JDBC Master Slave</strong></p> <p>基于JDBC的Master-Slave:使用同一个数据库，拿到LOCK表的写锁的broker成为master.</p> <p>性能较低，不能使用高性能日志</p> <p><strong>Replicated LeveDB Store</strong></p> <p>基于zookeeper复制LeveDB存储的Master-Slave机制</p> <p><strong>配置步骤</strong></p> <ol><li>修改broker名称</li> <li>修改数据源
<ol><li>如果使用kahadb，配置相同路径</li> <li>如果使用mysql 使用同一数据源（同一数据库和表）</li></ol></li></ol> <p><strong>尝试</strong></p> <p><img src="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/img/image-20200212144259602.89d7fab9.png" alt="image-20200212144259602"></p> <p>http://activemq.apache.org/failover-transport-reference.html</p> <h3 id="failover-故障转移协议"><a href="#failover-故障转移协议" class="header-anchor">#</a> failover 故障转移协议</h3> <p>断线重连机制是ActiveMQ的高可用性具体体现之一。ActiveMQ提供failover机制去实现断线重连的高可用性，可以使得连接断开之后，不断的重试连接到一个或多个brokerURL。</p> <p>默认情况下，如果client与broker直接的connection断开，则client会新起一个线程，不断的从url参数中获取一个url来重试连接。</p> <p>配置语法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>		<span class="token class-name">ActiveMQConnectionFactory</span> connectionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActiveMQConnectionFactory</span><span class="token punctuation">(</span>
				<span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span>
				<span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span>
				<span class="token string">&quot;failover:(nio://localhost:5671,nio://localhost:5672)&quot;</span>
				<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>可配置选项</strong></p> <h3 id="transport-options"><a href="#transport-options" class="header-anchor">#</a> Transport Options</h3> <table><thead><tr><th>Option Name</th> <th>Default Value</th> <th>Description</th></tr></thead> <tbody><tr><td><code>backup</code></td> <td><code>false</code></td> <td>Initialize and hold a second transport connection - to enable fast failover.</td></tr> <tr><td><code>initialReconnectDelay</code></td> <td><code>10</code></td> <td>The delay (in ms) before the <em>first</em> reconnect attempt.</td></tr> <tr><td><code>maxCacheSize</code></td> <td><code>131072</code></td> <td>Size in bytes for the cache of tracked messages. Applicable only if <code>trackMessages</code> is <code>true</code>.</td></tr> <tr><td><code>maxReconnectAttempts</code></td> <td><code>-1 | 0</code></td> <td><strong>From ActiveMQ 5.6</strong>: default is <code>-1</code>, retry forever. <code>0</code> means disables re-connection, e.g: just try to connect once. <strong>Before ActiveMQ 5.6</strong>: default is <code>0</code>, retry forever. <strong>All ActiveMQ versions</strong>: a value <code>&gt;0</code> denotes the maximum number of reconnect attempts before an error is sent back to the client.</td></tr> <tr><td><code>maxReconnectDelay</code></td> <td><code>30000</code></td> <td>The maximum delay (in ms) between the <em>second and subsequent</em> reconnect attempts.</td></tr> <tr><td><code>nested.*</code></td> <td><code>null</code></td> <td><strong>From ActiveMQ 5.9:</strong> common URI options that will be applied to each URI in the list**.**</td></tr> <tr><td><code>randomize</code></td> <td><code>true</code></td> <td>If <code>true</code>, choose a URI at random from the list to use for reconnect.</td></tr> <tr><td><code>reconnectDelayExponent</code></td> <td><code>2.0</code></td> <td>The exponent used during exponential back-off attempts.</td></tr> <tr><td><code>reconnectSupported</code></td> <td><code>true</code></td> <td>Determines whether the client should respond to broker <code>ConnectionControl</code> events with a reconnect (see: <code>rebalanceClusterClients</code>).</td></tr> <tr><td><code>startupMaxReconnectAttempts</code></td> <td><code>-1</code></td> <td>A value of <code>-1</code> denotes that the number of connection attempts at startup should be unlimited. A value of <code>&gt;=0</code> denotes the number of reconnect attempts at startup that will be made after which an error is sent back to the client when the client makes a subsequent reconnect attempt. <strong>Note</strong>: once successfully connected the <code>maxReconnectAttempts</code> option prevails.</td></tr> <tr><td><code>timeout</code></td> <td><code>-1</code></td> <td><strong>From ActiveMQ 5.3</strong>: set the timeout on send operations (in ms) without interruption of re-connection process.</td></tr> <tr><td><code>trackMessages</code></td> <td><code>false</code></td> <td>Keep a cache of in-flight messages that will flushed to a broker on reconnect.</td></tr> <tr><td><code>updateURIsSupported</code></td> <td><code>true</code></td> <td><strong>From</strong> <strong>ActiveMQ 5.4:</strong> determines whether the client should accept updates from the broker to its list of known URIs.</td></tr> <tr><td><code>updateURIsURL</code></td> <td><code>null</code></td> <td><strong>From ActiveMQ 5.4:</strong> a URL (or path to a local file) to a text file containing a comma separated list of URIs to use for reconnect in the case of failure.</td></tr> <tr><td><code>useExponentialBackOff</code></td> <td><code>true</code></td> <td>If <code>true</code> an exponential back-off is used between reconnect attempts.</td></tr> <tr><td><code>warnAfterReconnectAttempts</code></td> <td><code>10</code></td> <td><strong>From ActiveMQ 5.10:</strong> a value <code>&gt;0</code> specifies the number of reconnect attempts before a warning is logged. A logged warning indicates that there is no current connection but re-connection is being attempted. A value of <code>&lt;=0</code> disables the logging of warnings about reconnect attempts.</td></tr></tbody></table> <p><strong>backup</strong></p> <p>初始化的时候创建第二个连接，快速故障转移</p> <p><strong>initialReconnectDelay</strong></p> <p>第一次重试延迟</p> <p><strong>trackMessages</strong></p> <p>设置是否缓存（故障发生时）尚未传送完成的消息，当broker一旦重新连接成功，便将这些缓存中的消息刷新到新连接的代理中，使得消息可以在broker切换前后顺利传送。默认false</p> <p><strong>maxCacheSize</strong></p> <p>当trackMessage启动时，缓存的最大子字节数</p> <p><strong>maxReconnectAttempts</strong></p> <p>默认1|0，自5.6版本开始，-1为默认值，代表不限重试次数，0标识从不重试（只尝试连接一次，并不重连），5.6以前的版本，0为默认值，代表不重试，如果设置大于0的数，则代表最大重试次数。</p> <p><strong>maxReconnectDelay</strong></p> <p>最长重试间隔</p> <p><strong>randomize</strong></p> <p>使用随机连接，以达到负载均衡的目的，默认true</p> <p>只配主备的情况下最好关闭</p> <p><strong>startupMaxReconnectAttempts</strong></p> <p>初始化时的最大重试次</p> <p>“-1”表示在启动时连接尝试的次数是无限的。</p> <p>' &gt;=0 '的值表示在启动时重新连接尝试的次数</p> <p>一旦成功连接后续将使用“maxReconnectAttempts”选项</p> <p><strong>timeout</strong></p> <p>连接超时</p> <p><strong>updateURIsSupported</strong></p> <p>是否可以动态修改broker uri</p> <p><strong>updateURIsURL</strong></p> <p>指定动态修改地址的路径</p> <p><strong>useExponentialBackOff</strong></p> <p>重连时间间隔是否以指数形式增长</p> <p><strong>reconnectDelayExponent</strong></p> <p>指数增长时的指数</p> <p><strong>warnAfterReconnectAttempts</strong></p> <p>重连日志记录</p> <h2 id="负载均衡"><a href="#负载均衡" class="header-anchor">#</a> 负载均衡</h2> <p><strong>官方文档</strong></p> <p>http://activemq.apache.org/networks-of-brokers.html</p> <h3 id="静态网络配置"><a href="#静态网络配置" class="header-anchor">#</a> 静态网络配置</h3> <p><img src="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/img/10190bfe-30d7-3021-8bbe-9d7882530083.ee0687c8.png" alt="img"></p> <p>在broker节点下配置networkConnectors</p> <ul><li>networkConnectors（网络连接器）主要用来配置ActiveMQ服务端与服务端之间的通信</li> <li>TransportConnector（传输连接器）主要用于配置ActiveMQ服务端和客户端之间的通信方式</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;networkConnectors&gt;
  &lt;networkConnector duplex=&quot;true&quot; name=&quot;amq-cluster&quot; uri=&quot;static:failover://(nio://localhost:5671,nio://localhost:5672)&quot;  /&gt;
&lt;/networkConnectors&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参与的节点都需要修改</p> <p>注意如果单机启动多个节点，记得修改端口避免冲突</p> <p>启动成功后<code>Connections</code>中会有其他节点</p> <p><img src="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/img/image-20200212165236443.a4cfd797.png" alt="image-20200212165236443"></p> <p><code>Network</code>中也会显示桥接连接</p> <p><img src="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/img/image-20200212165658958.158fa32e.png" alt="image-20200212165658958"></p> <p>负载均衡的环境下，broker上的消息优先给在本地连接的consumer</p> <p>当networkerConnector与remote Broker建立链接之后，那么remote Broker将会向local Broker交付订阅信息，包括remote broker持有的destinations、Consumers、持久订阅者列表等；那么此后local Broker将把remote Broker做一个消息“订阅者”</p> <p><strong>Advisory</strong></p> <p>ActiveMQ提供了“Advisory”机制，通常ActiveMQ内部将某些事件作为“advisory”在全局广播，比如destination的创建、consumer的加入、DLQ的产生等，这将额外的消耗极小的性能；我们可以在ActiveMQ的监控页面上看到影响的消息，开发者也可以View这些消息(通道名称以“ActiveMQ.Advisory.”开头)。对于分布式网络中的broker，将严重依赖“Advisory”，特别是“dynamic network”，默认已开启</p> <p>在一个broker上发生事件，都会以“通知”的方式发送给配置文件中指定的所有networkConnector</p> <p><strong>Dynamic networks</strong></p> <p>“动态网络”表明当remote Broker持有通道的消费者时，local Broker才会转发相应的消息；此时我们需要开启advisorySupport。当remote broker上有Consumer创建时，Advisory中将会广播消息，消息为ConsumerInfo类型，它将包括consumer所在的broker path，如果local broker与此path建立了networkConnector，那么此后local Broker将会启动响应的消息转发。</p> <p><strong>Static networks</strong></p> <p>相对于“动态网络”而言，“静态网络”将不依赖Advisory，在任何时候，即使remote Broker中没有相应的consumer，消息也将转发给remote Broker</p> <p>将brokers作为简单代理并转发消息到远端而不管是否有消费者</p> <h3 id="可配置属性"><a href="#可配置属性" class="header-anchor">#</a> 可配置属性</h3> <h4 id="uri的几个属性"><a href="#uri的几个属性" class="header-anchor">#</a> URI的几个属性</h4> <table><thead><tr><th>property</th> <th>default</th> <th>description</th></tr></thead> <tbody><tr><td>initialReconnectDelay</td> <td>1000</td> <td>time(ms) to wait before attempting a reconnect (if useExponentialBackOff is false)</td></tr> <tr><td>maxReconnectDelay</td> <td>30000</td> <td>time(ms) to wait before attempting to re-connect</td></tr> <tr><td>useExponentialBackOff</td> <td>true</td> <td>increases time between reconnect for every failure in a reconnect sequence</td></tr> <tr><td>backOffMultiplier</td> <td>2</td> <td>multipler used to increase the wait time if using exponential back off</td></tr></tbody></table> <h4 id="networkconnector-properties"><a href="#networkconnector-properties" class="header-anchor">#</a> NetworkConnector Properties</h4> <table><thead><tr><th>property</th> <th>default</th> <th>description</th></tr></thead> <tbody><tr><td>name</td> <td>bridge</td> <td>name of the network - for more than one network connector between the same two brokers - use different names</td></tr> <tr><td>dynamicOnly</td> <td>false</td> <td>if true, only activate a networked durable subscription when a corresponding durable subscription reactivates, by default they are activated on startup.</td></tr> <tr><td>decreaseNetworkConsumerPriority</td> <td>false</td> <td>if true, starting at priority -5, decrease the priority for dispatching to a network Queue consumer the further away it is (in network hops) from the producer. When false all network consumers use same default priority(0) as local consumers</td></tr> <tr><td>networkTTL</td> <td>1</td> <td>the number of brokers in the network that messages and subscriptions can pass through (sets both message&amp;consumer -TTL)</td></tr> <tr><td>messageTTL</td> <td>1</td> <td>(version 5.9) the number of brokers in the network that messages can pass through</td></tr> <tr><td>consumerTTL</td> <td>1</td> <td>(version 5.9) the number of brokers in the network that subscriptions can pass through (keep to 1 in a mesh)</td></tr> <tr><td>conduitSubscriptions</td> <td>true</td> <td>multiple consumers subscribing to the same destination are treated as one consumer by the network</td></tr> <tr><td>excludedDestinations</td> <td>empty</td> <td>destinations matching this list won’t be forwarded across the network (this only applies to dynamicallyIncludedDestinations)</td></tr> <tr><td>dynamicallyIncludedDestinations</td> <td>empty</td> <td>destinations that match this list <strong>will</strong> be forwarded across the network <strong>n.b.</strong> an empty list means all destinations not in the exluded list will be forwarded</td></tr> <tr><td>useVirtualDestSubs</td> <td>false</td> <td>if true, the network connection will listen to advisory messages for virtual destination consumers</td></tr> <tr><td>staticallyIncludedDestinations</td> <td>empty</td> <td>destinations that match will always be passed across the network - even if no consumers have ever registered an interest</td></tr> <tr><td>duplex</td> <td>false</td> <td>if true, a network connection will be used to both produce *<strong>AND*</strong> Consume messages. This is useful for hub and spoke scenarios when the hub is behind a firewall etc.</td></tr> <tr><td>prefetchSize</td> <td>1000</td> <td>Sets the <a href="http://activemq.apache.org/what-is-the-prefetch-limit-for" target="_blank" rel="noopener noreferrer">prefetch size<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> on the network connector’s consumer. It must be &gt; 0 because network consumers do not poll for messages</td></tr> <tr><td>suppressDuplicateQueueSubscriptions</td> <td>false</td> <td>(from 5.3) if true, duplicate subscriptions in the network that arise from network intermediaries will be suppressed. For example, given brokers A,B and C, networked via multicast discovery. A consumer on A will give rise to a networked consumer on B and C. In addition, C will network to B (based on the network consumer from A) and B will network to C. When true, the network bridges between C and B (being duplicates of their existing network subscriptions to A) will be suppressed. Reducing the routing choices in this way provides determinism when producers or consumers migrate across the network as the potential for dead routes (stuck messages) are eliminated. networkTTL needs to match or exceed the broker count to require this intervention.</td></tr> <tr><td>bridgeTempDestinations</td> <td>true</td> <td>Whether to broadcast advisory messages for created temp destinations in the network of brokers or not. Temp destinations are typically created for request-reply messages. Broadcasting the information about temp destinations is turned on by default so that consumers of a request-reply message can be connected to another broker in the network and still send back the reply on the temporary destination specified in the JMSReplyTo header. In an application scenario where most/all messages use request-reply pattern, this will generate additional traffic on the broker network as every message typically sets a unique JMSReplyTo address (which causes a new temp destination to be created and broadcasted via an advisory message in the network of brokers). When disabling this feature such network traffic can be reduced but then producer and consumers of a request-reply message need to be connected to the same broker. Remote consumers (i.e. connected via another broker in your network) won’t be able to send the reply message but instead raise a “temp destination does not exist” exception.</td></tr> <tr><td>alwaysSyncSend</td> <td>false</td> <td>(version 5.6) When true, non persistent messages are sent to the remote broker using request/reply in place of a oneway. This setting treats both persistent and non-persistent messages the same.</td></tr> <tr><td>staticBridge</td> <td>false</td> <td>(version 5.6) If set to true, broker will not dynamically respond to new consumers. It will only use <code>staticallyIncludedDestinations</code> to create demand subscriptions</td></tr> <tr><td>userName</td> <td>null</td> <td>The username to authenticate against the remote broker</td></tr> <tr><td>password</td> <td>null</td> <td>The password for the username to authenticate against the remote broker</td></tr></tbody></table> <p><strong>name</strong></p> <p>相同的名称会被添加到同一集群中</p> <p><strong>dynamicOnly</strong></p> <p>是否直接转发，设置成true的话 broker会在没有消费者的时候不去转发消息</p> <p><strong>decreaseNetworkConsumerPriority</strong></p> <p>如果为true，网络的消费者优先级降低为-5。如果为false，则默认跟本地消费者一样为0.</p> <p><strong>networkTTL</strong> <strong>messageTTL</strong> <strong>consumerTTL</strong></p> <p>消息和订阅在网络中被broker转发（穿过）的最大次数，消息在网络中每转发一次，都会将TTL-1</p> <p><strong>conduitSubscriptions</strong></p> <p>多个消费者消费消息被当作一个消费者</p> <p><strong>excludedDestinations</strong></p> <p>在这个名单中的Destination不会在网络中被转发</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;excludedDestinaitons&gt;
        &lt;queue physicalName=&quot;include.test.foo&quot;/&gt;
        &lt;topic physicalName=&quot;include.test.bar&quot;/&gt;
　&lt;/excludedDestinaitons&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>dynamicallyIncludedDestinations</strong></p> <p>通过网络转发的destinations，注意空列表代表所有的都转发。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>　&lt;dynamicallyIncludeDestinaitons&gt;
        &lt;queue physicalName=&quot;include.test.foo&quot;/&gt;
        &lt;topic physicalName=&quot;include.test.bar&quot;/&gt;
　&lt;/dynamicallyIncludeDestinaitons&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>useVirtualDestSubs</strong></p> <p>开启此选项会在转发消息时</p> <p><strong>staticallyIncludedDestinations</strong></p> <p>匹配的目的地将始终通过网络传递——即使没有消费者对此感兴趣 对应静态networks</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> &lt;staticallyIncludeDestinaitons&gt;
        &lt;queue physicalName=&quot;aways.include.queue&quot;/&gt;
　&lt;/staticallyIncludeDestinaitons&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>duplex</strong></p> <p>是否允许双向连接<strong>如果该属性为true，当这个节点使用Network Bridge连接到其它目标节点后，将强制目标也建立Network Bridge进行反向连接</strong></p> <p><strong>prefetchSize</strong></p> <p>缓冲消息大小，必须大于0，不会主动拉取消息</p> <p><strong>suppressDuplicateQueueSubscriptions</strong></p> <p>如果为true, 重复的订阅关系一产生即被阻止。</p> <p><strong>bridgeTempDestinations</strong></p> <p>是否转发临时destination，禁用后再使用request/reply模型的时候客户端需要连接到同一broker，不然会找不到destination</p> <p><strong>alwaysSyncSend</strong></p> <p>开启后转发非持久化消息会使用request/reply模型</p> <p><strong>staticBridge</strong></p> <p>如果设置为true，则代理将不会动态响应新的consumer，只能使用staticallyIncludedDestinations中的destination</p> <p><strong>userName</strong> <strong>password</strong></p> <p>连接broker时的用户名和密码</p> <h3 id="动态网络配置"><a href="#动态网络配置" class="header-anchor">#</a> 动态网络配置</h3> <p><strong>官方文档</strong></p> <p>http://activemq.apache.org/multicast-transport-reference</p> <p>使用multicast协议，可以指定组播地址或使用<code>multicast://default</code>（239.255.2.3）</p> <p>配置<code>networkConnectors</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;networkConnectors&gt;
 &lt;networkConnector uri=&quot;multicast://239.0.0.5&quot; duplex=&quot;false&quot;/&gt;
&lt;/networkConnectors&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>broker启动后会使用udp协议向组播地址发送数据报文以便让其他在这个组播地址的节点感知到自己的存在</p> <p>每个UDP数据报中，包含的主要信息包括本节点ActiveMQ的版本信息，以及连接到自己所需要使用的host名字、协议名和端口信息。</p> <p>配置<code>transportConnector</code>指明将哪一个连接通过UDP数据报向其他ActiveMQ节点进行公布，就需要在transportConnector标签上使用discoveryUri属性进行标识</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>	&lt;transportConnector name=&quot;auto+nio&quot; uri=&quot;auto+nio://localhost:5672&quot; discoveryUri=&quot;multicast://239.0.0.5&quot;/&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="消息回流"><a href="#消息回流" class="header-anchor">#</a> 消息回流</h2> <p>在消息转发的时候，remote broker转发Local broker的消息会消费掉LocalBroker的消息</p> <p>那么在转发的过程中，消息在被拉取后和发送给consumer的过程中重启的话会造成消息丢失</p> <p><code>replayWhenNoConsumers</code> 选项可以使remote broke上有需要转发的消息但是没有被消费时，把消息回流到它原始的broker.同时把enableAudit设置为false,为了防止消息回流后被当作重复消息而不被分发</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>　　　　 &lt;destinationPolicy&gt;
            &lt;policyMap&gt;
              &lt;policyEntries&gt;
                &lt;policyEntry queue=&quot;&gt;&quot; enableAudit=&quot;false&quot;&gt;
                    &lt;networkBridgeFilterFactory&gt;
                        &lt;conditionalNetworkBridgeFilterFactory replayWhenNoConsumers=&quot;true&quot;/&gt;
                    &lt;/networkBridgeFilterFactory&gt;
                &lt;/policyEntry&gt;
              &lt;/policyEntries&gt;
            &lt;/policyMap&gt;
        &lt;/destinationPolicy&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="消息副本"><a href="#消息副本" class="header-anchor">#</a> 消息副本</h2> <p>http://activemq.apache.org/replicated-message-store</p> <h1 id="面试题"><a href="#面试题" class="header-anchor">#</a> 面试题</h1> <h2 id="activemq如何防止消息丢失-会不会丢消息"><a href="#activemq如何防止消息丢失-会不会丢消息" class="header-anchor">#</a> ActiveMQ如何防止消息丢失？会不会丢消息？</h2> <p>做高可用</p> <p>死信队列</p> <p>持久化</p> <p>ack</p> <p>消息重投</p> <p>记录日志</p> <p>接收（消费）确认</p> <p>broker负载/限流</p> <h2 id="如何防止重复消费"><a href="#如何防止重复消费" class="header-anchor">#</a> 如何防止重复消费？</h2> <p>消息幂等处理</p> <p>map <em>ConcurrentHashMap</em> -&gt; putIfAbsent   guava cache</p> <h2 id="如何保证消费顺序"><a href="#如何保证消费顺序" class="header-anchor">#</a> 如何保证消费顺序？</h2> <p>queue 优先级别设置</p> <p>多消费端 -&gt;</p></div></section> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="comments-wrapper" style="display:none;"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-898d6c54><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#kahadb存储" class="sidebar-link reco-side-kahadb存储" data-v-898d6c54>KahaDB存储</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#amq-方式" class="sidebar-link reco-side-amq-方式" data-v-898d6c54>AMQ 方式</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#jdbc存储" class="sidebar-link reco-side-jdbc存储" data-v-898d6c54>JDBC存储</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#配置问题" class="sidebar-link reco-side-配置问题" data-v-898d6c54>配置问题</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#表字段解释" class="sidebar-link reco-side-表字段解释" data-v-898d6c54>表字段解释</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#leveldb存储" class="sidebar-link reco-side-leveldb存储" data-v-898d6c54>LevelDB存储</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#memory-消息存储" class="sidebar-link reco-side-memory-消息存储" data-v-898d6c54>Memory 消息存储</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#jdbc-message-store-with-activemq-journal" class="sidebar-link reco-side-jdbc-message-store-with-activemq-journal" data-v-898d6c54>JDBC Message store with ActiveMQ Journal</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#transmission-control-protocol-tcp" class="sidebar-link reco-side-transmission-control-protocol-tcp" data-v-898d6c54>Transmission Control Protocol (TCP)</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#new-i-o-api-protocol-nio" class="sidebar-link reco-side-new-i-o-api-protocol-nio" data-v-898d6c54>New I/O API Protocol（NIO）</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#user-datagram-protocol-udp" class="sidebar-link reco-side-user-datagram-protocol-udp" data-v-898d6c54>User Datagram Protocol（UDP)</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#secure-sockets-layer-protocol-ssl" class="sidebar-link reco-side-secure-sockets-layer-protocol-ssl" data-v-898d6c54>Secure Sockets Layer Protocol (SSL)</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#hypertext-transfer-protocol-http-https" class="sidebar-link reco-side-hypertext-transfer-protocol-http-https" data-v-898d6c54>Hypertext Transfer Protocol (HTTP/HTTPS)</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#vm-protocol-vm" class="sidebar-link reco-side-vm-protocol-vm" data-v-898d6c54>VM Protocol（VM）</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#下载" class="sidebar-link reco-side-下载" data-v-898d6c54>下载</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#安装启动" class="sidebar-link reco-side-安装启动" data-v-898d6c54>安装启动</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#web控制台" class="sidebar-link reco-side-web控制台" data-v-898d6c54>web控制台</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#修改访问端口" class="sidebar-link reco-side-修改访问端口" data-v-898d6c54>修改访问端口</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#开发" class="sidebar-link reco-side-开发" data-v-898d6c54>开发</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#sender" class="sidebar-link reco-side-sender" data-v-898d6c54>Sender</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#receiver" class="sidebar-link reco-side-receiver" data-v-898d6c54>Receiver</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#web控制台安全" class="sidebar-link reco-side-web控制台安全" data-v-898d6c54>web控制台安全</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#消息安全机制" class="sidebar-link reco-side-消息安全机制" data-v-898d6c54>消息安全机制</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#事务" class="sidebar-link reco-side-事务" data-v-898d6c54>事务</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#purge" class="sidebar-link reco-side-purge" data-v-898d6c54>Purge</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#签收模式" class="sidebar-link reco-side-签收模式" data-v-898d6c54>签收模式</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#session-auto-acknowledge" class="sidebar-link reco-side-session-auto-acknowledge" data-v-898d6c54>Session.AUTO_ACKNOWLEDGE</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#session-client-acknowledge" class="sidebar-link reco-side-session-client-acknowledge" data-v-898d6c54>Session.CLIENT_ACKNOWLEDGE</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#session-dups-ok-acknowledge" class="sidebar-link reco-side-session-dups-ok-acknowledge" data-v-898d6c54>Session.DUPSOKACKNOWLEDGE</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#session-session-transacted" class="sidebar-link reco-side-session-session-transacted" data-v-898d6c54>Session.SESSION_TRANSACTED</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#持久化" class="sidebar-link reco-side-持久化" data-v-898d6c54>持久化</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#优先级" class="sidebar-link reco-side-优先级" data-v-898d6c54>优先级</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#消息超时-过期" class="sidebar-link reco-side-消息超时-过期" data-v-898d6c54>消息超时/过期</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#死信" class="sidebar-link reco-side-死信" data-v-898d6c54>死信</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#修改死信队列名称" class="sidebar-link reco-side-修改死信队列名称" data-v-898d6c54>修改死信队列名称</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#让非持久化的消息也进入死信队列" class="sidebar-link reco-side-让非持久化的消息也进入死信队列" data-v-898d6c54>让非持久化的消息也进入死信队列</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#过期消息不进死信队列" class="sidebar-link reco-side-过期消息不进死信队列" data-v-898d6c54>过期消息不进死信队列</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#独占消费者" class="sidebar-link reco-side-独占消费者" data-v-898d6c54>独占消费者</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#object" class="sidebar-link reco-side-object" data-v-898d6c54>object</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#发送端" class="sidebar-link reco-side-发送端" data-v-898d6c54>发送端</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#接受端" class="sidebar-link reco-side-接受端" data-v-898d6c54>接受端</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#bytesmessage" class="sidebar-link reco-side-bytesmessage" data-v-898d6c54>bytesMessage</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#发送端-2" class="sidebar-link reco-side-发送端-2" data-v-898d6c54>发送端</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#接受端-2" class="sidebar-link reco-side-接受端-2" data-v-898d6c54>接受端</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#写入文件" class="sidebar-link reco-side-写入文件" data-v-898d6c54>写入文件</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#mapmessage" class="sidebar-link reco-side-mapmessage" data-v-898d6c54>MapMessage</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#发送端-3" class="sidebar-link reco-side-发送端-3" data-v-898d6c54>发送端</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#接收端" class="sidebar-link reco-side-接收端" data-v-898d6c54>接收端</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#同步与异步" class="sidebar-link reco-side-同步与异步" data-v-898d6c54>同步与异步</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#消息堆积" class="sidebar-link reco-side-消息堆积" data-v-898d6c54>消息堆积</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#延迟消息投递" class="sidebar-link reco-side-延迟消息投递" data-v-898d6c54>延迟消息投递</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#延迟发送" class="sidebar-link reco-side-延迟发送" data-v-898d6c54>延迟发送</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#带间隔的重复发送" class="sidebar-link reco-side-带间隔的重复发送" data-v-898d6c54>带间隔的重复发送</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#cron表达式定时发送" class="sidebar-link reco-side-cron表达式定时发送" data-v-898d6c54>Cron表达式定时发送</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#消息发送" class="sidebar-link reco-side-消息发送" data-v-898d6c54>消息发送</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#消息接收" class="sidebar-link reco-side-消息接收" data-v-898d6c54>消息接收</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#配置文件" class="sidebar-link reco-side-配置文件" data-v-898d6c54>配置文件</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#pom" class="sidebar-link reco-side-pom" data-v-898d6c54>POM</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#yml" class="sidebar-link reco-side-yml" data-v-898d6c54>yml</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#config类" class="sidebar-link reco-side-config类" data-v-898d6c54>Config类</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#收" class="sidebar-link reco-side-收" data-v-898d6c54>收</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#发" class="sidebar-link reco-side-发" data-v-898d6c54>发</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#nio配置" class="sidebar-link reco-side-nio配置" data-v-898d6c54>NIO配置</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#openwire-可用配置选项" class="sidebar-link reco-side-openwire-可用配置选项" data-v-898d6c54>OpenWire 可用配置选项</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#transport-可用配置选项" class="sidebar-link reco-side-transport-可用配置选项" data-v-898d6c54>Transport 可用配置选项</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#官方网站" class="sidebar-link reco-side-官方网站" data-v-898d6c54>官方网站</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#部署" class="sidebar-link reco-side-部署" data-v-898d6c54>部署</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#独立jar包的形式运行" class="sidebar-link reco-side-独立jar包的形式运行" data-v-898d6c54>独立jar包的形式运行</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#嵌入activemq" class="sidebar-link reco-side-嵌入activemq" data-v-898d6c54>嵌入ActiveMQ</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#header" class="sidebar-link reco-side-header" data-v-898d6c54>Header</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#自动头信息" class="sidebar-link reco-side-自动头信息" data-v-898d6c54>自动头信息</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#手动头信息" class="sidebar-link reco-side-手动头信息" data-v-898d6c54>手动头信息</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#jmscorrelationid" class="sidebar-link reco-side-jmscorrelationid" data-v-898d6c54>JMSCorrelationID</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#jmsreplyto" class="sidebar-link reco-side-jmsreplyto" data-v-898d6c54>JMSReplyTo</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#queue-browser" class="sidebar-link reco-side-queue-browser" data-v-898d6c54>queue browser</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#jmscorrelationid-2" class="sidebar-link reco-side-jmscorrelationid-2" data-v-898d6c54>JMSCorrelationID</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#jmsreplyto-2" class="sidebar-link reco-side-jmsreplyto-2" data-v-898d6c54>JMSReplyTo</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#queuerequestor同步消息" class="sidebar-link reco-side-queuerequestor同步消息" data-v-898d6c54>QueueRequestor同步消息</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#生产环境中影响性能的几个因素" class="sidebar-link reco-side-生产环境中影响性能的几个因素" data-v-898d6c54>生产环境中影响性能的几个因素</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#out-of-memory" class="sidebar-link reco-side-out-of-memory" data-v-898d6c54>Out of memory</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#持久化和非持久化" class="sidebar-link reco-side-持久化和非持久化" data-v-898d6c54>持久化和非持久化</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#消息异步发送" class="sidebar-link reco-side-消息异步发送" data-v-898d6c54>消息异步发送</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#批量确认" class="sidebar-link reco-side-批量确认" data-v-898d6c54>批量确认</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#消费缓冲与消息积压prefetchsize" class="sidebar-link reco-side-消费缓冲与消息积压prefetchsize" data-v-898d6c54>消费缓冲与消息积压prefetchSize</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#可以通过3中方式设置prefetchsize" class="sidebar-link reco-side-可以通过3中方式设置prefetchsize" data-v-898d6c54>可以通过3中方式设置prefetchSize</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#消息到底是推还是拉" class="sidebar-link reco-side-消息到底是推还是拉" data-v-898d6c54>消息到底是推还是拉?</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#eip-enterprise-integration-patterns" class="sidebar-link reco-side-eip-enterprise-integration-patterns" data-v-898d6c54>EIP Enterprise Integration Patterns.</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#queuerequestor" class="sidebar-link reco-side-queuerequestor" data-v-898d6c54>QueueRequestor</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#temporaryqueue" class="sidebar-link reco-side-temporaryqueue" data-v-898d6c54>TemporaryQueue</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#jmscorrelationid-消息属性" class="sidebar-link reco-side-jmscorrelationid-消息属性" data-v-898d6c54>JMSCorrelationID 消息属性</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#topic加强-可追溯消息" class="sidebar-link reco-side-topic加强-可追溯消息" data-v-898d6c54>Topic加强 可追溯消息</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#消费者设置" class="sidebar-link reco-side-消费者设置" data-v-898d6c54>消费者设置</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#summary-of-available-recovery-policies" class="sidebar-link reco-side-summary-of-available-recovery-policies" data-v-898d6c54>Summary of Available Recovery Policies</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#保留固定字节的消息" class="sidebar-link reco-side-保留固定字节的消息" data-v-898d6c54>保留固定字节的消息</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#保留固定数量的消息" class="sidebar-link reco-side-保留固定数量的消息" data-v-898d6c54>保留固定数量的消息</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#保留时间" class="sidebar-link reco-side-保留时间" data-v-898d6c54>保留时间</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#保留最后一条" class="sidebar-link reco-side-保留最后一条" data-v-898d6c54>保留最后一条</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#慢速消费" class="sidebar-link reco-side-慢速消费" data-v-898d6c54>慢速消费</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#slowconsumerstrategy" class="sidebar-link reco-side-slowconsumerstrategy" data-v-898d6c54>SlowConsumerStrategy</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#pendingmessagelimitstrategy-消息限制策略-面向慢消费者" class="sidebar-link reco-side-pendingmessagelimitstrategy-消息限制策略-面向慢消费者" data-v-898d6c54>PendingMessageLimitStrategy：消息限制策略（面向慢消费者）</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#消息堆积内存上涨" class="sidebar-link reco-side-消息堆积内存上涨" data-v-898d6c54>消息堆积内存上涨</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#磁盘满" class="sidebar-link reco-side-磁盘满" data-v-898d6c54>磁盘满</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#开启事务" class="sidebar-link reco-side-开启事务" data-v-898d6c54>开启事务</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#prefetchsize影响消费倾斜" class="sidebar-link reco-side-prefetchsize影响消费倾斜" data-v-898d6c54>prefetchSize影响消费倾斜</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#prefetchsize造成消费者内存溢出" class="sidebar-link reco-side-prefetchsize造成消费者内存溢出" data-v-898d6c54>prefetchSize造成消费者内存溢出</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#auto-acknowledge造成消息丢失-乱序" class="sidebar-link reco-side-auto-acknowledge造成消息丢失-乱序" data-v-898d6c54>AUTO_ACKNOWLEDGE造成消息丢失/乱序</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#exclusive-和selector有可能造成消息堆积" class="sidebar-link reco-side-exclusive-和selector有可能造成消息堆积" data-v-898d6c54>exclusive 和selector有可能造成消息堆积</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#主备集群" class="sidebar-link reco-side-主备集群" data-v-898d6c54>主备集群</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#shared-file-system-master-slave" class="sidebar-link reco-side-shared-file-system-master-slave" data-v-898d6c54>Shared File System Master Slave</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#failover-故障转移协议" class="sidebar-link reco-side-failover-故障转移协议" data-v-898d6c54>failover 故障转移协议</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#transport-options" class="sidebar-link reco-side-transport-options" data-v-898d6c54>Transport Options</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#负载均衡" class="sidebar-link reco-side-负载均衡" data-v-898d6c54>负载均衡</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#静态网络配置" class="sidebar-link reco-side-静态网络配置" data-v-898d6c54>静态网络配置</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#可配置属性" class="sidebar-link reco-side-可配置属性" data-v-898d6c54>可配置属性</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#动态网络配置" class="sidebar-link reco-side-动态网络配置" data-v-898d6c54>动态网络配置</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#消息回流" class="sidebar-link reco-side-消息回流" data-v-898d6c54>消息回流</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#消息副本" class="sidebar-link reco-side-消息副本" data-v-898d6c54>消息副本</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#activemq如何防止消息丢失-会不会丢消息" class="sidebar-link reco-side-activemq如何防止消息丢失-会不会丢消息" data-v-898d6c54>ActiveMQ如何防止消息丢失？会不会丢消息？</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#如何防止重复消费" class="sidebar-link reco-side-如何防止重复消费" data-v-898d6c54>如何防止重复消费？</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/message/activemq/activemq.html#如何保证消费顺序" class="sidebar-link reco-side-如何保证消费顺序" data-v-898d6c54>如何保证消费顺序？</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><canvas id="vuepress-canvas-cursor"></canvas><APlayer audio="" fixed="true" mini="true" autoplay="autoplay" theme="#3eaf7c" loop="loop" order="random" preload="auto" volume="0.2" mutex="true" lrc-type="0" list-folded="true" list-max-height="250" storage-name="vuepress-plugin-meting" id="aplayer-fixed"></APlayer></div></div>
    <script src="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/app.0b21ff5c.js" defer></script><script src="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/5.f8fa3a85.js" defer></script><script src="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/1.46137cce.js" defer></script><script src="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/10.7222c760.js" defer></script>
  </body>
</html>
