<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis_基本使用 | 心沉则灵</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="学而不思则罔思而不学则殆!">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/css/0.styles.1ed67386.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/app.0b21ff5c.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/5.f8fa3a85.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/1.46137cce.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/43.9fb64b72.js" as="script"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/10.7222c760.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/11.31d5cb55.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/12.ac71a866.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/13.a4862f8f.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/14.7d38783b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/15.edb526f6.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/16.ac7c0538.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/17.c2f3c82d.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/18.2858e484.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/19.e3fdb388.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/2.f64b1c52.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/20.de9181b7.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/21.bf18fba2.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/22.89ef57ad.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/23.d1369dc6.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/24.57b2eb10.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/25.279be27c.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/26.77abaa9b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/27.3ebdd851.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/28.3a7441a6.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/29.ce0c7ac7.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/30.5e1d60b3.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/31.8e81922e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/32.f16a296c.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/33.6f85c4d6.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/34.3e2c1671.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/35.08d6b1a5.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/36.2338551e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/37.fd9a8698.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/38.c9dab7de.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/39.ae723246.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/40.fbd466bd.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/41.89cdf369.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/42.b0247ac4.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/44.6d1a088b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/45.333ed046.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/46.146a5de6.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/47.d3f7b767.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/48.a52dcdfb.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/49.aa541e45.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/6.3bd08025.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/7.63cd94b3.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/8.3fc861cf.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/9.e143e01a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/vendors~flowchart.2b2fbf5d.js">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/css/0.styles.1ed67386.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-0f44a727><div data-v-0f44a727><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-0f44a727 data-v-0f44a727><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-355e03f9 data-v-0f44a727 data-v-0f44a727><h3 class="title" data-v-355e03f9 data-v-355e03f9>心沉则灵</h3> <p class="description" data-v-355e03f9 data-v-355e03f9>学而不思则罔思而不学则殆!</p> <label id="box" class="inputBox" data-v-355e03f9 data-v-355e03f9><input type="password" value="" data-v-355e03f9> <span data-v-355e03f9>Konck! Knock!</span> <button data-v-355e03f9>OK</button></label> <div class="footer" data-v-355e03f9 data-v-355e03f9><span data-v-355e03f9><i class="iconfont reco-theme" data-v-355e03f9></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-355e03f9>vuePress-theme-reco</a></span> <span data-v-355e03f9><i class="iconfont reco-copyright" data-v-355e03f9></i> <a data-v-355e03f9><span data-v-355e03f9>Lingener</span>
            
          <span data-v-355e03f9>2020 - </span>
          2021
        </a></span></div></div> <div class="hide" data-v-0f44a727><header class="navbar" data-v-0f44a727><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="心沉则灵" class="logo"> <span class="site-name">心沉则灵</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      归档
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Architect/" class="nav-link"><i class="undefined"></i>
  Architect
</a></li><li class="dropdown-item"><!----> <a href="/categories/Microservices/" class="nav-link"><i class="undefined"></i>
  Microservices
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spring/" class="nav-link"><i class="undefined"></i>
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/categories/DB/" class="nav-link"><i class="undefined"></i>
  DB
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/Middleware/" class="nav-link"><i class="undefined"></i>
  Middleware
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-0f44a727></div> <aside class="sidebar" data-v-0f44a727><div class="personal-info-wrapper" data-v-5aaeb100 data-v-0f44a727><!----> <h3 class="name" data-v-5aaeb100>
    Lingener
  </h3> <div class="num" data-v-5aaeb100><div data-v-5aaeb100><h3 data-v-5aaeb100>36</h3> <h6 data-v-5aaeb100>Articles</h6></div> <div data-v-5aaeb100><h3 data-v-5aaeb100>20</h3> <h6 data-v-5aaeb100>Tags</h6></div></div> <ul class="social-links" data-v-5aaeb100></ul> <hr data-v-5aaeb100></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      归档
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Architect/" class="nav-link"><i class="undefined"></i>
  Architect
</a></li><li class="dropdown-item"><!----> <a href="/categories/Microservices/" class="nav-link"><i class="undefined"></i>
  Microservices
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spring/" class="nav-link"><i class="undefined"></i>
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/categories/DB/" class="nav-link"><i class="undefined"></i>
  DB
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/Middleware/" class="nav-link"><i class="undefined"></i>
  Middleware
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Redis</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/views/middleware/cache/redis/redis_01_gai-shu.html" class="sidebar-link">Redis_概述</a></li><li><a href="/views/middleware/cache/redis/redis_02_an-zhuang-yu-pei-zhi.html" class="sidebar-link">Redis_安装与配置</a></li><li><a href="/views/middleware/cache/redis/redis_03_shu-ju-cun-chu-lei-xing.html" class="sidebar-link">Redis_数据存储类型</a></li><li><a href="/views/middleware/cache/redis/redis_04_ji-ben-te-xing-ji-yuan-li.html" class="sidebar-link">Redis_基本特性及原理</a></li><li><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html" aria-current="page" class="active sidebar-link">Redis_基本使用</a></li><li><a href="/views/middleware/cache/redis/redis_06_wei-hu-guan-li.html" class="sidebar-link">Redis_维护管理</a></li><li><a href="/views/middleware/cache/redis/redis_07_ji-qun.html" class="sidebar-link">Redis_集群</a></li><li><a href="/views/middleware/cache/redis/redis_08_api.html" class="sidebar-link">Redis_API</a></li><li><a href="/views/middleware/cache/redis/redis_09_yan-shen-jia-gou-wen-ti.html" class="sidebar-link">Redis_延伸架构问题</a></li><li><a href="/views/middleware/cache/redis/redis_10_chang-jian-wen-ti-ji-jie-jue-fang-an.html" class="sidebar-link">Redis_常见问题及解决方案</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-355e03f9 data-v-0f44a727><h3 class="title" data-v-355e03f9 data-v-355e03f9>Redis_基本使用</h3> <!----> <label id="box" class="inputBox" data-v-355e03f9 data-v-355e03f9><input type="password" value="" data-v-355e03f9> <span data-v-355e03f9>Konck! Knock!</span> <button data-v-355e03f9>OK</button></label> <div class="footer" data-v-355e03f9 data-v-355e03f9><span data-v-355e03f9><i class="iconfont reco-theme" data-v-355e03f9></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-355e03f9>vuePress-theme-reco</a></span> <span data-v-355e03f9><i class="iconfont reco-copyright" data-v-355e03f9></i> <a data-v-355e03f9><span data-v-355e03f9>Lingener</span>
            
          <span data-v-355e03f9>2020 - </span>
          2021
        </a></span></div></div> <div data-v-0f44a727><main class="page"><section><div class="page-title"><h1 class="title">Redis_基本使用</h1> <div data-v-5eef61be><i class="iconfont reco-account" data-v-5eef61be><span data-v-5eef61be>Lingener</span></i> <i class="iconfont reco-date" data-v-5eef61be><span data-v-5eef61be>1/18/2021</span></i> <i class="iconfont reco-eye" data-v-5eef61be><span id="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-5eef61be><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="tags iconfont reco-tag" data-v-5eef61be><span class="tag-item" data-v-5eef61be>Redis</span></i></div></div> <div class="theme-reco-content content__default"><h1 id="redis-基本使用"><a href="#redis-基本使用" class="header-anchor">#</a> Redis_基本使用</h1> <h2 id="命令"><a href="#命令" class="header-anchor">#</a> 命令</h2> <h3 id="使用要点"><a href="#使用要点" class="header-anchor">#</a> 使用要点</h3> <ul><li>命令中涉及到range操作的都支持正向索引（1,2,3）和负向索引（-1，-2，-3）</li> <li>Redis虽然提供了很多的命令，但是需要评估每个命令的性能消耗（运行效率、网卡吞吐量）
<ul><li>smembers</li> <li>keys</li></ul></li></ul> <h3 id="help命令"><a href="#help命令" class="header-anchor">#</a> Help命令</h3> <h3 id="server"><a href="#server" class="header-anchor">#</a> @server</h3> <ul><li>config</li></ul> <h3 id="general"><a href="#general" class="header-anchor">#</a> @General</h3> <ul><li>type</li> <li>object</li> <li>del</li> <li>dump</li> <li>exists</li> <li>expire</li> <li>expireat</li> <li>persist</li> <li>pexpire</li> <li>pexpireat</li> <li>pttl</li> <li>keys</li> <li>migrate</li> <li>move</li> <li>randomkey</li> <li>rename</li> <li>renamenx</li></ul> <h3 id="string"><a href="#string" class="header-anchor">#</a> @string</h3> <ul><li><p>set</p></li> <li><p>setnx</p></li> <li><p>setex</p></li> <li><p>setrange</p></li> <li><p>msetnx</p> <p>原子操作</p></li> <li><p>msetex</p></li> <li><p>get</p></li> <li><p>getset</p> <p>设置新值，返回旧值</p></li> <li><p>getrange</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>getrange k1 0 -1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>append</p></li> <li><p>strlen</p></li> <li><p>incr</p></li> <li><p>incrby</p></li> <li><p>incrbyfloat</p></li> <li><p>decr</p></li> <li><p>decrby</p></li> <li><p>setbit</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>setbit k1 1 1
setbit k1 7 1
setbit k1 9 1
// 字符集  ascii其他一般叫做扩展字符集扩展：  其他字符集不在对ascii重编码0xxxxxxx你自己写一个程序，字节流读取，每字节判断
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>bitpos</p> <p>start/end是指字节索引位置</p></li> <li><p>bitcount</p></li> <li><p>bitop</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>setbit k1 1 1
setbit k1 7 1
setbit k2 1 1
setbit k2 6 1
bitop and andkey k1 k2
bitop or orkey k1 k2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ul> <h3 id="list"><a href="#list" class="header-anchor">#</a> @list</h3> <ul><li><p>lpush</p></li> <li><p>lpop</p></li> <li><p>rpush</p></li> <li><p>rpop</p></li> <li><p>lrange</p> <p>lpush</p></li> <li><p>lindex</p></li> <li><p>lset</p></li> <li><p>lrem</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>lpush k1 a b c d a e f a g
lrem k1 2 a  // 移除前两个a
lrem k1 -2 a  // 移除后两个a
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>linsert</p> <div class="language-redis line-numbers-mode"><pre class="language-text"><code>lpush k1 a b c d b e
linsert k1 after b 6 // 如果有两个是在第一个符合条件的数据进行操作
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>llen</p></li> <li><p>blpop</p></li> <li><p>ltrim</p> <p>ltrim k4 0 -1</p> <p>删除范围外两端的数据</p></li></ul> <h3 id="hash"><a href="#hash" class="header-anchor">#</a> @hash</h3> <ul><li><p>hdel</p></li> <li><p>hset</p></li> <li><p>hmset</p></li> <li><p>hget</p></li> <li><p>hmget</p></li> <li><p>hkeys</p></li> <li><p>hvals</p></li> <li><p>hgetall</p></li> <li><p>hincrbyfloat</p></li></ul> <h3 id="set"><a href="#set" class="header-anchor">#</a> @set</h3> <ul><li>sadd</li></ul> <h3 id="sorted-set"><a href="#sorted-set" class="header-anchor">#</a> @sorted set</h3> <h2 id="管道pipelining"><a href="#管道pipelining" class="header-anchor">#</a> 管道Pipelining</h2> <p>一次发送多条操作指令，节省往返时间RTT（Round Trip Time）</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>echo -e &quot;set k2 99\n incr k2\n get k2&quot; | nc localhost 6379
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>使用管道发送命令时，服务器将被迫回复一个队列答复，占用很多内存。所以，如果你需要发送大量的命令，最好是把他们按照合理数量分批次的处理，例如10K的命令，读回复，然后再发送另一个10k的命令，等等。这样速度几乎是相同的，但是在回复这10k命令队列需要非常大量的内存用来组织返回数据内容</p></blockquote> <h2 id="大量插入数据"><a href="#大量插入数据" class="header-anchor">#</a> 大量插入数据</h2> <p>​	使用正常模式的Redis 客户端执行大量数据插入不是一个好主意，因为一个个的插入会有大量的时间浪费在每一个命令往返时间上。使用管道（pipelining）是一种可行的办法，但是在大量插入数据的同时又需要执行其他新命令时，这时读取数据的同时需要确保尽可能快的写入数据。</p> <p>只有一小部分的客户端支持非阻塞输入/输出(non-blocking I/O),并且并不是所有客户端能以最大限度的提高吞吐量的高效的方式来分析答复。</p> <p>例如，如果我们需要生成一个10亿的<code>keyN -&gt; ValueN</code>的大数据集，我们会创建一个如下的redis命令集的文件data.txt：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>SET Key0 Value0
SET Key1 Value1
...
SET KeyN ValueN
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>以前可以使用<strong>netcat</strong>的方式，使用方式如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>(cat data.txt; sleep 10) | nc localhost 6379 &gt; /dev/null
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>然而这并不是一个非常可靠的方式，因为用netcat进行大规模插入时不能检查错误。</strong></p> <p>从Redis 2.6开始<code>redis-cli</code>支持一种新的被称之为<strong>pipe mode</strong>的新模式用于执行大量数据插入工作。</p> <p>使用<strong>pipe mode</strong>模式的执行命令如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cat data.txt | redis-cli --pipe
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这将产生类似如下的输出：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>All data transferred. Waiting for the last reply...
Last reply received from server.
errors: 0, replies: 1000000
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>使用redis-cli将有效的确保错误输出到Redis实例的标准输出里面。</p> <h2 id="pub-sub"><a href="#pub-sub" class="header-anchor">#</a> Pub/Sub</h2> <ul><li><p>只能收到订阅之后发布的消息</p></li> <li><p>使用案例</p> <ul><li>聊天系统</li></ul></li></ul> <p><img src="/Users/lijinling/Documents/svn/myRepo/Coding/DayDayUp/Middleware/Cache/Redis/images/Redis_案例_聊天.png" alt="image-20210713121936501"></p> <h2 id="transactions"><a href="#transactions" class="header-anchor">#</a> transactions</h2> <ul><li><p>特点</p> <ul><li>事务是一个单独的隔离操作：事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客户端发送来的命令请求所打断。</li> <li>事务是一个原子操作：事务中的命令要么全部被执行，要么全部都不执行。</li></ul></li> <li><p>帮助</p> <p><code>help @transactions</code></p></li> <li><p>用法</p> <p><code>MULTI</code>、<code>EXEC</code>、<code>DISCARD</code>和<code>WATCH</code>是Redis事务相关的命令。</p> <ul><li><p><code>MULTI</code>开启事务</p> <ul><li>开启事务之后发送的命令会被放到一个队列中</li></ul></li> <li><p><code>EXCEC</code>负责触发并执行事务中所有的命令</p> <ul><li>如果客户端在使用<code>MULTI</code>开启了一个事务之后，却因为断线而没有成功执行 <code>EXEC</code>，那么事务中的所有命令都不会被执行。</li> <li>另一方面，如果客户端成功在开启事务之后执行 <code>EXEC</code>，那么事务中的所有命令都会被执行。</li></ul></li> <li><p><code>DISCARD</code>放弃执行事务</p> <ul><li>清空事务队列，并且客户端会从事务状态中退出</li></ul></li> <li><p><code>WATCH</code></p> <ul><li><p><code>WATCH</code>某个key，如果被其他事务修改会结束执行返回nil-reply</p></li> <li><p>使用check-and-set操作实现乐观锁</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>WATCH mykey
val = GET mykey
val = val + 1
MULTI
SET mykey $val
EXEC
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ul></li></ul></li> <li><p>事务中的错误</p> <ul><li><p>执行事务之前，入队可能因为语法错误（参数数量错误，参数名错误，等等）或其他更严重的错误（内存不足）出错</p> <p>判断返回值是否是<code>QUEUED</code></p></li> <li><p>调用<code>EXEC</code>之后出错（类型操作错误等）</p></li></ul></li> <li><p>多个事务执行逻辑</p> <p>开启事务之后对应的操作会被缓冲到队列中，哪个事务的<code>EXCEC</code>先到达就先执行哪个事务的任务</p></li> <li><p>为什么不支持回滚</p> <ul><li>Redis只会因为错误的语法失败（并且这些问题不能在入队时发现）或者命令用在错误的数据类型上。也就是说失败的命令是由错误编程造成的，这些问题应该在开发的过程中被发现，而不是生产环境</li> <li>因为不需要回滚，所以Redis内部可以保持简单快捷</li></ul></li> <li><p>check-and-set操作实现乐观锁</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>WATCH mykey
val = GET mykey
val = val + 1
MULTI
SET mykey $val
EXEC
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>使用上面的代码， 如果在 <code>WATCH</code> 执行之后， <code>EXEC</code> 执行之前， 有其他客户端修改了 <code>mykey</code> 的值， 那么当前客户端的事务就会失败。 程序需要做的， 就是不断重试这个操作， 直到没有发生碰撞为止。</p> <p>这种形式的锁被称作乐观锁， 它是一种非常强大的锁机制。 并且因为大多数情况下， 不同的客户端会访问不同的键， 碰撞的情况一般都很少， 所以通常并不需要进行重试。</p></blockquote></li></ul> <h2 id="modules"><a href="#modules" class="header-anchor">#</a> modules</h2> <ul><li><p>如何加载模块</p> <ul><li><p>启动的时候通过参数指定加载</p> <p>redis-server /etc/redis/6379.conf --loadmodule /path/xxx.so</p></li> <li><p>配置文件中配置</p> <p>loadmodule</p></li></ul></li></ul> <h3 id="redisbloom布隆过滤器"><a href="#redisbloom布隆过滤器" class="header-anchor">#</a> Redisbloom布隆过滤器</h3> <p><img src="/Users/lijinling/Documents/svn/myRepo/Coding/DayDayUp/Middleware/Cache/Redis/images/Redis_Bloom.png" alt="image-20210713144303490"></p> <ul><li><p>配置使用</p> <ul><li><p>访问redis.io-&gt;modules查找RedisBloom的<a href="https://github.com/RedisBloom/RedisBloom" target="_blank" rel="noopener noreferrer">github地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>下载源码，解压安装</p> <ul><li><p>unzip *.zip</p></li> <li><p>make</p></li> <li><p>cp bloom.so /opt/mashibing/redis5/</p></li></ul></li> <li><p>启动</p> <p>redis-server --loadmodule  /opt/mashibing/redis5/redisbloom.so</p></li> <li><p>使用</p> <p>redis-cli</p> <p>bf.add ooxx abc</p> <p>bf.exits  abc</p> <p>bf.exits sdfsdf</p> <p>cf.add</p></li></ul></li> <li><p>架构</p> <ul><li>client实现bloom算法自己承载bitmap + Redis</li> <li>client实现bloom算法 + Redis&amp;bitmap</li> <li>client + Redis&amp;Bloom&amp;bitmap</li></ul></li></ul> <h3 id="cukcoo布谷鸟过滤器"><a href="#cukcoo布谷鸟过滤器" class="header-anchor">#</a> cukcoo布谷鸟过滤器</h3> <h2 id="lua脚本"><a href="#lua脚本" class="header-anchor">#</a> Lua脚本</h2> <h2 id="lua脚本调试"><a href="#lua脚本调试" class="header-anchor">#</a> Lua脚本调试</h2> <h2 id="内存优化"><a href="#内存优化" class="header-anchor">#</a> 内存优化</h2> <h2 id="过期"><a href="#过期" class="header-anchor">#</a> 过期</h2> <ul><li><p>过期时间的变化</p> <ul><li>过期时间不会随着访问而改变</li> <li>如果发生写会剔除过期时间，需要业务逻辑去补全</li></ul></li> <li><p>Redis如何淘汰过期的key</p> <ul><li><p>过期两种方式</p> <ul><li><p>被动访问时检测</p> <p>当客户端尝试访问它时，key会被发现并且主动的过期</p></li> <li><p>主动周期轮询判定</p> <p>定时随机测试设置keys的过期时间，所有的这些过期的key将会从秘钥空间删除</p> <ol><li>测试随机的20个keys进行相关过期监测</li> <li>删除所有已经过期的keys</li> <li>如果有多于25%的key过期，重复步骤1</li></ol> <p><strong>这样的话在任何给定的时刻，最多会清楚1/4的过期keys</strong></p></li></ul> <p><strong>这样做的目的是稍微牺牲下内存，但是保住了Redis性能</strong></p></li></ul></li> <li><p>在复制AOF文件时如何处理过期</p></li></ul> <h2 id="lrucache"><a href="#lrucache" class="header-anchor">#</a> LRUCache</h2> <h2 id="从文件中批量导入数据"><a href="#从文件中批量导入数据" class="header-anchor">#</a> 从文件中批量导入数据</h2> <h2 id="分区"><a href="#分区" class="header-anchor">#</a> 分区</h2> <h2 id="分布式锁"><a href="#分布式锁" class="header-anchor">#</a> 分布式锁</h2> <h2 id="key事件通知"><a href="#key事件通知" class="header-anchor">#</a> key事件通知</h2> <h2 id="创建二级索引"><a href="#创建二级索引" class="header-anchor">#</a> 创建二级索引</h2> <h2 id="客户端缓存"><a href="#客户端缓存" class="header-anchor">#</a> 客户端缓存</h2></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/views/middleware/cache/redis/redis_04_ji-ben-te-xing-ji-yuan-li.html" class="prev">
            Redis_基本特性及原理
          </a></span> <span class="next"><a href="/views/middleware/cache/redis/redis_06_wei-hu-guan-li.html">
            Redis_维护管理
          </a></span></p></div> <div class="comments-wrapper" style="display:none;"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-898d6c54><li class="level-2" data-v-898d6c54><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html#命令" class="sidebar-link reco-side-命令" data-v-898d6c54>命令</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html#使用要点" class="sidebar-link reco-side-使用要点" data-v-898d6c54>使用要点</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html#help命令" class="sidebar-link reco-side-help命令" data-v-898d6c54>Help命令</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html#server" class="sidebar-link reco-side-server" data-v-898d6c54>@server</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html#general" class="sidebar-link reco-side-general" data-v-898d6c54>@General</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html#string" class="sidebar-link reco-side-string" data-v-898d6c54>@string</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html#list" class="sidebar-link reco-side-list" data-v-898d6c54>@list</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html#hash" class="sidebar-link reco-side-hash" data-v-898d6c54>@hash</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html#set" class="sidebar-link reco-side-set" data-v-898d6c54>@set</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html#sorted-set" class="sidebar-link reco-side-sorted-set" data-v-898d6c54>@sorted set</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html#管道pipelining" class="sidebar-link reco-side-管道pipelining" data-v-898d6c54>管道Pipelining</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html#大量插入数据" class="sidebar-link reco-side-大量插入数据" data-v-898d6c54>大量插入数据</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html#pub-sub" class="sidebar-link reco-side-pub-sub" data-v-898d6c54>Pub/Sub</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html#transactions" class="sidebar-link reco-side-transactions" data-v-898d6c54>transactions</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html#modules" class="sidebar-link reco-side-modules" data-v-898d6c54>modules</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html#redisbloom布隆过滤器" class="sidebar-link reco-side-redisbloom布隆过滤器" data-v-898d6c54>Redisbloom布隆过滤器</a></li><li class="level-3" data-v-898d6c54><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html#cukcoo布谷鸟过滤器" class="sidebar-link reco-side-cukcoo布谷鸟过滤器" data-v-898d6c54>cukcoo布谷鸟过滤器</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html#lua脚本" class="sidebar-link reco-side-lua脚本" data-v-898d6c54>Lua脚本</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html#lua脚本调试" class="sidebar-link reco-side-lua脚本调试" data-v-898d6c54>Lua脚本调试</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html#内存优化" class="sidebar-link reco-side-内存优化" data-v-898d6c54>内存优化</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html#过期" class="sidebar-link reco-side-过期" data-v-898d6c54>过期</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html#lrucache" class="sidebar-link reco-side-lrucache" data-v-898d6c54>LRUCache</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html#从文件中批量导入数据" class="sidebar-link reco-side-从文件中批量导入数据" data-v-898d6c54>从文件中批量导入数据</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html#分区" class="sidebar-link reco-side-分区" data-v-898d6c54>分区</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html#分布式锁" class="sidebar-link reco-side-分布式锁" data-v-898d6c54>分布式锁</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html#key事件通知" class="sidebar-link reco-side-key事件通知" data-v-898d6c54>key事件通知</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html#创建二级索引" class="sidebar-link reco-side-创建二级索引" data-v-898d6c54>创建二级索引</a></li><li class="level-2" data-v-898d6c54><a href="/views/middleware/cache/redis/redis_05_ji-ben-shi-yong.html#客户端缓存" class="sidebar-link reco-side-客户端缓存" data-v-898d6c54>客户端缓存</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><canvas id="vuepress-canvas-cursor"></canvas><APlayer audio="" fixed="true" mini="true" autoplay="autoplay" theme="#3eaf7c" loop="loop" order="random" preload="auto" volume="0.2" mutex="true" lrc-type="0" list-folded="true" list-max-height="250" storage-name="vuepress-plugin-meting" id="aplayer-fixed"></APlayer></div></div>
    <script src="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/app.0b21ff5c.js" defer></script><script src="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/5.f8fa3a85.js" defer></script><script src="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/1.46137cce.js" defer></script><script src="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/43.9fb64b72.js" defer></script>
  </body>
</html>
