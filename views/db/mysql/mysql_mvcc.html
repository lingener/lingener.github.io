<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySQL_MVCC（多版本并发控制） | 心沉则灵</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="学而不思则罔思而不学则殆!">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/css/0.styles.1ed67386.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/app.0b21ff5c.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/5.f8fa3a85.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/1.46137cce.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/15.edb526f6.js" as="script"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/10.7222c760.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/11.31d5cb55.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/12.ac71a866.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/13.a4862f8f.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/14.7d38783b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/16.ac7c0538.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/17.c2f3c82d.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/18.2858e484.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/19.e3fdb388.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/2.f64b1c52.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/20.de9181b7.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/21.bf18fba2.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/22.89ef57ad.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/23.d1369dc6.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/24.57b2eb10.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/25.279be27c.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/26.77abaa9b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/27.3ebdd851.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/28.3a7441a6.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/29.ce0c7ac7.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/30.5e1d60b3.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/31.8e81922e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/32.f16a296c.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/33.6f85c4d6.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/34.3e2c1671.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/35.08d6b1a5.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/36.2338551e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/37.fd9a8698.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/38.c9dab7de.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/39.ae723246.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/40.fbd466bd.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/41.89cdf369.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/42.b0247ac4.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/43.9fb64b72.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/44.6d1a088b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/45.333ed046.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/46.146a5de6.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/47.d3f7b767.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/48.a52dcdfb.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/49.aa541e45.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/6.3bd08025.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/7.63cd94b3.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/8.3fc861cf.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/9.e143e01a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/vendors~flowchart.2b2fbf5d.js">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/css/0.styles.1ed67386.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-0f44a727><div data-v-0f44a727><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-0f44a727 data-v-0f44a727><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-355e03f9 data-v-0f44a727 data-v-0f44a727><h3 class="title" data-v-355e03f9 data-v-355e03f9>心沉则灵</h3> <p class="description" data-v-355e03f9 data-v-355e03f9>学而不思则罔思而不学则殆!</p> <label id="box" class="inputBox" data-v-355e03f9 data-v-355e03f9><input type="password" value="" data-v-355e03f9> <span data-v-355e03f9>Konck! Knock!</span> <button data-v-355e03f9>OK</button></label> <div class="footer" data-v-355e03f9 data-v-355e03f9><span data-v-355e03f9><i class="iconfont reco-theme" data-v-355e03f9></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-355e03f9>vuePress-theme-reco</a></span> <span data-v-355e03f9><i class="iconfont reco-copyright" data-v-355e03f9></i> <a data-v-355e03f9><span data-v-355e03f9>Lingener</span>
            
          <span data-v-355e03f9>2020 - </span>
          2021
        </a></span></div></div> <div class="hide" data-v-0f44a727><header class="navbar" data-v-0f44a727><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="心沉则灵" class="logo"> <span class="site-name">心沉则灵</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      归档
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Architect/" class="nav-link"><i class="undefined"></i>
  Architect
</a></li><li class="dropdown-item"><!----> <a href="/categories/Microservices/" class="nav-link"><i class="undefined"></i>
  Microservices
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spring/" class="nav-link"><i class="undefined"></i>
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/categories/DB/" class="nav-link"><i class="undefined"></i>
  DB
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/Middleware/" class="nav-link"><i class="undefined"></i>
  Middleware
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-0f44a727></div> <aside class="sidebar" data-v-0f44a727><div class="personal-info-wrapper" data-v-5aaeb100 data-v-0f44a727><!----> <h3 class="name" data-v-5aaeb100>
    Lingener
  </h3> <div class="num" data-v-5aaeb100><div data-v-5aaeb100><h3 data-v-5aaeb100>36</h3> <h6 data-v-5aaeb100>Articles</h6></div> <div data-v-5aaeb100><h3 data-v-5aaeb100>20</h3> <h6 data-v-5aaeb100>Tags</h6></div></div> <ul class="social-links" data-v-5aaeb100></ul> <hr data-v-5aaeb100></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      归档
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Architect/" class="nav-link"><i class="undefined"></i>
  Architect
</a></li><li class="dropdown-item"><!----> <a href="/categories/Microservices/" class="nav-link"><i class="undefined"></i>
  Microservices
</a></li><li class="dropdown-item"><!----> <a href="/categories/Spring/" class="nav-link"><i class="undefined"></i>
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/categories/DB/" class="nav-link"><i class="undefined"></i>
  DB
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/Middleware/" class="nav-link"><i class="undefined"></i>
  Middleware
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>My SQL</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/views/db/mysql/mysql_mvcc.html" aria-current="page" class="active sidebar-link">MySQL_MVCC（多版本并发控制）</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-355e03f9 data-v-0f44a727><h3 class="title" data-v-355e03f9 data-v-355e03f9>MySQL_MVCC（多版本并发控制）</h3> <!----> <label id="box" class="inputBox" data-v-355e03f9 data-v-355e03f9><input type="password" value="" data-v-355e03f9> <span data-v-355e03f9>Konck! Knock!</span> <button data-v-355e03f9>OK</button></label> <div class="footer" data-v-355e03f9 data-v-355e03f9><span data-v-355e03f9><i class="iconfont reco-theme" data-v-355e03f9></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-355e03f9>vuePress-theme-reco</a></span> <span data-v-355e03f9><i class="iconfont reco-copyright" data-v-355e03f9></i> <a data-v-355e03f9><span data-v-355e03f9>Lingener</span>
            
          <span data-v-355e03f9>2020 - </span>
          2021
        </a></span></div></div> <div data-v-0f44a727><main class="page"><section><div class="page-title"><h1 class="title">MySQL_MVCC（多版本并发控制）</h1> <div data-v-5eef61be><i class="iconfont reco-account" data-v-5eef61be><span data-v-5eef61be>Lingener</span></i> <i class="iconfont reco-date" data-v-5eef61be><span data-v-5eef61be>10/20/2020</span></i> <i class="iconfont reco-eye" data-v-5eef61be><span id="/views/db/mysql/mysql_mvcc.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-5eef61be><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="tags iconfont reco-tag" data-v-5eef61be><span class="tag-item" data-v-5eef61be>MySQL</span></i></div></div> <div class="theme-reco-content content__default"><h1 id="mvcc多版本并发控制"><a href="#mvcc多版本并发控制" class="header-anchor">#</a> MVCC多版本并发控制</h1> <h2 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h2> <p>​		MVCC，全称Multi-Version Concurrency Control，即多版本并发控制。MVCC是一种并发控制的方法，一般在数据库管理系统中，实现对数据库的并发访问，在编程语言中实现事务内存。</p> <p>​		MVCC在MySQL InnoDB中的实现主要是为了提高数据库并发性能，用更好的方式去处理读写冲突，做到即使有读写冲突时，也能做到不加锁，非阻塞并发读。</p> <h2 id="前置概念"><a href="#前置概念" class="header-anchor">#</a> 前置概念</h2> <h3 id="当前读"><a href="#当前读" class="header-anchor">#</a> 当前读</h3> <blockquote><p>像select lock in share mode(共享锁), select for update, update, insert ,delete(排他锁)这些操作都是一种当前读，为什么叫当前读？就是它读取的是记录的最新版本，读取时还要保证其他并发事务不能修改当前记录，会对读取的记录进行加锁。</p></blockquote> <h3 id="快照读"><a href="#快照读" class="header-anchor">#</a> 快照读</h3> <blockquote><p>像不加锁的select操作就是快照读，即不加锁的非阻塞读；快照读的前提是隔离级别不是串行级别，串行级别下的快照读会退化成当前读；之所以出现快照读的情况，是基于提高并发性能的考虑，快照读的实现是基于多版本并发控制，即MVCC,可以认为MVCC是行锁的一个变种，但它在很多情况下，避免了加锁操作，降低了开销；既然是基于多版本，即快照读可能读到的并不一定是数据的最新版本，而有可能是之前的历史版本</p></blockquote> <h2 id="当前读、快照读、mvcc关系"><a href="#当前读、快照读、mvcc关系" class="header-anchor">#</a> 当前读、快照读、MVCC关系</h2> <p>​		MVCC多版本并发控制指的是维持一个数据的多个版本，使得读写操作没有冲突，快照读是MySQL为实现MVCC的一个非阻塞读功能。MVCC模块在MySQL中的具体实现是由三个隐式字段，undo日志、read view三个组件来实现的。</p> <h2 id="mvcc解决的问题"><a href="#mvcc解决的问题" class="header-anchor">#</a> MVCC解决的问题</h2> <ul><li><p>数据库并发场景有三种，分别为：</p> <p>1、读读：不存在任何问题，也不需要并发控制</p> <p>2、读写：有线程安全问题，可能会造成事务隔离性问题，可能遇到脏读、幻读、不可重复读</p> <p>3、写写：有线程安全问题，可能存在更新丢失问题</p></li> <li><p>MVCC是一种用来解决读写冲突的无锁并发控制，也就是为事务分配单项增长的时间戳，为每个修改保存一个版本，版本与事务时间戳关联，读操作只读该事务开始前的数据库的快照，所以MVCC可以为数据库解决一下问题：</p> <p>1、在并发读写数据库时，可以做到在读操作时不用阻塞写操作，写操作也不用阻塞读操作，提高了数据库并发读写的性能</p> <p>2、解决脏读、幻读、不可重复读等事务隔离问题，<strong>但是不能解决更新丢失问题</strong></p></li></ul> <h2 id="mvcc实现原理"><a href="#mvcc实现原理" class="header-anchor">#</a> MVCC实现原理</h2> <p>mvcc的实现原理主要依赖于记录中的三个隐藏字段，undolog，read view来实现的。</p> <ul><li><p><strong>隐藏字段</strong></p> <blockquote><p>每行记录除了我们自定义的字段外，还有数据库隐式定义的DB_TRX_ID,DB_ROLL_PTR,DB_ROW_ID等字段</p></blockquote> <ul><li><p>DB_TRX_ID</p> <blockquote><p>6字节，最近修改事务id，记录创建这条记录或者最后一次修改该记录的事务id</p></blockquote></li> <li><p>DB_ROLL_PTR</p> <blockquote><p>7字节，回滚指针，指向这条记录的上一个版本,用于配合undolog，指向上一个旧版本</p></blockquote></li> <li><p>DB_ROW_JD</p> <blockquote><p>6字节，隐藏的主键，如果数据表没有主键，那么innodb会自动生成一个6字节的row_id</p></blockquote></li></ul> <p>记录如图所示：</p> <p><img src="data:image/png;base64,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" alt="image-20210225233929554"></p></li></ul> <p>​		在上图中，DB_ROW_ID是数据库默认为该行记录生成的唯一隐式主键，DB_TRX_ID是当前操作该记录的事务ID，DB_ROLL_PTR是一个回滚指针，用于配合undo日志，指向上一个旧版本</p> <ul><li><strong>undo log</strong></li></ul> <p>​		undolog被称之为回滚日志，表示在进行insert，delete，update操作的时候产生的方便回滚的日志</p> <p>​		当进行insert操作的时候，产生的undolog只在事务回滚的时候需要，并且在事务提交之后可以被立刻丢弃</p> <p>​		当进行update和delete操作的时候，产生的undolog不仅仅在事务回滚的时候需要，在快照读的时候也需要，所以不能随便删除，只有在快照读或事务回滚不涉及该日志时，对应的日志才会被purge线程统一清除（当数据发生更新和删除操作的时候都只是设置一下老记录的deleted_bit，并不是真正的将过时的记录删除，因为为了节省磁盘空间，innodb有专门的purge线程来清除deleted_bit为true的记录，如果某个记录的deleted_id为true，并且DB_TRX_ID相对于purge线程的read view 可见，那么这条记录一定时可以被清除的）</p> <p>​		<strong>下面我们来看一下undolog生成的记录链</strong></p> <p>​		1、假设有一个事务编号为1的事务向表中插入一条记录，那么此时行数据的状态为：</p> <p><img src="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/img/MVCC_1.96a772d1.png" alt="image-20210225235444975"></p> <p>​		2、假设有第二个事务编号为2对该记录的name做出修改，改为lisi</p> <p>​		在事务2修改该行记录数据时，数据库会对该行加排他锁</p> <p>​		然后把该行数据拷贝到undolog中，作为 旧记录，即在undolog中有当前行的拷贝副本</p> <p>​		拷贝完毕后，修改该行name为lisi，并且修改隐藏字段的事务id为当前事务2的id，回滚指针指向拷贝到undolog的副本记录中</p> <p>​		事务提交后，释放锁</p> <p><img src="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/img/MVCC_2.441f3b87.png" alt="image-20210313220450629"></p> <p>​		3、假设有第三个事务编号为3对该记录的age做了修改，改为32</p> <p>​		在事务3修改该行数据的时，数据库会对该行加排他锁</p> <p>​		然后把该行数据拷贝到undolog中，作为旧纪录，发现该行记录已经有undolog了，那么最新的旧数据作为链表的表头，插在该行记录的undolog最前面</p> <p>​		修改该行age为32岁，并且修改隐藏字段的事务id为当前事务3的id，回滚指针指向刚刚拷贝的undolog的副本记录</p> <p>​		事务提交，释放锁</p> <p><img src="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/img/MVCC_3.426f1675.png" alt="image-20210313220337624"></p> <p>​		从上述的一系列图中，大家可以发现，不同事务或者相同事务的对同一记录的修改，会导致该记录的undolog生成一条记录版本线性表，即链表，undolog的链首就是最新的旧记录，链尾就是最早的旧记录。</p> <p>​		<strong>Read View</strong></p> <p>​		上面的流程如果看明白了，那么大家需要再深入理解下read view的概念了。</p> <p>​		Read View是事务进行快照读操作的时候生产的读视图，在该事务执行快照读的那一刻，会生成一个数据系统当前的快照，记录并维护系统当前活跃事务的id，事务的id值是递增的。</p> <p>​		其实Read View的最大作用是用来做可见性判断的，也就是说当某个事务在执行快照读的时候，对该记录创建一个Read View的视图，把它当作条件去判断当前事务能够看到哪个版本的数据，有可能读取到的是最新的数据，也有可能读取的是当前行记录的undolog中某个版本的数据</p> <p>​		Read View遵循的可见性算法主要是将要被修改的数据的最新记录中的DB_TRX_ID（当前事务id）取出来，与系统当前其他活跃事务的id去对比，如果DB_TRX_ID跟Read View的属性做了比较，不符合可见性，那么就通过DB_ROLL_PTR回滚指针去取出undolog中的DB_TRX_ID做比较，即遍历链表中的DB_TRX_ID，直到找到满足条件的DB_TRX_ID,这个DB_TRX_ID所在的旧记录就是当前事务能看到的最新老版本数据。</p> <p>​		Read View的可见性规则如下所示：</p> <p>​		首先要知道Read View中的三个全局属性：</p> <p>​		trx_list:一个数值列表，用来维护Read View生成时刻系统正活跃的事务ID（1,2,3）</p> <p>​		up_limit_id:记录trx_list列表中事务ID最小的ID（1）</p> <p>​		low_limit_id:Read View生成时刻系统尚未分配的下一个事务ID，（4）</p> <p>​		具体的比较规则如下：</p> <p>​		1、首先比较DB_TRX_ID &lt; up_limit_id,如果小于，则当前事务能看到DB_TRX_ID所在的记录，如果大于等于进入下一个判断</p> <p>​		2、接下来判断DB_TRX_ID &gt;= low_limit_id,如果大于等于则代表DB_TRX_ID所在的记录在Read View生成后才出现的，那么对于当前事务肯定不可见，如果小于，则进入下一步判断</p> <p>​		3、判断DB_TRX_ID是否在活跃事务中，如果在，则代表在Read View生成时刻，这个事务还是活跃状态，还没有commit，修改的数据，当前事务也是看不到，如果不在，则说明这个事务在Read View生成之前就已经开始commit，那么修改的结果是能够看见的。</p> <h2 id="mvcc的整体处理流程"><a href="#mvcc的整体处理流程" class="header-anchor">#</a> MVCC的整体处理流程</h2> <p>假设有四个事务同时在执行，如下图所示：</p> <table><thead><tr><th style="text-align:center;">事务1</th> <th style="text-align:center;">事务2</th> <th style="text-align:center;">事务3</th> <th style="text-align:center;">事务4</th></tr></thead> <tbody><tr><td style="text-align:center;">事务开始</td> <td style="text-align:center;">事务开始</td> <td style="text-align:center;">事务开始</td> <td style="text-align:center;">事务开始</td></tr> <tr><td style="text-align:center;">......</td> <td style="text-align:center;">......</td> <td style="text-align:center;">......</td> <td style="text-align:center;">修改且已提交</td></tr> <tr><td style="text-align:center;">进行中</td> <td style="text-align:center;">快照读</td> <td style="text-align:center;">进行中</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">......</td> <td style="text-align:center;">......</td> <td style="text-align:center;">......</td> <td style="text-align:center;"></td></tr></tbody></table> <p>从上述表格中，我们可以看到，当事务2对某行数据执行了快照读，数据库为该行数据生成一个Read View视图，可以看到事务1和事务3还在活跃状态，事务4在事务2快照读的前一刻提交了更新，所以，在Read View中记录了系统当前活跃事务1，3，维护在一个列表中。同时可以看到up_limit_id的值为1，而low_limit_id为5，如下图所示：</p> <p><img src="data:image/png;base64,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" alt="image-20210227183316573"></p> <p>在上述的例子中，只有事务4修改过该行记录，并在事务2进行快照读前，就提交了事务，所以该行当前数据的undolog如下所示：</p> <p><img src="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/img/MVCC_5.8bf893cf.png" alt="image-20210227183849998"></p> <p>​		当事务2在快照读该行记录的是，会拿着该行记录的DB_TRX_ID去跟up_limit_id,lower_limit_id和活跃事务列表进行比较，判读事务2能看到该行记录的版本是哪个。</p> <p>​		具体流程如下：先拿该行记录的事务ID（4）去跟Read View中的up_limit_id相比较，判断是否小于，通过对比发现不小于，所以不符合条件，继续判断4是否大于等于low_limit_id,通过比较发现也不大于，所以不符合条件，判断事务4是否处理trx_list列表中，发现不再次列表中，那么符合可见性条件，所以事务4修改后提交的最新结果对事务2 的快照是可见的，因此，事务2读取到的最新数据记录是事务4所提交的版本，而事务4提交的版本也是全局角度的最新版本。如下图所示：</p> <p><img src="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/img/MVCC_6.0a627d72.png" alt="image-20210227185820394"></p> <p>当上述的内容都看明白了的话，那么大家就应该能够搞清楚这几个核心概念之间的关系了，下面我们讲一个不同的隔离级别下的快照读的不同。</p> <h2 id="rc、rr级别下的innodb快照读有什么不同"><a href="#rc、rr级别下的innodb快照读有什么不同" class="header-anchor">#</a> RC、RR级别下的InnoDB快照读有什么不同</h2> <p>​		因为Read View生成时机的不同，从而造成RC、RR级别下快照读的结果的不同</p> <p>​		1、在RR级别下的某个事务的对某条记录的第一次快照读会创建一个快照即Read View,将当前系统活跃的其他事务记录起来，此后在调用快照读的时候，还是使用的是同一个Read View,所以只要当前事务在其他事务提交更新之前使用过快照读，那么之后的快照读使用的都是同一个Read View,所以对之后的修改不可见</p> <p>​		2、在RR级别下，快照读生成Read View时，Read View会记录此时所有其他活动和事务的快照，这些事务的修改对于当前事务都是不可见的，而早于Read View创建的事务所做的修改均是可见</p> <p>​		3、在RC级别下，事务中，每次快照读都会新生成一个快照和Read View,这就是我们在RC级别下的事务中可以看到别的事务提交的更新的原因。</p> <p>​		<strong>总结：在RC隔离级别下，是每个快照读都会生成并获取最新的Read View,而在RR隔离级别下，则是同一个事务中的第一个快照读才会创建Read View，之后的快照读获取的都是同一个Read View.</strong></p></div></section> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="comments-wrapper" style="display:none;"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-898d6c54><li class="level-2" data-v-898d6c54><a href="/views/db/mysql/mysql_mvcc.html#概述" class="sidebar-link reco-side-概述" data-v-898d6c54>概述</a></li><li class="level-2" data-v-898d6c54><a href="/views/db/mysql/mysql_mvcc.html#前置概念" class="sidebar-link reco-side-前置概念" data-v-898d6c54>前置概念</a></li><li class="level-3" data-v-898d6c54><a href="/views/db/mysql/mysql_mvcc.html#当前读" class="sidebar-link reco-side-当前读" data-v-898d6c54>当前读</a></li><li class="level-3" data-v-898d6c54><a href="/views/db/mysql/mysql_mvcc.html#快照读" class="sidebar-link reco-side-快照读" data-v-898d6c54>快照读</a></li><li class="level-2" data-v-898d6c54><a href="/views/db/mysql/mysql_mvcc.html#当前读、快照读、mvcc关系" class="sidebar-link reco-side-当前读、快照读、mvcc关系" data-v-898d6c54>当前读、快照读、MVCC关系</a></li><li class="level-2" data-v-898d6c54><a href="/views/db/mysql/mysql_mvcc.html#mvcc解决的问题" class="sidebar-link reco-side-mvcc解决的问题" data-v-898d6c54>MVCC解决的问题</a></li><li class="level-2" data-v-898d6c54><a href="/views/db/mysql/mysql_mvcc.html#mvcc实现原理" class="sidebar-link reco-side-mvcc实现原理" data-v-898d6c54>MVCC实现原理</a></li><li class="level-2" data-v-898d6c54><a href="/views/db/mysql/mysql_mvcc.html#mvcc的整体处理流程" class="sidebar-link reco-side-mvcc的整体处理流程" data-v-898d6c54>MVCC的整体处理流程</a></li><li class="level-2" data-v-898d6c54><a href="/views/db/mysql/mysql_mvcc.html#rc、rr级别下的innodb快照读有什么不同" class="sidebar-link reco-side-rc、rr级别下的innodb快照读有什么不同" data-v-898d6c54>RC、RR级别下的InnoDB快照读有什么不同</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><canvas id="vuepress-canvas-cursor"></canvas><APlayer audio="" fixed="true" mini="true" autoplay="autoplay" theme="#3eaf7c" loop="loop" order="random" preload="auto" volume="0.2" mutex="true" lrc-type="0" list-folded="true" list-max-height="250" storage-name="vuepress-plugin-meting" id="aplayer-fixed"></APlayer></div></div>
    <script src="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/app.0b21ff5c.js" defer></script><script src="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/5.f8fa3a85.js" defer></script><script src="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/1.46137cce.js" defer></script><script src="https://cdn.jsdelivr.net/gh/lingener/lingener.github.io/assets/js/15.edb526f6.js" defer></script>
  </body>
</html>
