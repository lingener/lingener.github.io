(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{683:function(e,v,i){"use strict";i.r(v);var l=i(3),s=Object(l.a)({},(function(){var e=this,v=e.$createElement,i=e._self._c||v;return i("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[i("h1",{attrs:{id:"redis维护管理"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#redis维护管理"}},[e._v("#")]),e._v(" Redis维护管理")]),e._v(" "),i("h2",{attrs:{id:"redis配置"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#redis配置"}},[e._v("#")]),e._v(" Redis配置")]),e._v(" "),i("ul",[i("li",[i("p",[e._v("include")]),e._v(" "),i("p",[e._v("include /path/to/local.conf")]),e._v(" "),i("p",[e._v("引入其他配置文件")])]),e._v(" "),i("li",[i("p",[e._v("loadmodule")]),e._v(" "),i("p",[e._v("加载模块")])]),e._v(" "),i("li",[i("p",[e._v("network")]),e._v(" "),i("ul",[i("li",[i("p",[e._v("bind")]),e._v(" "),i("p",[e._v("绑定host")])]),e._v(" "),i("li",[i("p",[e._v("protected-mode")]),e._v(" "),i("p",[e._v("保护模式，默认redis需要设置管理员账号密码,开启了保护模式，如果第一次使用没有设置管理员,就会出现报错,关闭保护模式即可")])]),e._v(" "),i("li",[i("p",[e._v("port")])]),e._v(" "),i("li",[i("p",[e._v("tcp-backlog")])]),e._v(" "),i("li",[i("p",[e._v("timeout")])]),e._v(" "),i("li",[i("p",[e._v("tcp-keepalive")])])])]),e._v(" "),i("li",[i("p",[e._v("general")]),e._v(" "),i("ul",[i("li",[e._v("daemonize")]),e._v(" "),i("li",[e._v("supervised")]),e._v(" "),i("li",[e._v("pidfile")]),e._v(" "),i("li",[e._v("loglevel")]),e._v(" "),i("li",[e._v("logfile")]),e._v(" "),i("li",[e._v("databases")]),e._v(" "),i("li",[e._v("always-show-logo")])])]),e._v(" "),i("li",[i("p",[e._v("snapshotting")]),e._v(" "),i("ul",[i("li",[e._v("save")]),e._v(" "),i("li",[e._v("stop-writes-on-bgsave-error")]),e._v(" "),i("li",[e._v("rdbcompression")]),e._v(" "),i("li",[e._v("rdbchecksum")]),e._v(" "),i("li",[e._v("dbfilename")]),e._v(" "),i("li",[e._v("dir")])])]),e._v(" "),i("li",[i("p",[e._v("replication")]),e._v(" "),i("ul",[i("li",[i("p",[e._v("replica-serve-stale-data")])]),e._v(" "),i("li",[i("p",[e._v("replica-read-only")])]),e._v(" "),i("li",[i("p",[e._v("repl-diskless-sync")]),e._v(" "),i("p",[e._v("主将数据写入磁盘文件中传给从还是直接将数据通过网络传给从")]),e._v(" "),i("ul",[i("li",[e._v("yes 写入磁盘文件再传给从导入")]),e._v(" "),i("li",[e._v("no  通过网络直接传输")])])]),e._v(" "),i("li",[i("p",[e._v("repl-diskless-sync-delay")])]),e._v(" "),i("li",[i("p",[e._v("repl-disable-tcp-nodelay")])]),e._v(" "),i("li",[i("p",[e._v("repl-backlog-size")]),e._v(" "),i("p",[e._v("增量复制")])])])]),e._v(" "),i("li",[i("p",[e._v("memory mamagement")]),e._v(" "),i("ul",[i("li",[e._v("maxmemory")]),e._v(" "),i("li",[e._v("maxmemory-policy\n"),i("ul",[i("li",[e._v("volatile-lru -> Evict using approximated LRU among the keys with an expire set.")]),e._v(" "),i("li",[e._v("allkeys-lru -> Evict any key using approximated LRU.(LRU最久没有使用)")]),e._v(" "),i("li",[e._v("volatile-lfu -> Evict using approximated LFU among the keys with an expire set.（LFU最少使用）")]),e._v(" "),i("li",[e._v("allkeys-lfu -> Evict any key using approximated LFU.")]),e._v(" "),i("li",[e._v("volatile-random -> Remove a random key among the ones with an expire set.")]),e._v(" "),i("li",[e._v("allkeys-random -> Remove a random key, any key.")]),e._v(" "),i("li",[e._v("volatile-ttl -> Remove the key with the nearest expire time (minor TTL)")]),e._v(" "),i("li",[e._v("noeviction -> Don't evict anything, just return an error on write operations.")])])])])]),e._v(" "),i("li",[i("p",[e._v("append only mode")]),e._v(" "),i("ul",[i("li",[i("p",[e._v("appendonly")])]),e._v(" "),i("li",[i("p",[e._v("appendfilename")])]),e._v(" "),i("li",[i("p",[e._v("appendsync")])]),e._v(" "),i("li",[i("p",[e._v("no-appendfsync-on-rewrite")]),e._v(" "),i("p",[e._v("如果redis判断正在执行save或者aof操作向磁盘疯狂写数据时就会走appendsync no 的方式，这样的风险就是丢失数据")])])])]),e._v(" "),i("li",[i("p",[e._v("最大连接数")])]),e._v(" "),i("li",[i("p",[e._v("最大内存（1G-10G）")])])]),e._v(" "),i("h2",{attrs:{id:"主从复制"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#主从复制"}},[e._v("#")]),e._v(" 主从复制")]),e._v(" "),i("ul",[i("li",[i("p",[e._v("Redis默认是使用异步复制的方法")]),e._v(" "),i("ul",[i("li",[i("p",[e._v("特点是低延迟和高性能")])]),e._v(" "),i("li",[i("p",[e._v("Redis本身追求的是高性能，会尽量减少其他技术的整合")])]),e._v(" "),i("li",[i("p",[e._v("增量同步")]),e._v(" "),i("p",[e._v("如果一个从故障宕机重启恢复后采用增量同步方式跟主保持一致")])]),e._v(" "),i("li",[i("p",[e._v("主是可以知道有哪些从在追随他，配置的时候都会向主去注册")])])])]),e._v(" "),i("li",[i("p",[e._v("部署实践")]),e._v(" "),i("ul",[i("li",[i("p",[e._v("准备")]),e._v(" "),i("ul",[i("li",[e._v("三个实例 6379、6380、6381")])])]),e._v(" "),i("li",[i("p",[e._v("修改配置文件为非后台运行（daemonize no），以及日志文件控制台输出（注释logfile）")])]),e._v(" "),i("li",[i("p",[e._v("命令配置主从")]),e._v(" "),i("div",{staticClass:"language-redis line-numbers-mode"},[i("pre",{pre:!0,attrs:{class:"language-text"}},[i("code",[e._v("slaveof host port   // Redis 5以前\nreplicaof host port // Redis 5以后\n")])]),e._v(" "),i("div",{staticClass:"line-numbers-wrapper"},[i("span",{staticClass:"line-number"},[e._v("1")]),i("br"),i("span",{staticClass:"line-number"},[e._v("2")]),i("br")])])]),e._v(" "),i("li",[i("p",[e._v("启动参数配置主从")]),e._v(" "),i("div",{staticClass:"language- line-numbers-mode"},[i("pre",{pre:!0,attrs:{class:"language-text"}},[i("code",[e._v("redis-server ./6381.conf --replicaof 127.0.0.1 6379\nredis-server ./6381.conf --replicaof 127.0.0.1 6379 --readonly yes\n")])]),e._v(" "),i("div",{staticClass:"line-numbers-wrapper"},[i("span",{staticClass:"line-number"},[e._v("1")]),i("br"),i("span",{staticClass:"line-number"},[e._v("2")]),i("br")])])]),e._v(" "),i("li",[i("p",[e._v("取消追随")]),e._v(" "),i("div",{staticClass:"language- line-numbers-mode"},[i("pre",{pre:!0,attrs:{class:"language-text"}},[i("code",[e._v("slaveof no one      // 取消追随\nreplicaof no one    // 取消追随\n")])]),e._v(" "),i("div",{staticClass:"line-numbers-wrapper"},[i("span",{staticClass:"line-number"},[e._v("1")]),i("br"),i("span",{staticClass:"line-number"},[e._v("2")]),i("br")])])])])])]),e._v(" "),i("h2",{attrs:{id:"ha高可用"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#ha高可用"}},[e._v("#")]),e._v(" HA高可用")]),e._v(" "),i("h3",{attrs:{id:"sentinel-哨兵"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#sentinel-哨兵"}},[e._v("#")]),e._v(" Sentinel（哨兵）")]),e._v(" "),i("ul",[i("li",[i("p",[e._v("监控")]),e._v(" "),i("ul",[i("li",[i("p",[e._v("主是知道有哪些从追随他的，所以监控主就只有从的信息")])]),e._v(" "),i("li",[i("p",[e._v("Sentinel是如何知道其他Sentinel的呢？")]),e._v(" "),i("p",[i("strong",[e._v("通过发布订阅来获取")])]),e._v(" "),i("p",[e._v("psubscribe")])]),e._v(" "),i("li",[i("p",[e._v("Sentinel是会修改配置文件的，比如主故障了，重新推选出主之后会修改配置信息")])])])]),e._v(" "),i("li",[i("p",[e._v("配置Sentinel")]),e._v(" "),i("ul",[i("li",[i("p",[e._v("添加配置文件（26379.conf）")]),e._v(" "),i("div",{staticClass:"language- line-numbers-mode"},[i("pre",{pre:!0,attrs:{class:"language-text"}},[i("code",[e._v("port 26379\nsentinel monitor mymaster 127.0.0.1 6379 2\n")])]),e._v(" "),i("div",{staticClass:"line-numbers-wrapper"},[i("span",{staticClass:"line-number"},[e._v("1")]),i("br"),i("span",{staticClass:"line-number"},[e._v("2")]),i("br")])])]),e._v(" "),i("li",[i("p",[e._v("启动Sentinel")]),e._v(" "),i("div",{staticClass:"language- line-numbers-mode"},[i("pre",{pre:!0,attrs:{class:"language-text"}},[i("code",[e._v("redis-sentinel /etc/redis/26379.conf\nredis-server /etc/redis/26379.conf --sentinel\n")])]),e._v(" "),i("div",{staticClass:"line-numbers-wrapper"},[i("span",{staticClass:"line-number"},[e._v("1")]),i("br"),i("span",{staticClass:"line-number"},[e._v("2")]),i("br")])])])])])])])}),[],!1,null,null,null);v.default=s.exports}}]);