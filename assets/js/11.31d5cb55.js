(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{554:function(s,a,t){s.exports=t.p+"assets/img/七层负载均衡网络.a37c2fa9.png"},555:function(s,a,t){s.exports=t.p+"assets/img/四层负载均衡网络.fbd92668.png"},556:function(s,a,t){s.exports=t.p+"assets/img/负载均衡拓扑图.397647db.png"},557:function(s,a,t){s.exports=t.p+"assets/img/D-NAT.d72e965c.png"},558:function(s,a,t){s.exports=t.p+"assets/img/DR.9c82fb4a.png"},559:function(s,a,t){s.exports=t.p+"assets/img/隐藏VIP.e1d180fd.png"},560:function(s,a,t){s.exports=t.p+"assets/img/TUN隧道模式.e652a841.png"},561:function(s,a,t){s.exports=t.p+"assets/img/LVS实验模型.656e048d.png"},661:function(s,a,t){"use strict";t.r(a);var e=t(3),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"负载均衡"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡"}},[s._v("#")]),s._v(" 负载均衡")]),s._v(" "),e("h2",{attrs:{id:"七层负载均衡"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#七层负载均衡"}},[s._v("#")]),s._v(" 七层负载均衡")]),s._v(" "),e("p",[s._v("nginx是基于反向代理的负载均衡，做了三次握手")]),s._v(" "),e("p",[e("img",{attrs:{src:t(554),alt:"image-20210629141110991"}})]),s._v(" "),e("h2",{attrs:{id:"四层负载均衡"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四层负载均衡"}},[s._v("#")]),s._v(" 四层负载均衡")]),s._v(" "),e("p",[s._v("请求到达传输控制层的时候只是看了一下端口号，做数据包转发，并没有走三次握手")]),s._v(" "),e("p",[e("img",{attrs:{src:t(555),alt:"image-20210628152920340"}})]),s._v(" "),e("p",[e("img",{attrs:{src:t(556),alt:"image-20210628233401765"}})]),s._v(" "),e("h2",{attrs:{id:"负载均衡的模式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡的模式"}},[s._v("#")]),s._v(" 负载均衡的模式")]),s._v(" "),e("h3",{attrs:{id:"d-nat-目标地址转换"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#d-nat-目标地址转换"}},[s._v("#")]),s._v(" D-NAT（目标地址转换）")]),s._v(" "),e("p",[e("img",{attrs:{src:t(557),alt:"image-20210628230346601"}})]),s._v(" "),e("ul",[e("li",[s._v("非对称的\n"),e("ul",[e("li",[s._v("发送数据包小，回复的数据包大")])])])]),s._v(" "),e("h3",{attrs:{id:"dr-直接路由模式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#dr-直接路由模式"}},[s._v("#")]),s._v(" DR（直接路由模式）")]),s._v(" "),e("p",[e("img",{attrs:{src:t(558),alt:"image-20210628231108849"}})]),s._v(" "),e("ul",[e("li",[e("p",[e("strong",[s._v("如何隐藏VIP")])]),s._v(" "),e("p",[e("img",{attrs:{src:t(559),alt:"image-20210629003028772"}})]),s._v(" "),e("p",[s._v("对外隐藏，对内可见")]),s._v(" "),e("p",[s._v("kernel parameter:\n目标mac地址为全F，交换机触发广播\n/proc/sys/net/ipv4/conf/"),e("em",[s._v("IF")]),s._v("/\narp_ignore: 定义接收到ARP请求时的响应级别；\n0：只要本地配置的有相应地址，就给予响应；\n1：仅在请求的目标(MAC)地址配置请求\n到达的接口上的时候，才给予响应；")]),s._v(" "),e("p",[s._v("arp_announce：定义将自己地址向外通告时的通告级别；\n0：将本地任何接口上的任何地址向外通告；\n1：试图仅向目标网络通告与其网络匹配的地址；\n2：仅向与本地接口上地址匹配的网络进行通告；")])])]),s._v(" "),e("h3",{attrs:{id:"tun-隧道技术"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#tun-隧道技术"}},[s._v("#")]),s._v(" TUN（隧道技术 ）")]),s._v(" "),e("p",[e("img",{attrs:{src:t(560),alt:"image-20210628234002218"}})]),s._v(" "),e("ul",[e("li",[s._v("DIP->RIP数据包背上CIP->VIP")]),s._v(" "),e("li",[s._v("VPN")])]),s._v(" "),e("h1",{attrs:{id:"lvs"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#lvs"}},[s._v("#")]),s._v(" LVS")]),s._v(" "),e("p",[s._v("Linux内核集成了LVS叫ipvs模块，管理程序ipvsadmin")]),s._v(" "),e("h2",{attrs:{id:"调度算法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#调度算法"}},[s._v("#")]),s._v(" 调度算法")]),s._v(" "),e("h3",{attrs:{id:"静态调度方法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#静态调度方法"}},[s._v("#")]),s._v(" 静态调度方法")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("rr")]),s._v(" "),e("p",[s._v("轮循")])]),s._v(" "),e("li",[e("p",[s._v("wrr")]),s._v(" "),e("p",[s._v("加权轮询，根据权重轮询")])]),s._v(" "),e("li",[e("p",[s._v("dh:")])]),s._v(" "),e("li",[e("p",[s._v("sh:")])])]),s._v(" "),e("h3",{attrs:{id:"动态调度方法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#动态调度方法"}},[s._v("#")]),s._v(" 动态调度方法")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("lc: 最少连接")])]),s._v(" "),e("li",[e("p",[s._v("wlc: 加权最少连接")])]),s._v(" "),e("li",[e("p",[s._v("sed: 最短期望延迟")])]),s._v(" "),e("li",[e("p",[s._v("nq: never queue")])]),s._v(" "),e("li",[e("p",[s._v("LBLC: 基于本地的最少连接")])]),s._v(" "),e("li",[e("p",[s._v("DH:")])]),s._v(" "),e("li",[e("p",[s._v("LBLCR: 基于本地的带复制功能的最少连接")])])]),s._v(" "),e("h3",{attrs:{id:"如何知道哪个负载机负载了多少"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#如何知道哪个负载机负载了多少"}},[s._v("#")]),s._v(" 如何知道哪个负载机负载了多少？")]),s._v(" "),e("p",[s._v("偷窥——只看不动手")]),s._v(" "),e("p",[s._v("偷窥握手和分手包信息，对负载机的负载进行管理")]),s._v(" "),e("h2",{attrs:{id:"lvs搭建"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#lvs搭建"}},[s._v("#")]),s._v(" LVS搭建")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("安装管理程序")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("yum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" ipvsadmin -y\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])])]),s._v(" "),e("h2",{attrs:{id:"lvs配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#lvs配置"}},[s._v("#")]),s._v(" LVS配置")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("管理集群服务")]),s._v(" "),e("ul",[e("li",[s._v("添加：-A -t|u|f service-address [-s scheduler]\n-t: TCP协议的集群\n-u: UDP协议的集群\nservice-address:   IP:PORT\n-f: FWM: 防火墙标记\nservice-address: Mark Number")]),s._v(" "),e("li",[s._v("修改：-E")]),s._v(" "),e("li",[s._v("删除：-D -t|u|f service-address")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ipvsadm -A -t 192.168.9.100:80 -s rr\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("管理集群服务中的RS")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("添加：-a -t|u|f service-address -r server-address [-g|i|m] [-w weight]\n-t|u|f service-address：事先定义好的某集群服务\n-r server-address: 某RS的地址，在NAT模型中，可使用IP：PORT实现端口映射；")]),s._v(" "),e("p",[s._v("[-g|i|m] : LVS类型")]),s._v(" "),e("p",[s._v("-g: DR\n-i: TUN\n-m: NAT")]),s._v(" "),e("p",[s._v("[ -w weight] 定义服务器权重")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ipvsadm -a -t 172.16.100.1:80 -r 192.168.10.8 –g\nipvsadm -a -t 172.16.100.1:80 -r 192.168.10.9 -g\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("修改：-e")])]),s._v(" "),e("li",[e("p",[s._v("删除：-d -t|u|f service-address -r server-address")])]),s._v(" "),e("li",[e("p",[s._v("查看\n-L|l\n-n: 数字格式显示主机地址和端口\n--stats：统计数据\n--rate: 速率\n--timeout: 显示tcp、tcpfin和udp的会话超时时长\n-:c 显示当前的ipvs连接状况")])]),s._v(" "),e("li",[e("p",[s._v("删除所有集群服务\n-C：清空ipvs规则")])]),s._v(" "),e("li",[e("p",[s._v("保存规则\n-S")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ipvsadm -S > /path/to/somefile\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("载入此前的规则：\n-R")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ipvsadm -R < /path/form/somefile\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])])])])]),s._v(" "),e("h2",{attrs:{id:"lvs实验"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#lvs实验"}},[s._v("#")]),s._v(" LVS实验")]),s._v(" "),e("h3",{attrs:{id:"拓扑图"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#拓扑图"}},[s._v("#")]),s._v(" 拓扑图")]),s._v(" "),e("p",[e("img",{attrs:{src:t(561),alt:"image-20210629103629542"}})]),s._v(" "),e("h3",{attrs:{id:"配置网络"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置网络"}},[s._v("#")]),s._v(" 配置网络")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("node01")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ifconfig eth0:8 192.168.150.100/24\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])])]),s._v(" "),e("ul",[e("li",[e("p",[s._v("node02 & node03")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("修改内核协议")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("cd /proc/sys/net/ipv4/conf/\ncd eth0\necho 1 > arp_ignore\necho 2 > arp_annonce\ncd ../all\necho 1 > arp_ignore\necho 2 > arp_annonce\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("设置隐藏的vip")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ifconfig lo2 192.168.150.100 netmark **255.255.255.255**\n#ifconfig lo2 down\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])])])])])]),s._v(" "),e("h3",{attrs:{id:"安装启动服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装启动服务"}},[s._v("#")]),s._v(" 安装启动服务")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("node02~node03:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("yum install httpd -y\nservice httpd start\nvi   /var/www/html/index.html\n# from 192.168.150.1x\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])])])]),s._v(" "),e("h3",{attrs:{id:"lvs服务配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#lvs服务配置"}},[s._v("#")]),s._v(" LVS服务配置")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("node01:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("yum install ipvsadm\nipvsadm -A  -t  192.168.150.100:80  -s rr\nipvsadm -a  -t 192.168.150.100:80  -r  192.168.150.12 -g -w 1\nipvsadm -a  -t 192.168.150.100:80  -r  192.168.150.13 -g -w 1\nipvsadm -ln\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])])])]),s._v(" "),e("h3",{attrs:{id:"验证"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#验证"}},[s._v("#")]),s._v(" 验证")]),s._v(" "),e("p",[s._v("​\t浏览器访问  192.168.150.100   看到负载  疯狂F5\n​\tnode01：\n​\t\tnetstat -natp   结论看不到socket连接\n​\tnode02~node03:\n​\t\tnetstat -natp   结论看到很多的socket连接\n​\tnode01:\n​\t\tipvsadm -lnc    查看偷窥记录本\n​\t\tTCP 00:57  FIN_WAIT    192.168.150.1:51587 192.168.150.100:80 192.168.150.12:80\n​\t\tFIN_WAIT： 连接过，偷窥了所有的包\n​\t\tSYN_RECV： 基本上lvs都记录了，证明lvs没事，一定是后边网络层出问题")]),s._v(" "),e("h1",{attrs:{id:"高用用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#高用用"}},[s._v("#")]),s._v(" 高用用")]),s._v(" "),e("h2",{attrs:{id:"故障点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#故障点"}},[s._v("#")]),s._v(" 故障点")]),s._v(" "),e("h3",{attrs:{id:"lvs单点问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#lvs单点问题"}},[s._v("#")]),s._v(" lvs单点问题")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("影响")]),s._v(" "),e("p",[s._v("业务下线")])]),s._v(" "),e("li",[e("p",[s._v("解决")]),s._v(" "),e("hr"),s._v(" "),e("ul",[e("li")])])]),s._v(" "),e("h3",{attrs:{id:"rs-real-server-故障"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rs-real-server-故障"}},[s._v("#")]),s._v(" RS（Real Server）故障")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("影响")]),s._v(" "),e("p",[s._v("部分部分用户请求异常，lvs还存有这个rs的负载记录")])]),s._v(" "),e("li",[e("p",[s._v("如何判断故障")]),s._v(" "),e("p",[s._v("访问一下，返回200 ok ，底层验证的是应用层的http协议")])])]),s._v(" "),e("h2",{attrs:{id:"解决方案分析"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#解决方案分析"}},[s._v("#")]),s._v(" 解决方案分析")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("单点问题")]),s._v(" "),e("p",[s._v("一变多")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("主备")]),s._v(" "),e("p",[s._v("如何判断主挂了？")]),s._v(" "),e("ul",[e("li",[s._v("方向性\n"),e("ul",[e("li",[s._v("主定时广播")]),s._v(" "),e("li",[s._v("备定时询问")])])]),s._v(" "),e("li",[s._v("效率性\n"),e("ul",[e("li",[s._v("定义判断条件")])])])])]),s._v(" "),e("li",[e("p",[s._v("主主")])])]),s._v(" "),e("p",[s._v("实现")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("修改源码加逻辑")])]),s._v(" "),e("li",[e("p",[s._v("第三方")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("人定期观察")]),s._v(" "),e("p",[s._v("不可靠")]),s._v(" "),e("p",[s._v("企业追求自动化，把人解耦")])]),s._v(" "),e("li",[e("p",[s._v("程序实现HA")]),s._v(" "),e("p",[s._v("keeplived")])])])])])]),s._v(" "),e("li",[e("p",[s._v("RS故障")])])]),s._v(" "),e("h2",{attrs:{id:"keepalived"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#keepalived"}},[s._v("#")]),s._v(" keepalived")]),s._v(" "),e("h3",{attrs:{id:"职责"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#职责"}},[s._v("#")]),s._v(" 职责")]),s._v(" "),e("ul",[e("li",[s._v("监控自己的服务")]),s._v(" "),e("li",[s._v("Master通告自己还活着，backup监听master状态，Master挂了，一堆backup推举出新的Master")]),s._v(" "),e("li",[s._v("配置，ip添加ipvs，keepalived是有配置文件的")]),s._v(" "),e("li",[s._v("对后端Server做健康检查")])]),s._v(" "),e("h3",{attrs:{id:"实验"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实验"}},[s._v("#")]),s._v(" 实验")]),s._v(" "),e("p",[s._v("主机： node01~node04")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("node01:")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("ipvsadm -C\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v(" eth0:8 down\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])])])]),s._v(" "),e("hr"),s._v(" "),e("ul",[e("li",[e("p",[s._v("node01,node04:")]),s._v(" "),e("ul",[e("li",[s._v("安装程序")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("yum install keepalived ipvsadm -y\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[e("p",[s._v("配置：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("cd  /etc/keepalived/\ncp keepalived.conf keepalived.conf.bak\nvi keepalived.conf\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ul",[e("li",[e("p",[s._v("node01:\nvrrp：虚拟路由冗余协议！")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("vrrp_instance VI_1 {\n\tstate MASTER         // node04  BACKUP\n\tinterface eth0       // 企业中一般会加多块网卡，用于传输不同的数据\n\tvirtual_router_id 51\n\tpriority 100\t\t //\t 权重node04\t 50\n\tadvert_int 1\n\tauthentication {\n\t\tauth_type PASS\n\t\tauth_pass 1111\n\t}\n\tvirtual_ipaddress {\n\t\t192.168.150.100/24 dev eth0 label  eth0:3\n\t}\n}\nvirtual_server 192.168.150.100 80 {\n\tdelay_loop 6\n\tlb_algo rr\n\tlb_kind DR\n\tnat_mask 255.255.255.0\n\tpersistence_timeout 0   // session的时间，生产环境中需要设置一个合适值\n\tprotocol TCP\n\n\treal_server 192.168.150.12 80 {\n\t\tweight 1\n\t\tHTTP_GET {\n\t\t\turl {\n\t\t\t\tpath /\n\t\t\t\tstatus_code 200\n\t\t\t}\n\t\t\tconnect_timeout 3\n\t\t\tnb_get_retry 3\n\t\t\tdelay_before_retry 3\n\t\t}\n\t}\n\treal_server 192.168.150.13 80 {\n\t\tweight 1\n\t\tHTTP_GET {\n\t\t\turl {\n\t\t\t\tpath /\n\t\t\t\tstatus_code 200\n\t\t\t}\n\t\t\tconnect_timeout 3\n\t\t\tnb_get_retry 3\n\t\t\tdelay_before_retry 3\n\t\t}\n\t}\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br")])]),e("p",[s._v("​\tscp  ./keepalived.conf  root@node04:"),e("code",[s._v("pwd")])])])])]),s._v(" "),e("li",[e("p",[s._v("启动")]),s._v(" "),e("p",[s._v("service keepalived start")])])])])]),s._v(" "),e("h3",{attrs:{id:"特点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#特点"}},[s._v("#")]),s._v(" 特点")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("Master挂掉恢复之后会抢回主")])]),s._v(" "),e("li",[e("p",[s._v("RS故障恢复之后")]),s._v(" "),e("p",[s._v("keepalived能自动检查到并恢复提供服务")])]),s._v(" "),e("li",[e("p",[s._v("keepalived启动之后有三个keepalived进程")]),s._v(" "),e("p",[s._v("主进程：广播自己还活着")]),s._v(" "),e("p",[s._v("另外两个子进程：做RS的健康检查")])]),s._v(" "),e("li",[e("p",[s._v("杀死keepalived进程")]),s._v(" "),e("p",[s._v("造成两个lvs主机都配置了VIP，从到导致客户端数据包出现紊乱，握手包或者分手包可能会负载给不同的RS，破坏了原子性。出现不能建立连接或者丢包。")]),s._v(" "),e("p",[s._v("为了解决上面的问题引入了一个不可靠的keepalived，出现了新的问题")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);